(()=>{var e={};e.id=410,e.ids=[410],e.modules={246:(e,t,r)=>{"use strict";r.r(t),r.d(t,{GlobalError:()=>o.a,__next_app__:()=>u,pages:()=>c,routeModule:()=>p,tree:()=>d});var n=r(65239),a=r(48088),i=r(88170),o=r.n(i),s=r(30893),l={};for(let e in s)0>["default","tree","pages","GlobalError","__next_app__","routeModule"].indexOf(e)&&(l[e]=()=>s[e]);r.d(t,l);let d={children:["",{children:["admin",{children:["coupons",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(r.bind(r,77088)),"/home/user/studio/src/app/admin/coupons/page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(r.bind(r,99111)),"/home/user/studio/src/app/admin/layout.tsx"],metadata:{icon:[async e=>(await Promise.resolve().then(r.bind(r,70440))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]},{layout:[()=>Promise.resolve().then(r.bind(r,94431)),"/home/user/studio/src/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(r.t.bind(r,57398,23)),"next/dist/client/components/not-found-error"],forbidden:[()=>Promise.resolve().then(r.t.bind(r,89999,23)),"next/dist/client/components/forbidden-error"],unauthorized:[()=>Promise.resolve().then(r.t.bind(r,65284,23)),"next/dist/client/components/unauthorized-error"],metadata:{icon:[async e=>(await Promise.resolve().then(r.bind(r,70440))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]}.children,c=["/home/user/studio/src/app/admin/coupons/page.tsx"],u={require:r,loadChunk:()=>Promise.resolve()},p=new n.AppPageRouteModule({definition:{kind:a.RouteKind.APP_PAGE,page:"/admin/coupons/page",pathname:"/admin/coupons",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},4128:(e,t,r)=>{"use strict";function n(e){throw Object.defineProperty(Error("cacheLife() is only available with the experimental.useCache config."),"__NEXT_ERROR_CODE",{value:"E627",enumerable:!1,configurable:!0})}Object.defineProperty(t,"F",{enumerable:!0,get:function(){return n}}),r(29294),r(63033)},8010:(e,t,r)=>{"use strict";let n,a;r.d(t,{db:()=>a});var i=r(89579),o=r(34717);let s={apiKey:"AIzaSyDCteU3dj_3lAMDzdjW3hLPgci5mGuPUUo",authDomain:"rentalspot-fzwom.firebaseapp.com",projectId:"rentalspot-fzwom",storageBucket:"rentalspot-fzwom.firebasestorage.app",messagingSenderId:"1061532538391",appId:"1:1061532538391:web:aff9b573f7b4c09f99ae52"};if(0===(0,i.Dk)().length){if(s.apiKey&&s.projectId)try{n=(0,i.Wp)(s)}catch(e){console.error("❌ Firebase Client SDK initialization failed:",e)}else console.error("❌ Client Firebase Config Missing: NEXT_PUBLIC_FIREBASE_API_KEY or NEXT_PUBLIC_FIREBASE_PROJECT_ID is missing in environment variables. Client SDK cannot initialize.")}else n=(0,i.Sx)();if(n)try{a=(0,o.aU)(n)}catch(e){console.error("❌ Firestore Client SDK initialization failed:",e)}else console.error("❌ Cannot initialize Firestore Client SDK because Firebase app is not available.")},8445:(e,t,r)=>{"use strict";Object.defineProperty(t,"e",{enumerable:!0,get:function(){return c}});let n=r(46143),a=r(37719),i=r(29294),o=r(63033),s=r(43365),l=0;async function d(e,t,r,a,i,o,l){await t.set(r,{kind:s.CachedRouteKind.FETCH,data:{headers:{},body:JSON.stringify(e),status:200,url:""},revalidate:"number"!=typeof i?n.CACHE_ONE_YEAR:i},{fetchCache:!0,tags:a,fetchIdx:o,fetchUrl:l})}function c(e,t,r={}){if(0===r.revalidate)throw Object.defineProperty(Error(`Invariant revalidate: 0 can not be passed to unstable_cache(), must be "false" or "> 0" ${e.toString()}`),"__NEXT_ERROR_CODE",{value:"E57",enumerable:!1,configurable:!0});let n=r.tags?(0,a.validateTags)(r.tags,`unstable_cache ${e.toString()}`):[];(0,a.validateRevalidate)(r.revalidate,`unstable_cache ${e.name||e.toString()}`);let u=`${e.toString()}-${Array.isArray(t)&&t.join(",")}`;return async(...t)=>{let a=i.workAsyncStorage.getStore(),c=o.workUnitAsyncStorage.getStore(),p=(null==a?void 0:a.incrementalCache)||globalThis.__incrementalCache;if(!p)throw Object.defineProperty(Error(`Invariant: incrementalCache missing in unstable_cache ${e.toString()}`),"__NEXT_ERROR_CODE",{value:"E469",enumerable:!1,configurable:!0});let f=c&&"prerender"===c.type?c.cacheSignal:null;f&&f.beginRead();try{let i=c&&"request"===c.type?c:void 0,f=(null==i?void 0:i.url.pathname)??(null==a?void 0:a.route)??"",h=new URLSearchParams((null==i?void 0:i.url.search)??""),m=[...h.keys()].sort((e,t)=>e.localeCompare(t)).map(e=>`${e}=${h.get(e)}`).join("&"),g=`${u}-${JSON.stringify(t)}`,b=await p.generateCacheKey(g),v=`unstable_cache ${f}${m.length?"?":""}${m} ${e.name?` ${e.name}`:b}`,x=(a?a.nextFetchId:l)??1;if(a){if(a.nextFetchId=x+1,c&&("cache"===c.type||"prerender"===c.type||"prerender-ppr"===c.type||"prerender-legacy"===c.type)){"number"==typeof r.revalidate&&(c.revalidate<r.revalidate||(c.revalidate=r.revalidate));let e=c.tags;if(null===e)c.tags=n.slice();else for(let t of n)e.includes(t)||e.push(t)}let i=c&&"unstable-cache"!==c.type?c.implicitTags:[];if(!(c&&"unstable-cache"===c.type)&&"force-no-store"!==a.fetchCache&&!a.isOnDemandRevalidate&&!p.isOnDemandRevalidate&&!a.isDraftMode){let l=await p.get(b,{kind:s.IncrementalCacheKind.FETCH,revalidate:r.revalidate,tags:n,softTags:i,fetchIdx:x,fetchUrl:v});if(l&&l.value){if(l.value.kind!==s.CachedRouteKind.FETCH)console.error(`Invariant invalid cacheEntry returned for ${g}`);else{let i=void 0!==l.value.data.body?JSON.parse(l.value.data.body):void 0;return l.isStale&&(a.pendingRevalidates||(a.pendingRevalidates={}),a.pendingRevalidates[g]=o.workUnitAsyncStorage.run({type:"unstable-cache",phase:"render"},e,...t).then(e=>d(e,p,b,n,r.revalidate,x,v)).catch(e=>console.error(`revalidating cache with key: ${g}`,e))),i}}}let l=await o.workUnitAsyncStorage.run({type:"unstable-cache",phase:"render"},e,...t);return a.isDraftMode||d(l,p,b,n,r.revalidate,x,v),l}{if(l+=1,!p.isOnDemandRevalidate){let e=c&&"unstable-cache"!==c.type?c.implicitTags:[],t=await p.get(b,{kind:s.IncrementalCacheKind.FETCH,revalidate:r.revalidate,tags:n,fetchIdx:x,fetchUrl:v,softTags:e});if(t&&t.value){if(t.value.kind!==s.CachedRouteKind.FETCH)console.error(`Invariant invalid cacheEntry returned for ${g}`);else if(!t.isStale)return void 0!==t.value.data.body?JSON.parse(t.value.data.body):void 0}}let a=await o.workUnitAsyncStorage.run({type:"unstable-cache",phase:"render"},e,...t);return d(a,p,b,n,r.revalidate,x,v),a}}finally{f&&f.endRead()}}}},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},19121:e=>{"use strict";e.exports=require("next/dist/server/app-render/action-async-storage.external.js")},19610:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),!function(e,t){for(var r in t)Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}(t,{getSortedRouteObjects:function(){return a},getSortedRoutes:function(){return n}});class r{insert(e){this._insert(e.split("/").filter(Boolean),[],!1)}smoosh(){return this._smoosh()}_smoosh(e){void 0===e&&(e="/");let t=[...this.children.keys()].sort();null!==this.slugName&&t.splice(t.indexOf("[]"),1),null!==this.restSlugName&&t.splice(t.indexOf("[...]"),1),null!==this.optionalRestSlugName&&t.splice(t.indexOf("[[...]]"),1);let r=t.map(t=>this.children.get(t)._smoosh(""+e+t+"/")).reduce((e,t)=>[...e,...t],[]);if(null!==this.slugName&&r.push(...this.children.get("[]")._smoosh(e+"["+this.slugName+"]/")),!this.placeholder){let t="/"===e?"/":e.slice(0,-1);if(null!=this.optionalRestSlugName)throw Object.defineProperty(Error('You cannot define a route with the same specificity as a optional catch-all route ("'+t+'" and "'+t+"[[..."+this.optionalRestSlugName+']]").'),"__NEXT_ERROR_CODE",{value:"E458",enumerable:!1,configurable:!0});r.unshift(t)}return null!==this.restSlugName&&r.push(...this.children.get("[...]")._smoosh(e+"[..."+this.restSlugName+"]/")),null!==this.optionalRestSlugName&&r.push(...this.children.get("[[...]]")._smoosh(e+"[[..."+this.optionalRestSlugName+"]]/")),r}_insert(e,t,n){if(0===e.length){this.placeholder=!1;return}if(n)throw Object.defineProperty(Error("Catch-all must be the last part of the URL."),"__NEXT_ERROR_CODE",{value:"E392",enumerable:!1,configurable:!0});let a=e[0];if(a.startsWith("[")&&a.endsWith("]")){let r=a.slice(1,-1),o=!1;if(r.startsWith("[")&&r.endsWith("]")&&(r=r.slice(1,-1),o=!0),r.startsWith("…"))throw Object.defineProperty(Error("Detected a three-dot character ('…') at ('"+r+"'). Did you mean ('...')?"),"__NEXT_ERROR_CODE",{value:"E147",enumerable:!1,configurable:!0});if(r.startsWith("...")&&(r=r.substring(3),n=!0),r.startsWith("[")||r.endsWith("]"))throw Object.defineProperty(Error("Segment names may not start or end with extra brackets ('"+r+"')."),"__NEXT_ERROR_CODE",{value:"E421",enumerable:!1,configurable:!0});if(r.startsWith("."))throw Object.defineProperty(Error("Segment names may not start with erroneous periods ('"+r+"')."),"__NEXT_ERROR_CODE",{value:"E288",enumerable:!1,configurable:!0});function i(e,r){if(null!==e&&e!==r)throw Object.defineProperty(Error("You cannot use different slug names for the same dynamic path ('"+e+"' !== '"+r+"')."),"__NEXT_ERROR_CODE",{value:"E337",enumerable:!1,configurable:!0});t.forEach(e=>{if(e===r)throw Object.defineProperty(Error('You cannot have the same slug name "'+r+'" repeat within a single dynamic path'),"__NEXT_ERROR_CODE",{value:"E247",enumerable:!1,configurable:!0});if(e.replace(/\W/g,"")===a.replace(/\W/g,""))throw Object.defineProperty(Error('You cannot have the slug names "'+e+'" and "'+r+'" differ only by non-word symbols within a single dynamic path'),"__NEXT_ERROR_CODE",{value:"E499",enumerable:!1,configurable:!0})}),t.push(r)}if(n){if(o){if(null!=this.restSlugName)throw Object.defineProperty(Error('You cannot use both an required and optional catch-all route at the same level ("[...'+this.restSlugName+']" and "'+e[0]+'" ).'),"__NEXT_ERROR_CODE",{value:"E299",enumerable:!1,configurable:!0});i(this.optionalRestSlugName,r),this.optionalRestSlugName=r,a="[[...]]"}else{if(null!=this.optionalRestSlugName)throw Object.defineProperty(Error('You cannot use both an optional and required catch-all route at the same level ("[[...'+this.optionalRestSlugName+']]" and "'+e[0]+'").'),"__NEXT_ERROR_CODE",{value:"E300",enumerable:!1,configurable:!0});i(this.restSlugName,r),this.restSlugName=r,a="[...]"}}else{if(o)throw Object.defineProperty(Error('Optional route parameters are not yet supported ("'+e[0]+'").'),"__NEXT_ERROR_CODE",{value:"E435",enumerable:!1,configurable:!0});i(this.slugName,r),this.slugName=r,a="[]"}}this.children.has(a)||this.children.set(a,new r),this.children.get(a)._insert(e.slice(1),t,n)}constructor(){this.placeholder=!0,this.children=new Map,this.slugName=null,this.restSlugName=null,this.optionalRestSlugName=null}}function n(e){let t=new r;return e.forEach(e=>t.insert(e)),t.smoosh()}function a(e,t){let r={},a=[];for(let n=0;n<e.length;n++){let i=t(e[n]);r[i]=n,a[n]=i}return n(a).map(t=>e[r[t]])}},19771:e=>{"use strict";e.exports=require("process")},21820:e=>{"use strict";e.exports=require("os")},23496:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),!function(e,t){for(var r in t)Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}(t,{getSortedRouteObjects:function(){return n.getSortedRouteObjects},getSortedRoutes:function(){return n.getSortedRoutes},isDynamicRoute:function(){return a.isDynamicRoute}});let n=r(19610),a=r(49022)},27910:e=>{"use strict";e.exports=require("stream")},28354:e=>{"use strict";e.exports=require("util")},29021:e=>{"use strict";e.exports=require("fs")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},33873:e=>{"use strict";e.exports=require("path")},34631:e=>{"use strict";e.exports=require("tls")},37366:e=>{"use strict";e.exports=require("dns")},38217:(e,t,r)=>{"use strict";r.d(t,{CouponTable:()=>ez});var n=r(60687),a=r(43210),i=r(4780);let o=a.forwardRef(({className:e,...t},r)=>(0,n.jsx)("div",{className:"relative w-full overflow-auto",children:(0,n.jsx)("table",{ref:r,className:(0,i.cn)("w-full caption-bottom text-sm",e),...t})}));o.displayName="Table";let s=a.forwardRef(({className:e,...t},r)=>(0,n.jsx)("thead",{ref:r,className:(0,i.cn)("[&_tr]:border-b",e),...t}));s.displayName="TableHeader";let l=a.forwardRef(({className:e,...t},r)=>(0,n.jsx)("tbody",{ref:r,className:(0,i.cn)("[&_tr:last-child]:border-0",e),...t}));l.displayName="TableBody",a.forwardRef(({className:e,...t},r)=>(0,n.jsx)("tfoot",{ref:r,className:(0,i.cn)("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",e),...t})).displayName="TableFooter";let d=a.forwardRef(({className:e,...t},r)=>(0,n.jsx)("tr",{ref:r,className:(0,i.cn)("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",e),...t}));d.displayName="TableRow";let c=a.forwardRef(({className:e,...t},r)=>(0,n.jsx)("th",{ref:r,className:(0,i.cn)("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",e),...t}));c.displayName="TableHead";let u=a.forwardRef(({className:e,...t},r)=>(0,n.jsx)("td",{ref:r,className:(0,i.cn)("p-4 align-middle [&:has([role=checkbox])]:pr-0",e),...t}));u.displayName="TableCell";let p=a.forwardRef(({className:e,...t},r)=>(0,n.jsx)("caption",{ref:r,className:(0,i.cn)("mt-4 text-sm text-muted-foreground",e),...t}));p.displayName="TableCaption";let f=(0,r(24224).F)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function h({className:e,variant:t,...r}){return(0,n.jsx)("div",{className:(0,i.cn)(f({variant:t}),e),...r})}var m=r(29523),g=r(11392);let b={dateTimeDelimiter:/[T ]/,timeZoneDelimiter:/[Z ]/i,timezone:/([Z+-].*)$/},v=/^-?(?:(\d{3})|(\d{2})(?:-?(\d{2}))?|W(\d{2})(?:-?(\d{1}))?|)$/,x=/^(\d{2}(?:[.,]\d*)?)(?::?(\d{2}(?:[.,]\d*)?))?(?::?(\d{2}(?:[.,]\d*)?))?$/,y=/^([+-])(\d{2})(?::?(\d{2}))?$/;function w(e){return e?parseInt(e):1}function E(e){return e&&parseFloat(e.replace(",","."))||0}let j=[31,null,31,30,31,30,31,31,30,31,30,31];function _(e){return e%400==0||e%4==0&&e%100!=0}var S=r(33685),C=r(29867),N=r(6475);let R=(0,N.createServerReference)("406f0622a8c3a95c29404a2207bc7315d08fc13f83",N.callServer,void 0,N.findSourceMapURL,"updateCouponStatusAction");var T=r(11516);function P({couponId:e,isActive:t,isDisabled:r=!1}){let[i,o]=(0,a.useState)(t),[s,l]=(0,a.useTransition)(),{toast:d}=(0,C.dj)(),c=async t=>{l(async()=>{let r=await R({couponId:e,isActive:t});r.success?(o(t),d({title:"Status Updated",description:`Coupon status changed to ${t?"Active":"Inactive"}.`})):d({title:"Update Failed",description:r.error||"Could not update coupon status.",variant:"destructive"})})};return(0,n.jsxs)("div",{className:"flex items-center space-x-2",children:[s&&(0,n.jsx)(T.A,{className:"h-4 w-4 animate-spin text-muted-foreground"}),(0,n.jsx)(S.d,{id:`status-toggle-${e}`,checked:i,onCheckedChange:c,disabled:s||r,"aria-label":`Toggle status for coupon ${e}`})]})}var D=r(73437),A=r(26622),O=r(82614);let k=(0,O.A)("Pencil",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]]);var $=r(26373),U=r(40988);let I=(0,N.createServerReference)("40bb5cdc53a4e487e5a6c959a899d282ce4fe42c63",N.callServer,void 0,N.findSourceMapURL,"updateCouponExpiryAction");function z({couponId:e,currentExpiryDate:t}){let[r,o]=(0,a.useState)(t),[s,l]=(0,a.useState)(null),[d,c]=(0,a.useState)(!1),[u,p]=(0,a.useTransition)(),{toast:f}=(0,C.dj)();return(0,n.jsxs)(U.AM,{open:d,onOpenChange:c,children:[(0,n.jsx)(U.Wv,{asChild:!0,children:(0,n.jsxs)(m.$,{variant:"ghost",size:"sm",className:(0,i.cn)("w-[180px] justify-start text-left font-normal",!r&&"text-muted-foreground"),disabled:u,children:[(0,n.jsx)(A.A,{className:"mr-2 h-4 w-4"}),null!==s?s:(0,n.jsx)("span",{children:"Loading date..."}),(0,n.jsx)(k,{className:"ml-auto h-3 w-3 opacity-50"})]})}),(0,n.jsxs)(U.hl,{className:"w-auto p-0",align:"start",children:[u&&(0,n.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-background/80 z-10",children:(0,n.jsx)(T.A,{className:"h-6 w-6 animate-spin text-primary"})}),(0,n.jsx)($.V,{mode:"single",selected:r,onSelect:r=>{r&&(o(r),p(async()=>{let n=await I({couponId:e,validUntil:r});n.success?(f({title:"Expiry Date Updated",description:`Coupon expiry date changed to ${(0,D.GP)(r,"PPP")}.`}),c(!1)):(f({title:"Update Failed",description:n.error||"Could not update expiry date.",variant:"destructive"}),o(t))}))},disabled:e=>u||e<new Date(new Date().setHours(0,0,0,0)),initialFocus:!0})]})]})}var L=r(78726);let F=(0,O.A)("Save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]),V=(0,N.createServerReference)("40f8f32dc620158fd945b5da35a0d3f848da605aaa",N.callServer,void 0,N.findSourceMapURL,"updateCouponBookingValidityAction");function M({couponId:e,currentBookingValidFrom:t,currentBookingValidUntil:r}){let[o,s]=(0,a.useState)({from:t??void 0,to:r??void 0}),[l,d]=(0,a.useState)(!1),[c,u]=(0,a.useTransition)(),{toast:p}=(0,C.dj)();return(0,n.jsxs)(U.AM,{open:l,onOpenChange:d,children:[(0,n.jsx)(U.Wv,{asChild:!0,children:(0,n.jsxs)(m.$,{variant:"outline",size:"sm",className:(0,i.cn)("w-[250px] justify-start text-left font-normal",!o?.from&&!o?.to&&"text-muted-foreground"),disabled:c,children:[(0,n.jsx)(A.A,{className:"mr-2 h-4 w-4"}),o?.from?o.to?(0,n.jsxs)(n.Fragment,{children:[(0,D.GP)(o.from,"LLL dd, y")," - ",(0,D.GP)(o.to,"LLL dd, y")]}):`From ${(0,D.GP)(o.from,"LLL dd, y")}`:o?.to?`Until ${(0,D.GP)(o.to,"LLL dd, y")}`:(0,n.jsx)("span",{children:"Any Dates"})]})}),(0,n.jsxs)(U.hl,{className:"w-auto p-0",align:"start",children:[c&&(0,n.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-background/80 z-10",children:(0,n.jsx)(T.A,{className:"h-6 w-6 animate-spin text-primary"})}),(0,n.jsx)($.V,{mode:"range",selected:o,onSelect:s,disabled:c,numberOfMonths:2,initialFocus:!0}),(0,n.jsxs)("div",{className:"p-3 border-t flex justify-between items-center",children:[(0,n.jsxs)(m.$,{variant:"ghost",size:"sm",onClick:()=>{s(void 0),u(async()=>{let n=await V({couponId:e,bookingValidFrom:null,bookingValidUntil:null});n.success?(p({title:"Booking Validity Cleared",description:"Coupon is now valid for any booking dates."}),d(!1)):(p({title:"Clear Failed",description:n.error||"Could not clear booking validity.",variant:"destructive"}),s({from:t??void 0,to:r??void 0}))})},disabled:c||!o?.from&&!o?.to,children:[(0,n.jsx)(L.A,{className:"mr-1 h-4 w-4"})," Clear Dates"]}),(0,n.jsxs)(m.$,{onClick:()=>{if(o?.from&&o?.to&&o.to<o.from){p({title:"Invalid Date Range",description:"Booking validity end date must be on or after the start date.",variant:"destructive"});return}u(async()=>{let t=o?.from??null,r=o?.to??null,n=await V({couponId:e,bookingValidFrom:t,bookingValidUntil:r});n.success?(p({title:"Booking Validity Updated",description:"Validity period updated successfully."}),d(!1)):p({title:"Update Failed",description:n.error||"Could not update booking validity.",variant:"destructive"})})},disabled:c,size:"sm",children:[(0,n.jsx)(F,{className:"mr-1 h-4 w-4"})," Save Changes"]})]})]})]})}var X=r(57207),H=r(54052);let W=(0,N.createServerReference)("402b0ac8797fc8dc742193ae31de84cafa5fb309ae",N.callServer,void 0,N.findSourceMapURL,"updateCouponExclusionsAction");var q=r(14163),G=r(46059),B=r(11273),Y=r(98599),K=r(13495),Z=a.createContext(void 0),J=r(66156),Q=r(70569),ee="ScrollArea",[et,er]=(0,B.A)(ee),[en,ea]=et(ee),ei=a.forwardRef((e,t)=>{let{__scopeScrollArea:r,type:i="hover",dir:o,scrollHideDelay:s=600,...l}=e,[d,c]=a.useState(null),[u,p]=a.useState(null),[f,h]=a.useState(null),[m,g]=a.useState(null),[b,v]=a.useState(null),[x,y]=a.useState(0),[w,E]=a.useState(0),[j,_]=a.useState(!1),[S,C]=a.useState(!1),N=(0,Y.s)(t,e=>c(e)),R=function(e){let t=a.useContext(Z);return e||t||"ltr"}(o);return(0,n.jsx)(en,{scope:r,type:i,dir:R,scrollHideDelay:s,scrollArea:d,viewport:u,onViewportChange:p,content:f,onContentChange:h,scrollbarX:m,onScrollbarXChange:g,scrollbarXEnabled:j,onScrollbarXEnabledChange:_,scrollbarY:b,onScrollbarYChange:v,scrollbarYEnabled:S,onScrollbarYEnabledChange:C,onCornerWidthChange:y,onCornerHeightChange:E,children:(0,n.jsx)(q.sG.div,{dir:R,...l,ref:N,style:{position:"relative","--radix-scroll-area-corner-width":x+"px","--radix-scroll-area-corner-height":w+"px",...e.style}})})});ei.displayName=ee;var eo="ScrollAreaViewport",es=a.forwardRef((e,t)=>{let{__scopeScrollArea:r,children:i,nonce:o,...s}=e,l=ea(eo,r),d=a.useRef(null),c=(0,Y.s)(t,d,l.onViewportChange);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("style",{dangerouslySetInnerHTML:{__html:"[data-radix-scroll-area-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-scroll-area-viewport]::-webkit-scrollbar{display:none}"},nonce:o}),(0,n.jsx)(q.sG.div,{"data-radix-scroll-area-viewport":"",...s,ref:c,style:{overflowX:l.scrollbarXEnabled?"scroll":"hidden",overflowY:l.scrollbarYEnabled?"scroll":"hidden",...e.style},children:(0,n.jsx)("div",{ref:l.onContentChange,style:{minWidth:"100%",display:"table"},children:i})})]})});es.displayName=eo;var el="ScrollAreaScrollbar",ed=a.forwardRef((e,t)=>{let{forceMount:r,...i}=e,o=ea(el,e.__scopeScrollArea),{onScrollbarXEnabledChange:s,onScrollbarYEnabledChange:l}=o,d="horizontal"===e.orientation;return a.useEffect(()=>(d?s(!0):l(!0),()=>{d?s(!1):l(!1)}),[d,s,l]),"hover"===o.type?(0,n.jsx)(ec,{...i,ref:t,forceMount:r}):"scroll"===o.type?(0,n.jsx)(eu,{...i,ref:t,forceMount:r}):"auto"===o.type?(0,n.jsx)(ep,{...i,ref:t,forceMount:r}):"always"===o.type?(0,n.jsx)(ef,{...i,ref:t}):null});ed.displayName=el;var ec=a.forwardRef((e,t)=>{let{forceMount:r,...i}=e,o=ea(el,e.__scopeScrollArea),[s,l]=a.useState(!1);return a.useEffect(()=>{let e=o.scrollArea,t=0;if(e){let r=()=>{window.clearTimeout(t),l(!0)},n=()=>{t=window.setTimeout(()=>l(!1),o.scrollHideDelay)};return e.addEventListener("pointerenter",r),e.addEventListener("pointerleave",n),()=>{window.clearTimeout(t),e.removeEventListener("pointerenter",r),e.removeEventListener("pointerleave",n)}}},[o.scrollArea,o.scrollHideDelay]),(0,n.jsx)(G.C,{present:r||s,children:(0,n.jsx)(ep,{"data-state":s?"visible":"hidden",...i,ref:t})})}),eu=a.forwardRef((e,t)=>{var r;let{forceMount:i,...o}=e,s=ea(el,e.__scopeScrollArea),l="horizontal"===e.orientation,d=eD(()=>u("SCROLL_END"),100),[c,u]=(r={hidden:{SCROLL:"scrolling"},scrolling:{SCROLL_END:"idle",POINTER_ENTER:"interacting"},interacting:{SCROLL:"interacting",POINTER_LEAVE:"idle"},idle:{HIDE:"hidden",SCROLL:"scrolling",POINTER_ENTER:"interacting"}},a.useReducer((e,t)=>r[e][t]??e,"hidden"));return a.useEffect(()=>{if("idle"===c){let e=window.setTimeout(()=>u("HIDE"),s.scrollHideDelay);return()=>window.clearTimeout(e)}},[c,s.scrollHideDelay,u]),a.useEffect(()=>{let e=s.viewport,t=l?"scrollLeft":"scrollTop";if(e){let r=e[t],n=()=>{let n=e[t];r!==n&&(u("SCROLL"),d()),r=n};return e.addEventListener("scroll",n),()=>e.removeEventListener("scroll",n)}},[s.viewport,l,u,d]),(0,n.jsx)(G.C,{present:i||"hidden"!==c,children:(0,n.jsx)(ef,{"data-state":"hidden"===c?"hidden":"visible",...o,ref:t,onPointerEnter:(0,Q.m)(e.onPointerEnter,()=>u("POINTER_ENTER")),onPointerLeave:(0,Q.m)(e.onPointerLeave,()=>u("POINTER_LEAVE"))})})}),ep=a.forwardRef((e,t)=>{let r=ea(el,e.__scopeScrollArea),{forceMount:i,...o}=e,[s,l]=a.useState(!1),d="horizontal"===e.orientation,c=eD(()=>{if(r.viewport){let e=r.viewport.offsetWidth<r.viewport.scrollWidth,t=r.viewport.offsetHeight<r.viewport.scrollHeight;l(d?e:t)}},10);return eA(r.viewport,c),eA(r.content,c),(0,n.jsx)(G.C,{present:i||s,children:(0,n.jsx)(ef,{"data-state":s?"visible":"hidden",...o,ref:t})})}),ef=a.forwardRef((e,t)=>{let{orientation:r="vertical",...i}=e,o=ea(el,e.__scopeScrollArea),s=a.useRef(null),l=a.useRef(0),[d,c]=a.useState({content:0,viewport:0,scrollbar:{size:0,paddingStart:0,paddingEnd:0}}),u=eC(d.viewport,d.content),p={...i,sizes:d,onSizesChange:c,hasThumb:!!(u>0&&u<1),onThumbChange:e=>s.current=e,onThumbPointerUp:()=>l.current=0,onThumbPointerDown:e=>l.current=e};function f(e,t){return function(e,t,r,n="ltr"){let a=eN(r),i=t||a/2,o=r.scrollbar.paddingStart+i,s=r.scrollbar.size-r.scrollbar.paddingEnd-(a-i),l=r.content-r.viewport;return eT([o,s],"ltr"===n?[0,l]:[-1*l,0])(e)}(e,l.current,d,t)}return"horizontal"===r?(0,n.jsx)(eh,{...p,ref:t,onThumbPositionChange:()=>{if(o.viewport&&s.current){let e=eR(o.viewport.scrollLeft,d,o.dir);s.current.style.transform=`translate3d(${e}px, 0, 0)`}},onWheelScroll:e=>{o.viewport&&(o.viewport.scrollLeft=e)},onDragScroll:e=>{o.viewport&&(o.viewport.scrollLeft=f(e,o.dir))}}):"vertical"===r?(0,n.jsx)(em,{...p,ref:t,onThumbPositionChange:()=>{if(o.viewport&&s.current){let e=eR(o.viewport.scrollTop,d);s.current.style.transform=`translate3d(0, ${e}px, 0)`}},onWheelScroll:e=>{o.viewport&&(o.viewport.scrollTop=e)},onDragScroll:e=>{o.viewport&&(o.viewport.scrollTop=f(e))}}):null}),eh=a.forwardRef((e,t)=>{let{sizes:r,onSizesChange:i,...o}=e,s=ea(el,e.__scopeScrollArea),[l,d]=a.useState(),c=a.useRef(null),u=(0,Y.s)(t,c,s.onScrollbarXChange);return a.useEffect(()=>{c.current&&d(getComputedStyle(c.current))},[c]),(0,n.jsx)(ev,{"data-orientation":"horizontal",...o,ref:u,sizes:r,style:{bottom:0,left:"rtl"===s.dir?"var(--radix-scroll-area-corner-width)":0,right:"ltr"===s.dir?"var(--radix-scroll-area-corner-width)":0,"--radix-scroll-area-thumb-width":eN(r)+"px",...e.style},onThumbPointerDown:t=>e.onThumbPointerDown(t.x),onDragScroll:t=>e.onDragScroll(t.x),onWheelScroll:(t,r)=>{if(s.viewport){let n=s.viewport.scrollLeft+t.deltaX;e.onWheelScroll(n),function(e,t){return e>0&&e<t}(n,r)&&t.preventDefault()}},onResize:()=>{c.current&&s.viewport&&l&&i({content:s.viewport.scrollWidth,viewport:s.viewport.offsetWidth,scrollbar:{size:c.current.clientWidth,paddingStart:eS(l.paddingLeft),paddingEnd:eS(l.paddingRight)}})}})}),em=a.forwardRef((e,t)=>{let{sizes:r,onSizesChange:i,...o}=e,s=ea(el,e.__scopeScrollArea),[l,d]=a.useState(),c=a.useRef(null),u=(0,Y.s)(t,c,s.onScrollbarYChange);return a.useEffect(()=>{c.current&&d(getComputedStyle(c.current))},[c]),(0,n.jsx)(ev,{"data-orientation":"vertical",...o,ref:u,sizes:r,style:{top:0,right:"ltr"===s.dir?0:void 0,left:"rtl"===s.dir?0:void 0,bottom:"var(--radix-scroll-area-corner-height)","--radix-scroll-area-thumb-height":eN(r)+"px",...e.style},onThumbPointerDown:t=>e.onThumbPointerDown(t.y),onDragScroll:t=>e.onDragScroll(t.y),onWheelScroll:(t,r)=>{if(s.viewport){let n=s.viewport.scrollTop+t.deltaY;e.onWheelScroll(n),function(e,t){return e>0&&e<t}(n,r)&&t.preventDefault()}},onResize:()=>{c.current&&s.viewport&&l&&i({content:s.viewport.scrollHeight,viewport:s.viewport.offsetHeight,scrollbar:{size:c.current.clientHeight,paddingStart:eS(l.paddingTop),paddingEnd:eS(l.paddingBottom)}})}})}),[eg,eb]=et(el),ev=a.forwardRef((e,t)=>{let{__scopeScrollArea:r,sizes:i,hasThumb:o,onThumbChange:s,onThumbPointerUp:l,onThumbPointerDown:d,onThumbPositionChange:c,onDragScroll:u,onWheelScroll:p,onResize:f,...h}=e,m=ea(el,r),[g,b]=a.useState(null),v=(0,Y.s)(t,e=>b(e)),x=a.useRef(null),y=a.useRef(""),w=m.viewport,E=i.content-i.viewport,j=(0,K.c)(p),_=(0,K.c)(c),S=eD(f,10);function C(e){x.current&&u({x:e.clientX-x.current.left,y:e.clientY-x.current.top})}return a.useEffect(()=>{let e=e=>{let t=e.target;g?.contains(t)&&j(e,E)};return document.addEventListener("wheel",e,{passive:!1}),()=>document.removeEventListener("wheel",e,{passive:!1})},[w,g,E,j]),a.useEffect(_,[i,_]),eA(g,S),eA(m.content,S),(0,n.jsx)(eg,{scope:r,scrollbar:g,hasThumb:o,onThumbChange:(0,K.c)(s),onThumbPointerUp:(0,K.c)(l),onThumbPositionChange:_,onThumbPointerDown:(0,K.c)(d),children:(0,n.jsx)(q.sG.div,{...h,ref:v,style:{position:"absolute",...h.style},onPointerDown:(0,Q.m)(e.onPointerDown,e=>{0===e.button&&(e.target.setPointerCapture(e.pointerId),x.current=g.getBoundingClientRect(),y.current=document.body.style.webkitUserSelect,document.body.style.webkitUserSelect="none",m.viewport&&(m.viewport.style.scrollBehavior="auto"),C(e))}),onPointerMove:(0,Q.m)(e.onPointerMove,C),onPointerUp:(0,Q.m)(e.onPointerUp,e=>{let t=e.target;t.hasPointerCapture(e.pointerId)&&t.releasePointerCapture(e.pointerId),document.body.style.webkitUserSelect=y.current,m.viewport&&(m.viewport.style.scrollBehavior=""),x.current=null})})})}),ex="ScrollAreaThumb",ey=a.forwardRef((e,t)=>{let{forceMount:r,...a}=e,i=eb(ex,e.__scopeScrollArea);return(0,n.jsx)(G.C,{present:r||i.hasThumb,children:(0,n.jsx)(ew,{ref:t,...a})})}),ew=a.forwardRef((e,t)=>{let{__scopeScrollArea:r,style:i,...o}=e,s=ea(ex,r),l=eb(ex,r),{onThumbPositionChange:d}=l,c=(0,Y.s)(t,e=>l.onThumbChange(e)),u=a.useRef(void 0),p=eD(()=>{u.current&&(u.current(),u.current=void 0)},100);return a.useEffect(()=>{let e=s.viewport;if(e){let t=()=>{p(),u.current||(u.current=eP(e,d),d())};return d(),e.addEventListener("scroll",t),()=>e.removeEventListener("scroll",t)}},[s.viewport,p,d]),(0,n.jsx)(q.sG.div,{"data-state":l.hasThumb?"visible":"hidden",...o,ref:c,style:{width:"var(--radix-scroll-area-thumb-width)",height:"var(--radix-scroll-area-thumb-height)",...i},onPointerDownCapture:(0,Q.m)(e.onPointerDownCapture,e=>{let t=e.target.getBoundingClientRect(),r=e.clientX-t.left,n=e.clientY-t.top;l.onThumbPointerDown({x:r,y:n})}),onPointerUp:(0,Q.m)(e.onPointerUp,l.onThumbPointerUp)})});ey.displayName=ex;var eE="ScrollAreaCorner",ej=a.forwardRef((e,t)=>{let r=ea(eE,e.__scopeScrollArea),a=!!(r.scrollbarX&&r.scrollbarY);return"scroll"!==r.type&&a?(0,n.jsx)(e_,{...e,ref:t}):null});ej.displayName=eE;var e_=a.forwardRef((e,t)=>{let{__scopeScrollArea:r,...i}=e,o=ea(eE,r),[s,l]=a.useState(0),[d,c]=a.useState(0),u=!!(s&&d);return eA(o.scrollbarX,()=>{let e=o.scrollbarX?.offsetHeight||0;o.onCornerHeightChange(e),c(e)}),eA(o.scrollbarY,()=>{let e=o.scrollbarY?.offsetWidth||0;o.onCornerWidthChange(e),l(e)}),u?(0,n.jsx)(q.sG.div,{...i,ref:t,style:{width:s,height:d,position:"absolute",right:"ltr"===o.dir?0:void 0,left:"rtl"===o.dir?0:void 0,bottom:0,...e.style}}):null});function eS(e){return e?parseInt(e,10):0}function eC(e,t){let r=e/t;return isNaN(r)?0:r}function eN(e){let t=eC(e.viewport,e.content),r=e.scrollbar.paddingStart+e.scrollbar.paddingEnd;return Math.max((e.scrollbar.size-r)*t,18)}function eR(e,t,r="ltr"){let n=eN(t),a=t.scrollbar.paddingStart+t.scrollbar.paddingEnd,i=t.scrollbar.size-a,o=t.content-t.viewport,s=function(e,[t,r]){return Math.min(r,Math.max(t,e))}(e,"ltr"===r?[0,o]:[-1*o,0]);return eT([0,o],[0,i-n])(s)}function eT(e,t){return r=>{if(e[0]===e[1]||t[0]===t[1])return t[0];let n=(t[1]-t[0])/(e[1]-e[0]);return t[0]+n*(r-e[0])}}var eP=(e,t=()=>{})=>{let r={left:e.scrollLeft,top:e.scrollTop},n=0;return function a(){let i={left:e.scrollLeft,top:e.scrollTop},o=r.left!==i.left,s=r.top!==i.top;(o||s)&&t(),r=i,n=window.requestAnimationFrame(a)}(),()=>window.cancelAnimationFrame(n)};function eD(e,t){let r=(0,K.c)(e),n=a.useRef(0);return a.useEffect(()=>()=>window.clearTimeout(n.current),[]),a.useCallback(()=>{window.clearTimeout(n.current),n.current=window.setTimeout(r,t)},[r,t])}function eA(e,t){let r=(0,K.c)(t);(0,J.N)(()=>{let t=0;if(e){let n=new ResizeObserver(()=>{cancelAnimationFrame(t),t=window.requestAnimationFrame(r)});return n.observe(e),()=>{window.cancelAnimationFrame(t),n.unobserve(e)}}},[e,r])}let eO=a.forwardRef(({className:e,children:t,...r},a)=>(0,n.jsxs)(ei,{ref:a,className:(0,i.cn)("relative overflow-hidden",e),...r,children:[(0,n.jsx)(es,{className:"h-full w-full rounded-[inherit]",children:t}),(0,n.jsx)(ek,{}),(0,n.jsx)(ej,{})]}));eO.displayName=ei.displayName;let ek=a.forwardRef(({className:e,orientation:t="vertical",...r},a)=>(0,n.jsx)(ed,{ref:a,orientation:t,className:(0,i.cn)("flex touch-none select-none transition-colors","vertical"===t&&"h-full w-2.5 border-l border-l-transparent p-[1px]","horizontal"===t&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",e),...r,children:(0,n.jsx)(ey,{className:"relative flex-1 rounded-full bg-border"})}));function e$({couponId:e,currentExclusionPeriods:t}){let[r,i]=(0,a.useState)(t.map(e=>({start:e.start,end:e.end}))),[o,s]=(0,a.useState)(void 0),[l,d]=(0,a.useState)(!1),[c,u]=(0,a.useTransition)(),{toast:p}=(0,C.dj)(),f=e=>{i(r.filter((t,r)=>r!==e))};return(0,n.jsxs)("div",{className:"space-y-3",children:[c&&(0,n.jsxs)("div",{className:"flex items-center justify-center text-muted-foreground text-sm",children:[(0,n.jsx)(T.A,{className:"mr-2 h-4 w-4 animate-spin"})," Updating..."]}),(0,n.jsxs)(eO,{className:"h-24 w-full rounded-md border p-2",children:[" ",0===r.length?(0,n.jsx)("p",{className:"text-sm text-muted-foreground text-center py-2",children:"No exclusion periods defined."}):(0,n.jsx)("ul",{className:"space-y-1",children:r.map((e,t)=>(0,n.jsxs)("li",{className:"flex items-center justify-between text-sm bg-secondary/50 p-1 rounded",children:[(0,n.jsxs)("span",{children:[e.start?(0,D.GP)(e.start,"LLL dd, y"):"..."," -"," ",e.end?(0,D.GP)(e.end,"LLL dd, y"):"...",(!e.start||!e.end||e.start&&e.end&&e.end<e.start)&&(0,n.jsx)(h,{variant:"destructive",className:"ml-2",children:"Invalid"})]}),(0,n.jsx)(m.$,{variant:"ghost",size:"icon",className:"h-6 w-6 text-destructive",onClick:()=>f(t),disabled:c,"aria-label":`Remove exclusion period ${t+1}`,children:(0,n.jsx)(X.A,{className:"h-4 w-4"})})]},t))})]}),(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsxs)(U.AM,{open:l,onOpenChange:d,children:[(0,n.jsx)(U.Wv,{asChild:!0,children:(0,n.jsxs)(m.$,{variant:"outline",size:"sm",disabled:c,children:[(0,n.jsx)(H.A,{className:"mr-1 h-4 w-4"})," Add Exclusion"]})}),(0,n.jsxs)(U.hl,{className:"w-auto p-0",align:"start",children:[(0,n.jsx)($.V,{mode:"range",selected:o,onSelect:s,numberOfMonths:1,initialFocus:!0}),(0,n.jsx)("div",{className:"p-2 border-t text-right",children:(0,n.jsx)(m.$,{size:"sm",onClick:()=>{if(o?.from&&o?.to){if(o.to<o.from){p({title:"Invalid Date Range",description:"End date must be on or after start date.",variant:"destructive"});return}i([...r,{start:o.from,end:o.to}]),s(void 0),d(!1)}else p({title:"Incomplete Date Range",description:"Please select both a start and end date.",variant:"destructive"})},children:"Add Period"})})]})]}),(0,n.jsxs)(m.$,{size:"sm",onClick:()=>{let t=r.filter(e=>e.start&&e.end&&e.end>=e.start);if(t.length!==r.length){p({title:"Invalid Periods Found",description:"Some exclusion periods have invalid dates. Please correct them before saving.",variant:"destructive"});return}u(async()=>{let r=await W({couponId:e,exclusionPeriods:t});r.success?p({title:"Exclusion Periods Updated",description:"Exclusions saved successfully."}):p({title:"Update Failed",description:r.error||"Could not update exclusion periods.",variant:"destructive"})})},disabled:c||JSON.stringify(r)===JSON.stringify(t.map(e=>({start:e.start,end:e.end}))),className:"ml-auto",children:[c?(0,n.jsx)(T.A,{className:"mr-1 h-4 w-4 animate-spin"}):(0,n.jsx)(F,{className:"mr-1 h-4 w-4"}),"Save Exclusions"]})]})]})}ek.displayName=ed.displayName;let eU=(0,O.A)("ChevronUp",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]),eI=(0,O.A)("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);function ez({coupons:e}){let[t,r]=(0,a.useState)(null),i=e=>{r(t===e?null:e)},f=e=>{if(!e)return null;if(e instanceof Date)return e;if("object"==typeof e&&"seconds"in e&&"nanoseconds"in e)return new Date(1e3*e.seconds+e.nanoseconds/1e6);if("string"==typeof e)try{return function(e,t){let r,n;let a=function(e){let t;let r={},n=e.split(b.dateTimeDelimiter);if(n.length>2)return r;if(/:/.test(n[0])?t=n[0]:(r.date=n[0],t=n[1],b.timeZoneDelimiter.test(r.date)&&(r.date=e.split(b.timeZoneDelimiter)[0],t=e.substr(r.date.length,e.length))),t){let e=b.timezone.exec(t);e?(r.time=t.replace(e[1],""),r.timezone=e[1]):r.time=t}return r}(e);if(a.date){let e=function(e,t){let r=RegExp("^(?:(\\d{4}|[+-]\\d{"+(4+t)+"})|(\\d{2}|[+-]\\d{"+(2+t)+"})$)"),n=e.match(r);if(!n)return{year:NaN,restDateString:""};let a=n[1]?parseInt(n[1]):null,i=n[2]?parseInt(n[2]):null;return{year:null===i?a:100*i,restDateString:e.slice((n[1]||n[2]).length)}}(a.date,(void 0)??2);r=function(e,t){var r,n,a,i,o,s,l,d;if(null===t)return new Date(NaN);let c=e.match(v);if(!c)return new Date(NaN);let u=!!c[4],p=w(c[1]),f=w(c[2])-1,h=w(c[3]),m=w(c[4]),g=w(c[5])-1;if(u){return(r=0,n=m,a=g,n>=1&&n<=53&&a>=0&&a<=6)?function(e,t,r){let n=new Date(0);n.setUTCFullYear(e,0,4);let a=n.getUTCDay()||7;return n.setUTCDate(n.getUTCDate()+((t-1)*7+r+1-a)),n}(t,m,g):new Date(NaN)}{let e=new Date(0);return(i=t,o=f,s=h,o>=0&&o<=11&&s>=1&&s<=(j[o]||(_(i)?29:28))&&(l=t,(d=p)>=1&&d<=(_(l)?366:365)))?(e.setUTCFullYear(t,f,Math.max(p,h)),e):new Date(NaN)}}(e.restDateString,e.year)}if(!r||isNaN(r.getTime()))return new Date(NaN);let i=r.getTime(),o=0;if(a.time&&isNaN(o=function(e){var t,r,n;let a=e.match(x);if(!a)return NaN;let i=E(a[1]),o=E(a[2]),s=E(a[3]);return(t=i,r=o,n=s,24===t?0===r&&0===n:n>=0&&n<60&&r>=0&&r<60&&t>=0&&t<25)?i*g.s0+o*g.Cg+1e3*s:NaN}(a.time)))return new Date(NaN);if(a.timezone){if(isNaN(n=function(e){var t,r;if("Z"===e)return 0;let n=e.match(y);if(!n)return 0;let a="+"===n[1]?-1:1,i=parseInt(n[2]),o=n[3]&&parseInt(n[3])||0;return(t=0,(r=o)>=0&&r<=59)?a*(i*g.s0+o*g.Cg):NaN}(a.timezone)))return new Date(NaN)}else{let e=new Date(i+o),t=new Date(0);return t.setFullYear(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate()),t.setHours(e.getUTCHours(),e.getUTCMinutes(),e.getUTCSeconds(),e.getUTCMilliseconds()),t}return new Date(i+o+n)}(e)}catch{return null}return"number"==typeof e?new Date(e):null},S=e=>e?e.map(e=>({start:f(e.start),end:f(e.end)})).filter(e=>e.start&&e.end):[];return(0,n.jsxs)(o,{children:[(0,n.jsx)(p,{children:"A list of your coupons."}),(0,n.jsx)(s,{children:(0,n.jsxs)(d,{children:[(0,n.jsx)(c,{className:"w-[50px]"})," ",(0,n.jsx)(c,{className:"w-[150px]",children:"Code"}),(0,n.jsx)(c,{children:"Discount (%)"}),(0,n.jsx)(c,{children:"Description"}),(0,n.jsx)(c,{children:"Expires On"}),(0,n.jsx)(c,{children:"Status"}),(0,n.jsx)(c,{className:"text-right",children:"Actions"})]})}),(0,n.jsx)(l,{children:e.map(e=>{let r=f(e.validUntil),o=!!r&&r<new Date(new Date().setHours(0,0,0,0)),s=o?"Expired":e.isActive?"Active":"Inactive",l=t===e.id,c=f(e.bookingValidFrom),p=f(e.bookingValidUntil),g=S(e.exclusionPeriods);return(0,n.jsxs)(a.Fragment,{children:[(0,n.jsxs)(d,{children:[(0,n.jsx)(u,{children:(0,n.jsxs)(m.$,{variant:"ghost",size:"icon",onClick:()=>i(e.id),"aria-expanded":l,"aria-controls":`details-${e.id}`,children:[l?(0,n.jsx)(eU,{className:"h-4 w-4"}):(0,n.jsx)(eI,{className:"h-4 w-4"}),(0,n.jsxs)("span",{className:"sr-only",children:[l?"Collapse":"Expand"," details"]})]})}),(0,n.jsx)(u,{className:"font-medium",children:e.code}),(0,n.jsxs)(u,{children:[e.discount,"%"]}),(0,n.jsx)(u,{children:e.description||"-"}),(0,n.jsx)(u,{children:r?(0,n.jsx)(z,{couponId:e.id,currentExpiryDate:r}):"No Expiry"}),(0,n.jsx)(u,{children:(0,n.jsx)(h,{variant:"Active"===s?"default":"Inactive"===s?"secondary":"destructive",children:s})}),(0,n.jsx)(u,{className:"text-right",children:(0,n.jsx)(P,{couponId:e.id,isActive:e.isActive,isDisabled:o})})]}),l&&(0,n.jsx)(d,{id:`details-${e.id}`,className:"bg-muted/50 hover:bg-muted/50",children:(0,n.jsxs)(u,{colSpan:7,className:"p-4",children:[" ",(0,n.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("h4",{className:"font-semibold mb-2",children:"Booking Validity"}),(0,n.jsx)(M,{couponId:e.id,currentBookingValidFrom:c,currentBookingValidUntil:p})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("h4",{className:"font-semibold mb-2",children:"Exclusion Periods"}),(0,n.jsx)(e$,{couponId:e.id,currentExclusionPeriods:g})]})]})]})})]},e.id)})})]})}},49022:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"isDynamicRoute",{enumerable:!0,get:function(){return o}});let n=r(71437),a=/\/[^/]*\[[^/]+\][^/]*(?=\/|$)/,i=/\/\[[^/]+\](?=\/|$)/;function o(e,t){return(void 0===t&&(t=!0),(0,n.isInterceptionRouteAppPath)(e)&&(e=(0,n.extractInterceptionRouteInformation)(e).interceptedRoute),t)?i.test(e):a.test(e)}},55511:e=>{"use strict";e.exports=require("crypto")},58343:(e,t,r)=>{Promise.resolve().then(r.bind(r,38217))},62351:(e,t,r)=>{let n={unstable_cache:r(8445).e,revalidateTag:r(83518).revalidateTag,revalidatePath:r(83518).revalidatePath,unstable_expireTag:r(83518).unstable_expireTag,unstable_expirePath:r(83518).unstable_expirePath,unstable_noStore:r(68553).M,unstable_cacheLife:r(4128).F,unstable_cacheTag:r(72932).z};e.exports=n,t.unstable_cache=n.unstable_cache,t.revalidatePath=n.revalidatePath,t.revalidateTag=n.revalidateTag,t.unstable_expireTag=n.unstable_expireTag,t.unstable_expirePath=n.unstable_expirePath,t.unstable_noStore=n.unstable_noStore,t.unstable_cacheLife=n.unstable_cacheLife,t.unstable_cacheTag=n.unstable_cacheTag},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},68553:(e,t,r)=>{"use strict";Object.defineProperty(t,"M",{enumerable:!0,get:function(){return o}});let n=r(29294),a=r(63033),i=r(84971);function o(){let e=n.workAsyncStorage.getStore(),t=a.workUnitAsyncStorage.getStore();return e?e.forceStatic?void 0:void(e.isUnstableNoStore=!0,t&&"prerender"===t.type||(0,i.markCurrentScopeAsDynamic)(e,t,"unstable_noStore()")):void 0}},72932:(e,t,r)=>{"use strict";function n(...e){throw Object.defineProperty(Error("cacheTag() is only available with the experimental.useCache config."),"__NEXT_ERROR_CODE",{value:"E628",enumerable:!1,configurable:!0})}Object.defineProperty(t,"z",{enumerable:!0,get:function(){return n}}),r(63033),r(37719)},73416:(e,t,r)=>{"use strict";r.d(t,{Z_:()=>b,fm:()=>m,j3:()=>u,jD:()=>x,qv:()=>f,w6:()=>y});var n=r(67218);r(79130);var a=r(70762),i=r(34717),o=r(8010),s=r(62351),l=r(17478);let d=a.z.object({start:a.z.date(),end:a.z.date()}).refine(e=>e.end>=e.start,{message:"Exclusion end date must be on or after start date.",path:["end"]}),c=a.z.object({code:a.z.string().min(3).max(50).transform(e=>e.toUpperCase()),discount:a.z.coerce.number().min(1).max(100),validUntil:a.z.date(),isActive:a.z.boolean().default(!0),description:a.z.string().max(100).optional(),bookingValidFrom:a.z.date().nullable().optional(),bookingValidUntil:a.z.date().nullable().optional(),exclusionPeriods:a.z.array(d).optional()}).refine(e=>!e.bookingValidFrom||!e.bookingValidUntil||e.bookingValidUntil>=e.bookingValidFrom,{message:"Booking validity end date must be on or after start date.",path:["bookingValidUntil"]}).refine(e=>!e.validUntil||!e.bookingValidUntil||e.validUntil>=e.bookingValidUntil,{message:"Coupon expiry date must be on or after the booking validity end date.",path:["validUntil"]});async function u(e){let t=c.safeParse(e);if(!t.success){let e=t.error.errors.map(e=>`${e.path.join(".")}: ${e.message}`).join(", ");return console.error("[Create Coupon Action] Validation Error:",e),{error:`Invalid input: ${e}`}}let{code:r,discount:n,validUntil:a,isActive:l,description:d,bookingValidFrom:u,bookingValidUntil:p,exclusionPeriods:f}=t.data;try{let e=(0,i.rJ)(o.db,"coupons"),t={code:r,discount:n,validUntil:i.Dc.fromDate(a),isActive:l,description:d||"",createdAt:(0,i.O5)(),updatedAt:(0,i.O5)(),bookingValidFrom:u?i.Dc.fromDate(u):null,bookingValidUntil:p?i.Dc.fromDate(p):null,exclusionPeriods:f?f.map(e=>({start:i.Dc.fromDate(e.start),end:i.Dc.fromDate(e.end)})):[]},c=await (0,i.gS)(e,t);return console.log(`[Create Coupon Action] Coupon "${r}" created successfully with ID: ${c.id}`),(0,s.revalidatePath)("/admin/coupons"),{id:c.id,code:r}}catch(t){console.error(`❌ [Create Coupon Action] Error creating coupon "${r}":`,t);let e=t instanceof Error?t.message:String(t);if(e.includes("PERMISSION_DENIED"))return{error:"Permission denied. Ensure you are logged in with admin privileges."};return{error:`Failed to create coupon: ${e}`}}}let p=a.z.object({couponId:a.z.string().min(1,"Coupon ID is required."),isActive:a.z.boolean()});async function f(e){let t=p.safeParse(e);if(!t.success){let e=t.error.errors.map(e=>`${e.path.join(".")}: ${e.message}`).join(", ");return console.error("[Update Coupon Status Action] Validation Error:",e),{success:!1,error:`Invalid input: ${e}`}}let{couponId:r,isActive:n}=t.data;try{let e=(0,i.H9)(o.db,"coupons",r);return await (0,i.mZ)(e,{isActive:n,updatedAt:(0,i.O5)()}),console.log(`[Update Coupon Status Action] Coupon ${r} status updated to ${n}.`),(0,s.revalidatePath)("/admin/coupons"),{success:!0}}catch(t){console.error(`❌ [Update Coupon Status Action] Error updating status for coupon ${r}:`,t);let e=t instanceof Error?t.message:String(t);if(e.includes("PERMISSION_DENIED"))return{success:!1,error:"Permission denied. Ensure you are logged in with admin privileges."};return{success:!1,error:`Failed to update coupon status: ${e}`}}}let h=a.z.object({couponId:a.z.string().min(1,"Coupon ID is required."),validUntil:a.z.date()});async function m(e){let t=h.safeParse(e);if(!t.success){let e=t.error.errors.map(e=>`${e.path.join(".")}: ${e.message}`).join(", ");return console.error("[Update Coupon Expiry Action] Validation Error:",e),{success:!1,error:`Invalid input: ${e}`}}let{couponId:r,validUntil:n}=t.data;try{let e=(0,i.H9)(o.db,"coupons",r);return await (0,i.mZ)(e,{validUntil:i.Dc.fromDate(n),updatedAt:(0,i.O5)()}),console.log(`[Update Coupon Expiry Action] Coupon ${r} expiry updated to ${n.toISOString()}.`),(0,s.revalidatePath)("/admin/coupons"),{success:!0}}catch(t){console.error(`❌ [Update Coupon Expiry Action] Error updating expiry for coupon ${r}:`,t);let e=t instanceof Error?t.message:String(t);if(e.includes("PERMISSION_DENIED"))return{success:!1,error:"Permission denied. Ensure you are logged in with admin privileges."};return{success:!1,error:`Failed to update coupon expiry: ${e}`}}}let g=a.z.object({couponId:a.z.string().min(1,"Coupon ID is required."),bookingValidFrom:a.z.date().nullable(),bookingValidUntil:a.z.date().nullable()}).refine(e=>!e.bookingValidFrom||!e.bookingValidUntil||e.bookingValidUntil>=e.bookingValidFrom,{message:"Booking validity end date must be on or after start date.",path:["bookingValidUntil"]});async function b(e){let t=g.safeParse(e);if(!t.success){let e=t.error.errors.map(e=>`${e.path.join(".")}: ${e.message}`).join(", ");return console.error("[Update Coupon Booking Validity Action] Validation Error:",e),{success:!1,error:`Invalid input: ${e}`}}let{couponId:r,bookingValidFrom:n,bookingValidUntil:a}=t.data;try{let e=(0,i.H9)(o.db,"coupons",r);return await (0,i.mZ)(e,{bookingValidFrom:n?i.Dc.fromDate(n):null,bookingValidUntil:a?i.Dc.fromDate(a):null,updatedAt:(0,i.O5)()}),console.log(`[Update Coupon Booking Validity Action] Coupon ${r} booking validity updated.`),(0,s.revalidatePath)("/admin/coupons"),{success:!0}}catch(t){console.error(`❌ [Update Coupon Booking Validity Action] Error updating booking validity for coupon ${r}:`,t);let e=t instanceof Error?t.message:String(t);if(e.includes("PERMISSION_DENIED"))return{success:!1,error:"Permission denied. Ensure you are logged in with admin privileges."};return{success:!1,error:`Failed to update coupon booking validity: ${e}`}}}let v=a.z.object({couponId:a.z.string().min(1,"Coupon ID is required."),exclusionPeriods:a.z.array(d).optional()});async function x(e){let t=v.safeParse(e);if(!t.success){let e=t.error.errors.map(e=>`${e.path.join(".")}: ${e.message}`).join(", ");return console.error("[Update Coupon Exclusions Action] Validation Error:",e),{success:!1,error:`Invalid input: ${e}`}}let{couponId:r,exclusionPeriods:n}=t.data;try{let e=(0,i.H9)(o.db,"coupons",r),t=n?n.map(e=>({start:i.Dc.fromDate(e.start),end:i.Dc.fromDate(e.end)})):[];return await (0,i.mZ)(e,{exclusionPeriods:t,updatedAt:(0,i.O5)()}),console.log(`[Update Coupon Exclusions Action] Coupon ${r} exclusion periods updated.`),(0,s.revalidatePath)("/admin/coupons"),{success:!0}}catch(t){console.error(`❌ [Update Coupon Exclusions Action] Error updating exclusions for coupon ${r}:`,t);let e=t instanceof Error?t.message:String(t);if(e.includes("PERMISSION_DENIED"))return{success:!1,error:"Permission denied. Ensure you are logged in with admin privileges."};return{success:!1,error:`Failed to update coupon exclusions: ${e}`}}}async function y(){try{let e=(0,i.rJ)(o.db,"coupons"),t=(0,i.P)(e,(0,i.My)("createdAt","desc"));return(await (0,i.GG)(t)).docs.map(e=>{var t;let r=e.data(),n=e=>e instanceof i.Dc?e.toDate().toISOString():e&&"number"==typeof e.seconds&&"number"==typeof e.nanoseconds?new Date(1e3*e.seconds+e.nanoseconds/1e6).toISOString():e&&"function"==typeof e.toDate?e.toDate().toISOString():null;return{id:e.id,code:r.code,discount:r.discount,isActive:r.isActive,description:r.description,validUntil:n(r.validUntil),createdAt:n(r.createdAt),updatedAt:n(r.updatedAt),bookingValidFrom:n(r.bookingValidFrom),bookingValidUntil:n(r.bookingValidUntil),exclusionPeriods:(t=r.exclusionPeriods,Array.isArray(t)?t.map(e=>({start:n(e.start),end:n(e.end)})):null)}})}catch(e){return console.error("❌ Error fetching coupons:",e),[]}}(0,l.D)([u,f,m,b,x,y]),(0,n.A)(u,"409087d3070e438ffa19d87bd5e99d491eed83598b",null),(0,n.A)(f,"406f0622a8c3a95c29404a2207bc7315d08fc13f83",null),(0,n.A)(m,"40bb5cdc53a4e487e5a6c959a899d282ce4fe42c63",null),(0,n.A)(b,"40f8f32dc620158fd945b5da35a0d3f848da605aaa",null),(0,n.A)(x,"402b0ac8797fc8dc742193ae31de84cafa5fb309ae",null),(0,n.A)(y,"00a91143391a7b5b620fd8f738d998ce7d8f3f99ff",null)},73496:e=>{"use strict";e.exports=require("http2")},74075:e=>{"use strict";e.exports=require("zlib")},75706:(e,t,r)=>{"use strict";r.d(t,{CouponTable:()=>n});let n=(0,r(12907).registerClientReference)(function(){throw Error("Attempted to call CouponTable() from the server but CouponTable is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/home/user/studio/src/app/admin/coupons/_components/coupon-table.tsx","CouponTable")},77088:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>l,dynamic:()=>s});var n=r(37413),a=r(78963),i=r(73416),o=r(75706);let s="force-dynamic";async function l(){let e=await (0,i.w6)();return(0,n.jsx)("div",{className:"container mx-auto py-10",children:(0,n.jsxs)(a.Zp,{className:"mx-auto",children:[(0,n.jsxs)(a.aR,{children:[(0,n.jsx)(a.ZB,{children:"Manage Coupons"}),(0,n.jsx)(a.BT,{children:"View, activate/deactivate, and edit existing discount coupons."})]}),(0,n.jsx)(a.Wu,{children:e.length>0?(0,n.jsx)(o.CouponTable,{coupons:e}):(0,n.jsx)("p",{className:"text-center text-muted-foreground",children:"No coupons found."})})]})})}},79551:e=>{"use strict";e.exports=require("url")},81630:e=>{"use strict";e.exports=require("http")},83518:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),!function(e,t){for(var r in t)Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}(t,{revalidatePath:function(){return p},revalidateTag:function(){return d},unstable_expirePath:function(){return c},unstable_expireTag:function(){return u}});let n=r(84971),a=r(23496),i=r(46143),o=r(29294),s=r(63033),l=r(98479);function d(e){return f([e],`revalidateTag ${e}`)}function c(e,t){if(e.length>i.NEXT_CACHE_SOFT_TAG_MAX_LENGTH){console.warn(`Warning: expirePath received "${e}" which exceeded max length of ${i.NEXT_CACHE_SOFT_TAG_MAX_LENGTH}. See more info here https://nextjs.org/docs/app/api-reference/functions/unstable_expirePath`);return}let r=`${i.NEXT_CACHE_IMPLICIT_TAG_ID}${e}`;return t?r+=`${r.endsWith("/")?"":"/"}${t}`:(0,a.isDynamicRoute)(e)&&console.warn(`Warning: a dynamic page path "${e}" was passed to "expirePath", but the "type" parameter is missing. This has no effect by default, see more info here https://nextjs.org/docs/app/api-reference/functions/unstable_expirePath`),f([r],`unstable_expirePath ${e}`)}function u(...e){return f(e,`unstable_expireTag ${e.join(", ")}`)}function p(e,t){if(e.length>i.NEXT_CACHE_SOFT_TAG_MAX_LENGTH){console.warn(`Warning: revalidatePath received "${e}" which exceeded max length of ${i.NEXT_CACHE_SOFT_TAG_MAX_LENGTH}. See more info here https://nextjs.org/docs/app/api-reference/functions/revalidatePath`);return}let r=`${i.NEXT_CACHE_IMPLICIT_TAG_ID}${e}`;return t?r+=`${r.endsWith("/")?"":"/"}${t}`:(0,a.isDynamicRoute)(e)&&console.warn(`Warning: a dynamic page path "${e}" was passed to "revalidatePath", but the "type" parameter is missing. This has no effect by default, see more info here https://nextjs.org/docs/app/api-reference/functions/revalidatePath`),f([r],`revalidatePath ${e}`)}function f(e,t){let r=o.workAsyncStorage.getStore();if(!r||!r.incrementalCache)throw Object.defineProperty(Error(`Invariant: static generation store missing in ${t}`),"__NEXT_ERROR_CODE",{value:"E263",enumerable:!1,configurable:!0});let a=s.workUnitAsyncStorage.getStore();if(a){if("cache"===a.type)throw Object.defineProperty(Error(`Route ${r.route} used "${t}" inside a "use cache" which is unsupported. To ensure revalidation is performed consistently it must always happen outside of renders and cached functions. See more info here: https://nextjs.org/docs/app/building-your-application/rendering/static-and-dynamic#dynamic-rendering`),"__NEXT_ERROR_CODE",{value:"E181",enumerable:!1,configurable:!0});if("unstable-cache"===a.type)throw Object.defineProperty(Error(`Route ${r.route} used "${t}" inside a function cached with "unstable_cache(...)" which is unsupported. To ensure revalidation is performed consistently it must always happen outside of renders and cached functions. See more info here: https://nextjs.org/docs/app/building-your-application/rendering/static-and-dynamic#dynamic-rendering`),"__NEXT_ERROR_CODE",{value:"E306",enumerable:!1,configurable:!0});if("render"===a.phase)throw Object.defineProperty(Error(`Route ${r.route} used "${t}" during render which is unsupported. To ensure revalidation is performed consistently it must always happen outside of renders and cached functions. See more info here: https://nextjs.org/docs/app/building-your-application/rendering/static-and-dynamic#dynamic-rendering`),"__NEXT_ERROR_CODE",{value:"E7",enumerable:!1,configurable:!0});if("prerender"===a.type){let e=Object.defineProperty(Error(`Route ${r.route} used ${t} without first calling \`await connection()\`.`),"__NEXT_ERROR_CODE",{value:"E406",enumerable:!1,configurable:!0});(0,n.abortAndThrowOnSynchronousRequestDataAccess)(r.route,t,e,a)}else if("prerender-ppr"===a.type)(0,n.postponeWithTracking)(r.route,t,a.dynamicTracking);else if("prerender-legacy"===a.type){a.revalidate=0;let e=Object.defineProperty(new l.DynamicServerError(`Route ${r.route} couldn't be rendered statically because it used \`${t}\`. See more info here: https://nextjs.org/docs/messages/dynamic-server-error`),"__NEXT_ERROR_CODE",{value:"E558",enumerable:!1,configurable:!0});throw r.dynamicUsageDescription=t,r.dynamicUsageStack=e.stack,e}}for(let t of(r.revalidatedTags||(r.revalidatedTags=[]),e))r.revalidatedTags.includes(t)||r.revalidatedTags.push(t);r.pathWasRevalidated=!0}},85273:(e,t,r)=>{"use strict";r.r(t),r.d(t,{"00a91143391a7b5b620fd8f738d998ce7d8f3f99ff":()=>n.w6,"402b0ac8797fc8dc742193ae31de84cafa5fb309ae":()=>n.jD,"406f0622a8c3a95c29404a2207bc7315d08fc13f83":()=>n.qv,"409087d3070e438ffa19d87bd5e99d491eed83598b":()=>n.j3,"40bb5cdc53a4e487e5a6c959a899d282ce4fe42c63":()=>n.fm,"40f8f32dc620158fd945b5da35a0d3f848da605aaa":()=>n.Z_});var n=r(73416)},91645:e=>{"use strict";e.exports=require("net")},94735:e=>{"use strict";e.exports=require("events")},98511:(e,t,r)=>{Promise.resolve().then(r.bind(r,75706))}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[447,724,256,567,964,71,648,596,853,763],()=>r(246));module.exports=n})();