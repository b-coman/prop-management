{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 31, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/components/ui/button.tsx"],"sourcesContent":["import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst buttonVariants = cva(\n  \"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-primary text-primary-foreground hover:bg-primary/90\",\n        destructive:\n          \"bg-destructive text-destructive-foreground hover:bg-destructive/90\",\n        outline:\n          \"border border-input bg-background hover:bg-accent hover:text-accent-foreground\",\n        secondary:\n          \"bg-secondary text-secondary-foreground hover:bg-secondary/80\",\n        ghost: \"hover:bg-accent hover:text-accent-foreground\",\n        link: \"text-primary underline-offset-4 hover:underline\",\n      },\n      size: {\n        default: \"h-10 px-4 py-2\",\n        sm: \"h-9 rounded-md px-3\",\n        lg: \"h-11 rounded-md px-8\",\n        icon: \"h-10 w-10\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nexport interface ButtonProps\n  extends React.ButtonHTMLAttributes<HTMLButtonElement>,\n    VariantProps<typeof buttonVariants> {\n  asChild?: boolean\n}\n\nconst Button = React.forwardRef<HTMLButtonElement, ButtonProps>(\n  ({ className, variant, size, asChild = false, ...props }, ref) => {\n    const Comp = asChild ? Slot : \"button\"\n    return (\n      <Comp\n        className={cn(buttonVariants({ variant, size, className }))}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nButton.displayName = \"Button\"\n\nexport { Button, buttonVariants }\n"],"names":[],"mappings":";;;;;AAAA;AACA;AACA;AAEA;;;;;;AAEA,MAAM,iBAAiB,CAAA,GAAA,gKAAA,CAAA,MAAG,AAAD,EACvB,4VACA;IACE,UAAU;QACR,SAAS;YACP,SAAS;YACT,aACE;YACF,SACE;YACF,WACE;YACF,OAAO;YACP,MAAM;QACR;QACA,MAAM;YACJ,SAAS;YACT,IAAI;YACJ,IAAI;YACJ,MAAM;QACR;IACF;IACA,iBAAiB;QACf,SAAS;QACT,MAAM;IACR;AACF;AASF,MAAM,uBAAS,CAAA,GAAA,qMAAA,CAAA,aAAgB,AAAD,EAC5B,CAAC,EAAE,SAAS,EAAE,OAAO,EAAE,IAAI,EAAE,UAAU,KAAK,EAAE,GAAG,OAAO,EAAE;IACxD,MAAM,OAAO,UAAU,gKAAA,CAAA,OAAI,GAAG;IAC9B,qBACE,8OAAC;QACC,WAAW,CAAA,GAAA,mHAAA,CAAA,KAAE,AAAD,EAAE,eAAe;YAAE;YAAS;YAAM;QAAU;QACxD,KAAK;QACJ,GAAG,KAAK;;;;;;AAGf;AAEF,OAAO,WAAW,GAAG","debugId":null}},
    {"offset": {"line": 91, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/components/ui/sheet.tsx"],"sourcesContent":["\"use client\"\n\nimport * as React from \"react\"\nimport * as SheetPrimitive from \"@radix-ui/react-dialog\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Sheet = SheetPrimitive.Root\n\nconst SheetTrigger = SheetPrimitive.Trigger\n\nconst SheetClose = SheetPrimitive.Close\n\nconst SheetPortal = SheetPrimitive.Portal\n\nconst SheetOverlay = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nSheetOverlay.displayName = SheetPrimitive.Overlay.displayName\n\nconst sheetVariants = cva(\n  \"fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500\",\n  {\n    variants: {\n      side: {\n        top: \"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top\",\n        bottom:\n          \"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom\",\n        left: \"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm\",\n        right:\n          \"inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm\",\n      },\n    },\n    defaultVariants: {\n      side: \"right\",\n    },\n  }\n)\n\ninterface SheetContentProps\n  extends React.ComponentPropsWithoutRef<typeof SheetPrimitive.Content>,\n    VariantProps<typeof sheetVariants> {}\n\nconst SheetContent = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Content>,\n  SheetContentProps\n>(({ side = \"right\", className, children, ...props }, ref) => (\n  <SheetPortal>\n    <SheetOverlay />\n    <SheetPrimitive.Content\n      ref={ref}\n      className={cn(sheetVariants({ side }), className)}\n      {...props}\n    >\n      {children}\n      <SheetPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </SheetPrimitive.Close>\n    </SheetPrimitive.Content>\n  </SheetPortal>\n))\nSheetContent.displayName = SheetPrimitive.Content.displayName\n\nconst SheetHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetHeader.displayName = \"SheetHeader\"\n\nconst SheetFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetFooter.displayName = \"SheetFooter\"\n\nconst SheetTitle = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold text-foreground\", className)}\n    {...props}\n  />\n))\nSheetTitle.displayName = SheetPrimitive.Title.displayName\n\nconst SheetDescription = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nSheetDescription.displayName = SheetPrimitive.Description.displayName\n\nexport {\n  Sheet,\n  SheetPortal,\n  SheetOverlay,\n  SheetTrigger,\n  SheetClose,\n  SheetContent,\n  SheetHeader,\n  SheetFooter,\n  SheetTitle,\n  SheetDescription,\n}\n"],"names":[],"mappings":";;;;;;;;;;;;;AAEA;AACA;AACA;AACA;AAEA;AAPA;;;;;;;AASA,MAAM,QAAQ,kKAAA,CAAA,OAAmB;AAEjC,MAAM,eAAe,kKAAA,CAAA,UAAsB;AAE3C,MAAM,aAAa,kKAAA,CAAA,QAAoB;AAEvC,MAAM,cAAc,kKAAA,CAAA,SAAqB;AAEzC,MAAM,6BAAe,CAAA,GAAA,qMAAA,CAAA,aAAgB,AAAD,EAGlC,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,8OAAC,kKAAA,CAAA,UAAsB;QACrB,WAAW,CAAA,GAAA,mHAAA,CAAA,KAAE,AAAD,EACV,2JACA;QAED,GAAG,KAAK;QACT,KAAK;;;;;;AAGT,aAAa,WAAW,GAAG,kKAAA,CAAA,UAAsB,CAAC,WAAW;AAE7D,MAAM,gBAAgB,CAAA,GAAA,gKAAA,CAAA,MAAG,AAAD,EACtB,oMACA;IACE,UAAU;QACR,MAAM;YACJ,KAAK;YACL,QACE;YACF,MAAM;YACN,OACE;QACJ;IACF;IACA,iBAAiB;QACf,MAAM;IACR;AACF;AAOF,MAAM,6BAAe,CAAA,GAAA,qMAAA,CAAA,aAAgB,AAAD,EAGlC,CAAC,EAAE,OAAO,OAAO,EAAE,SAAS,EAAE,QAAQ,EAAE,GAAG,OAAO,EAAE,oBACpD,8OAAC;;0BACC,8OAAC;;;;;0BACD,8OAAC,kKAAA,CAAA,UAAsB;gBACrB,KAAK;gBACL,WAAW,CAAA,GAAA,mHAAA,CAAA,KAAE,AAAD,EAAE,cAAc;oBAAE;gBAAK,IAAI;gBACtC,GAAG,KAAK;;oBAER;kCACD,8OAAC,kKAAA,CAAA,QAAoB;wBAAC,WAAU;;0CAC9B,8OAAC,4LAAA,CAAA,IAAC;gCAAC,WAAU;;;;;;0CACb,8OAAC;gCAAK,WAAU;0CAAU;;;;;;;;;;;;;;;;;;;;;;;;AAKlC,aAAa,WAAW,GAAG,kKAAA,CAAA,UAAsB,CAAC,WAAW;AAE7D,MAAM,cAAc,CAAC,EACnB,SAAS,EACT,GAAG,OACkC,iBACrC,8OAAC;QACC,WAAW,CAAA,GAAA,mHAAA,CAAA,KAAE,AAAD,EACV,oDACA;QAED,GAAG,KAAK;;;;;;AAGb,YAAY,WAAW,GAAG;AAE1B,MAAM,cAAc,CAAC,EACnB,SAAS,EACT,GAAG,OACkC,iBACrC,8OAAC;QACC,WAAW,CAAA,GAAA,mHAAA,CAAA,KAAE,AAAD,EACV,iEACA;QAED,GAAG,KAAK;;;;;;AAGb,YAAY,WAAW,GAAG;AAE1B,MAAM,2BAAa,CAAA,GAAA,qMAAA,CAAA,aAAgB,AAAD,EAGhC,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,8OAAC,kKAAA,CAAA,QAAoB;QACnB,KAAK;QACL,WAAW,CAAA,GAAA,mHAAA,CAAA,KAAE,AAAD,EAAE,yCAAyC;QACtD,GAAG,KAAK;;;;;;AAGb,WAAW,WAAW,GAAG,kKAAA,CAAA,QAAoB,CAAC,WAAW;AAEzD,MAAM,iCAAmB,CAAA,GAAA,qMAAA,CAAA,aAAgB,AAAD,EAGtC,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,8OAAC,kKAAA,CAAA,cAA0B;QACzB,KAAK;QACL,WAAW,CAAA,GAAA,mHAAA,CAAA,KAAE,AAAD,EAAE,iCAAiC;QAC9C,GAAG,KAAK;;;;;;AAGb,iBAAiB,WAAW,GAAG,kKAAA,CAAA,cAA0B,CAAC,WAAW","debugId":null}},
    {"offset": {"line": 240, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/components/generic-header.tsx"],"sourcesContent":["\"use client\"; // Add 'use client' because we need hooks (useState, useEffect)\n\nimport { useState, useEffect } from 'react'; // Import hooks\nimport Link from 'next/link';\nimport { Button } from '@/components/ui/button';\nimport { Sheet, SheetContent, SheetTrigger } from '@/components/ui/sheet';\nimport { Menu, Home, MapPin, Image as ImageIcon, ListChecks } from 'lucide-react'; // Adjusted icons\nimport { cn } from '@/lib/utils'; // Import cn for conditional classes\n\ninterface HeaderProps {\n  propertyName: string;\n  propertySlug: string;\n}\n\nexport function Header({ propertyName, propertySlug }: HeaderProps) {\n  const basePath = `/properties/${propertySlug}`;\n  const [isScrolled, setIsScrolled] = useState(false);\n  const [hasMounted, setHasMounted] = useState(false); // State to track client mount\n\n  // Define menu items specific to the property page layout\n  const menuItems = [\n    { href: '#experience', label: 'Experience', icon: Home }, // Assuming section IDs exist\n    { href: '#features', label: 'Features', icon: ImageIcon },\n    { href: '#location', label: 'Location', icon: MapPin },\n    { href: '#rules', label: 'Rules', icon: ListChecks }, // Updated ID from house-rules\n    // Add more relevant links for the property page\n  ];\n\n  useEffect(() => {\n    setHasMounted(true); // Indicate client has mounted\n\n    const handleScroll = () => {\n      // Set state based on scroll position (e.g., scrolled more than 50px)\n      setIsScrolled(window.scrollY > 50);\n    };\n\n    // Add event listener\n    window.addEventListener('scroll', handleScroll);\n    // Call handler once initially after mount to set correct state\n    handleScroll();\n\n    // Clean up event listener\n    return () => window.removeEventListener('scroll', handleScroll);\n  }, []); // Empty dependency array ensures this runs once on mount\n\n  // Base classes applied on both server and initial client render\n  const baseHeaderClasses = \"fixed top-0 left-0 z-50 w-full transition-all duration-300 ease-in-out\";\n  const baseTextAndIconColor = \"transition-colors\";\n  const baseSpanColor = \"text-lg font-semibold transition-colors\";\n  const baseNavLink = \"text-sm font-medium transition-colors\";\n  const baseMobileTrigger = \"transition-colors\";\n\n  // Determine dynamic classes only after mount\n  const dynamicHeaderClasses = hasMounted && (isScrolled\n    ? \"bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60 border-b\" // Style when scrolled\n    : \"bg-black/50 border-transparent\"); // Initial style (transparent)\n\n  const dynamicTextAndIconColor = hasMounted && (isScrolled ? \"text-primary\" : \"text-white\");\n  const dynamicSpanColor = hasMounted && (isScrolled ? \"text-foreground\" : \"text-white\");\n  const dynamicNavLink = hasMounted && (isScrolled ? \"text-muted-foreground hover:text-foreground\" : \"text-white/80 hover:text-white\");\n  const dynamicBookNowButtonVariant = hasMounted && isScrolled ? \"default\" : \"secondary\";\n  const dynamicBookNowButtonClasses = hasMounted && !isScrolled ? \"text-primary bg-white hover:bg-gray-100\" : \"\";\n  const dynamicMobileTrigger = hasMounted && (isScrolled ? \"text-foreground hover:bg-accent\" : \"text-white hover:bg-white/10\");\n\n  return (\n    <header className={cn(baseHeaderClasses, dynamicHeaderClasses)}>\n      <div className=\"w-full px-4 flex h-16 items-center\">\n        <Link href={basePath} className=\"flex items-center gap-2\">\n          <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\" className={cn(\"h-6 w-6\", baseTextAndIconColor, dynamicTextAndIconColor)}>\n            <path d=\"M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z\"></path>\n            <polyline points=\"9 22 9 12 15 12 15 22\"></polyline>\n          </svg>\n          <span className={cn(baseSpanColor, dynamicSpanColor)}>{propertyName}</span>\n        </Link>\n\n        <nav className=\"ml-auto hidden items-center gap-6 md:flex\">\n          {menuItems.map(item => (\n            <Link\n              key={item.label}\n              href={item.href}\n              className={cn(baseNavLink, dynamicNavLink)}\n            >\n              {item.label}\n            </Link>\n          ))}\n          <Link href={`${basePath}#booking`} passHref>\n            <Button\n              size=\"sm\"\n              variant={dynamicBookNowButtonVariant}\n              className={dynamicBookNowButtonClasses}\n            >\n              Book Now\n            </Button>\n          </Link>\n        </nav>\n\n        <Sheet>\n          <SheetTrigger asChild className=\"md:hidden\">\n            <Button\n              variant=\"ghost\"\n              size=\"icon\"\n              className={cn(baseMobileTrigger, dynamicMobileTrigger)}\n            >\n              <Menu className=\"h-5 w-5\" />\n              <span className=\"sr-only\">Toggle Menu</span>\n            </Button>\n          </SheetTrigger>\n          <SheetContent side=\"right\" className=\"bg-background text-foreground\">\n            <Link href={basePath} className=\"flex items-center gap-2 mb-8\">\n              <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\" className=\"h-6 w-6 text-primary\">\n                <path d=\"M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z\"></path>\n                <polyline points=\"9 22 9 12 15 12 15 22\"></polyline>\n              </svg>\n              <span className=\"text-xl font-bold text-primary\">{propertyName}</span>\n            </Link>\n            <nav className=\"grid gap-6 text-lg font-medium\">\n              {menuItems.map(item => {\n                const Icon = item.icon;\n                return (\n                  <Link\n                    key={item.label}\n                    href={item.href}\n                    className=\"flex items-center gap-4 px-2.5 text-muted-foreground hover:text-foreground\"\n                  >\n                    <Icon className=\"h-5 w-5\" />\n                    {item.label}\n                  </Link>\n                );\n              })}\n            </nav>\n            <div className=\"mt-8\">\n              <Link href={`${basePath}#booking`} passHref>\n                <Button className=\"w-full\">Book Now</Button>\n              </Link>\n            </div>\n          </SheetContent>\n        </Sheet>\n      </div>\n    </header>\n  );\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 575, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/services/bookingService.ts"],"sourcesContent":["\n// src/services/bookingService.ts\n'use server';\n\nimport {\n  collection,\n  addDoc,\n  doc,\n  getDoc,\n  updateDoc,\n  query,\n  where,\n  getDocs,\n  serverTimestamp as clientServerTimestamp,\n  Timestamp as ClientTimestamp,\n  writeBatch as clientWriteBatch,\n  setDoc as clientSetDoc,\n  QueryConstraint,\n  limit,\n  documentId,\n} from 'firebase/firestore';\nimport { z } from 'zod';\nimport { db } from '@/lib/firebase';\nimport type { Booking, Availability, Property, SerializableTimestamp } from '@/types';\nimport { differenceInCalendarDays, eachDayOfInterval, format, parse, subDays, startOfMonth, endOfMonth, parseISO, startOfDay } from 'date-fns';\nimport { updateAirbnbListingAvailability, updateBookingComListingAvailability, getPropertyForSync } from './booking-sync';\n\n\n// --- Schemas (Keep Zod schemas for data validation if createBooking is still used elsewhere) ---\n\nexport type CreateBookingData = Omit<Booking,\n  'id' |\n  'checkInDate' |\n  'checkOutDate' |\n  'createdAt' |\n  'updatedAt' |\n  'paymentInfo' | // paymentInfo structure is defined separately now\n  'pricing'\n> & {\n  propertyId: string; // This is the property SLUG now\n  checkInDate: string; // ISO String\n  checkOutDate: string; // ISO String\n  pricing: {\n    baseRate: number;\n    numberOfNights: number;\n    cleaningFee: number;\n    extraGuestFee?: number;\n    numberOfExtraGuests?: number;\n    accommodationTotal: number;\n    subtotal: number;\n    taxes?: number;\n    discountAmount?: number;\n    total: number;\n  };\n  appliedCouponCode?: string;\n  // paymentInput is now handled by the webhook and updateBookingPaymentInfo\n  // status will likely be 'confirmed' when this is called by simulation/webhook\n  status?: Booking['status']; // Optional for flexibility, webhook should set 'confirmed'\n};\n\nconst CreateBookingDataSchema = z.object({\n  propertyId: z.string().min(1), // Property SLUG\n  guestInfo: z.object({\n    firstName: z.string().min(1),\n    lastName: z.string().optional(),\n    email: z.string().email(),\n    phone: z.string().optional(),\n    userId: z.string().optional(),\n  }).passthrough(),\n  checkInDate: z.string().refine(val => !isNaN(Date.parse(val))),\n  checkOutDate: z.string().refine(val => !isNaN(Date.parse(val))),\n  numberOfGuests: z.number().int().positive(),\n  pricing: z.object({\n    baseRate: z.number().nonnegative(),\n    numberOfNights: z.number().int().positive(),\n    cleaningFee: z.number().nonnegative(),\n    extraGuestFee: z.number().nonnegative().optional(),\n    numberOfExtraGuests: z.number().int().nonnegative().optional(),\n    accommodationTotal: z.number().nonnegative(),\n    subtotal: z.number().nonnegative(),\n    taxes: z.number().nonnegative().optional(),\n    discountAmount: z.number().nonnegative().optional(),\n    total: z.number().nonnegative(),\n  }).passthrough(),\n  appliedCouponCode: z.string().optional(),\n  status: z.enum(['pending', 'confirmed', 'cancelled', 'completed']).optional(),\n  // Removed paymentInput validation here, handled separately\n  notes: z.string().optional(),\n  source: z.string().optional(),\n  externalId: z.string().optional(),\n}).refine(data => new Date(data.checkOutDate) > new Date(data.checkInDate), {\n  message: 'Check-out date must be after check-in date.',\n  path: ['checkOutDate'],\n}).refine(data => {\n    const calculatedTotal = (data.pricing.subtotal ?? 0) + (data.pricing.taxes ?? 0) - (data.pricing.discountAmount ?? 0);\n    return Math.abs(calculatedTotal - data.pricing.total) < 0.01;\n}, {\n    message: 'Calculated total does not match provided total price.',\n    path: ['pricing.total'],\n});\n\n\n/**\n * Updates an existing booking (typically 'pending') with payment information\n * and sets its status to 'confirmed'. Called by the Stripe webhook.\n * Also updates property availability.\n *\n * @param bookingId The Firestore document ID of the booking to update.\n * @param paymentInfo The payment details from Stripe.\n * @param propertyId The slug of the property associated with the booking.\n */\nexport async function updateBookingPaymentInfo(\n    bookingId: string,\n    paymentInfo: Booking['paymentInfo'],\n    propertyId: string // Property Slug passed from webhook metadata\n): Promise<void> {\n    console.log(`--- [updateBookingPaymentInfo] Called for booking: ${bookingId}, property: ${propertyId} ---`);\n    if (!bookingId) {\n        throw new Error(\"Booking ID is required to update payment info.\");\n    }\n    if (!propertyId) {\n         throw new Error(\"Property ID (slug) is required to update payment info and availability.\");\n    }\n     if (!paymentInfo || !paymentInfo.stripePaymentIntentId || paymentInfo.status !== 'paid' && paymentInfo.status !== 'succeeded') {\n         console.warn(`[updateBookingPaymentInfo] Invalid or incomplete payment info for booking ${bookingId}. Status: ${paymentInfo?.status}`);\n        throw new Error(\"Valid payment information (status 'paid' or 'succeeded') is required.\");\n    }\n\n    const bookingRef = doc(db, 'bookings', bookingId);\n\n    try {\n        // Fetch the booking to get check-in/out dates for availability update\n        const bookingSnap = await getDoc(bookingRef);\n        if (!bookingSnap.exists()) {\n            console.error(`[updateBookingPaymentInfo] Booking ${bookingId} not found.`);\n            throw new Error(`Booking with ID ${bookingId} not found.`);\n        }\n        const bookingData = bookingSnap.data() as Booking; // Cast to Booking\n\n        // --- Security/Consistency Check ---\n        if (bookingData.propertyId !== propertyId) {\n             console.error(`[updateBookingPaymentInfo] Mismatch: Booking ${bookingId} propertyId (${bookingData.propertyId}) does not match webhook metadata propertyId (${propertyId}).`);\n             throw new Error(\"Property ID mismatch between booking and webhook metadata.\");\n        }\n\n\n        console.log(`[updateBookingPaymentInfo] Updating booking ${bookingId} status to 'confirmed' and adding payment details.`);\n        await updateDoc(bookingRef, {\n            status: 'confirmed',\n            paymentInfo: { // Merge with existing potentially, or overwrite\n                ...bookingData.paymentInfo, // Keep existing fields if any\n                ...paymentInfo, // Add/overwrite with new payment data\n                paidAt: paymentInfo.paidAt instanceof Date ? ClientTimestamp.fromDate(paymentInfo.paidAt) : clientServerTimestamp(), // Ensure Firestore Timestamp\n            },\n            updatedAt: clientServerTimestamp(),\n        });\n        console.log(`✅ [updateBookingPaymentInfo] Successfully updated booking ${bookingId} to confirmed.`);\n\n        // --- Update Property Availability ---\n        const checkInDate = bookingData.checkInDate instanceof ClientTimestamp\n            ? bookingData.checkInDate.toDate()\n            : bookingData.checkInDate ? new Date(bookingData.checkInDate as any) : null; // Handle different types\n        const checkOutDate = bookingData.checkOutDate instanceof ClientTimestamp\n            ? bookingData.checkOutDate.toDate()\n            : bookingData.checkOutDate ? new Date(bookingData.checkOutDate as any) : null;\n\n        if (checkInDate && checkOutDate) {\n             console.log(`[updateBookingPaymentInfo] Triggering availability update for property ${propertyId}, booking ${bookingId}`);\n            try {\n                // Use Client SDK to update availability\n                await updatePropertyAvailability(propertyId, checkInDate, checkOutDate, false);\n                console.log(`✅ [updateBookingPaymentInfo] Availability updated for property ${propertyId}.`);\n            } catch (availabilityError) {\n                 console.error(`❌ [updateBookingPaymentInfo] Failed to update availability for property ${propertyId} after confirming booking ${bookingId}:`, availabilityError);\n                 // Log but don't fail the whole process, booking is confirmed\n            }\n             // --- Trigger External Sync ---\n             // Move sync here, only sync AFTER booking is confirmed\n             console.log(`[updateBookingPaymentInfo] Triggering external sync for property ${propertyId}, booking ${bookingId}...`);\n             try {\n                 // Fetch property details using the slug (propertyId)\n                 const propertyDetails = await getPropertyForSync(propertyId);\n                 if (propertyDetails) {\n                     if (propertyDetails.channelIds?.airbnb) {\n                         await updateAirbnbListingAvailability(propertyDetails.channelIds.airbnb, false, checkInDate, checkOutDate);\n                     }\n                     if (propertyDetails.channelIds?.booking_com) {\n                         await updateBookingComListingAvailability(propertyDetails.channelIds.booking_com, false, checkInDate, checkOutDate);\n                     }\n                 } else {\n                     console.warn(`[updateBookingPaymentInfo Sync] Could not find property ${propertyId} for external sync.`);\n                 }\n             } catch (syncError) {\n                  console.error(`❌ [updateBookingPaymentInfo Sync] Error syncing externally for booking ${bookingId}:`, syncError);\n             }\n\n        } else {\n             console.warn(`[updateBookingPaymentInfo] Missing check-in/out dates for booking ${bookingId}. Cannot update availability.`);\n        }\n\n    } catch (error) {\n        console.error(`❌ [updateBookingPaymentInfo] Error updating booking ${bookingId}:`, error);\n        throw new Error(`Failed to update booking payment info: ${error instanceof Error ? error.message : String(error)}`);\n    }\n}\n\n\n/**\n * Creates a new confirmed booking document in Firestore (e.g., for simulations or direct creation).\n * NOTE: The primary flow now uses createPendingBookingAction followed by webhook confirmation.\n * This function might still be useful for the simulation button.\n * Uses Client SDK for Firestore operations.\n */\nexport async function createBooking(rawBookingData: CreateBookingData): Promise<string> {\n    // Validate that propertyId (slug) is present\n   if (!rawBookingData.propertyId) {\n     throw new Error(\"Missing propertyId (slug) in booking data.\");\n   }\n   const propertyId = rawBookingData.propertyId; // This is the SLUG\n\n   const paymentIntentId = (rawBookingData as any)?.paymentInput?.stripePaymentIntentId || 'N/A'; // Handle potential missing paymentInput\n   console.log(`--- [createBooking] Function called (likely simulation) for Payment Intent [${paymentIntentId}], Property [${propertyId}] ---`);\n   console.log(`[createBooking] Received raw data:`, JSON.stringify(rawBookingData, null, 2));\n\n   let bookingData: z.infer<typeof CreateBookingDataSchema>;\n\n   // Zod Validation\n   console.log(`[createBooking] Starting Zod validation for Payment Intent [${paymentIntentId}]...`);\n   const validationResult = CreateBookingDataSchema.safeParse(rawBookingData);\n   if (!validationResult.success) {\n     const errorMessages = validationResult.error.errors.map(e => `${e.path.join('.')}: ${e.message}`).join(', ');\n     const validationError = new Error(`Invalid booking data: ${errorMessages}`);\n     console.error(`❌ [createBooking] Validation Error:`, validationError.message);\n     throw validationError;\n   }\n   bookingData = validationResult.data; // Contains propertyId as slug\n   console.log(`[createBooking] Data passed validation for Payment Intent [${paymentIntentId}]`);\n\n\n  try {\n     console.log(`[createBooking] Entered main try block for Payment Intent [${paymentIntentId}]`);\n     const bookingsCollection = collection(db, 'bookings');\n\n     // Data Transformation\n     console.log(`[createBooking] Transforming data for Firestore for Payment Intent [${paymentIntentId}]...`);\n     const checkInDate = new Date(bookingData.checkInDate);\n     const checkOutDate = new Date(bookingData.checkOutDate);\n     const checkInTimestamp = ClientTimestamp.fromDate(checkInDate);\n     const checkOutTimestamp = ClientTimestamp.fromDate(checkOutDate);\n\n     // Construct PaymentInfo if paymentInput exists (for simulation)\n      let paymentInfo: Booking['paymentInfo'] | undefined = undefined;\n      if ((rawBookingData as any).paymentInput) {\n          const paymentInput = (rawBookingData as any).paymentInput;\n          paymentInfo = {\n              stripePaymentIntentId: paymentInput.stripePaymentIntentId || `simulated_${Date.now()}`,\n              amount: paymentInput.amount ?? bookingData.pricing.total,\n              status: paymentInput.status || 'succeeded',\n              paidAt: (paymentInput.status === 'succeeded' || paymentInput.status === 'paid')\n                  ? ClientTimestamp.now()\n                  : null,\n          };\n      } else {\n          // Create a default placeholder if no paymentInput provided (shouldn't happen in normal flow)\n           paymentInfo = {\n               stripePaymentIntentId: 'N/A',\n               amount: bookingData.pricing.total,\n               status: 'unknown', // Or 'confirmed' if assuming success?\n               paidAt: null,\n           };\n      }\n\n     // Construct the final booking document data\n     const docData: Omit<Booking, 'id'> = {\n         propertyId: bookingData.propertyId, // Store the SLUG\n         guestInfo: bookingData.guestInfo,\n         checkInDate: checkInTimestamp,\n         checkOutDate: checkOutTimestamp,\n         numberOfGuests: bookingData.numberOfGuests,\n         pricing: bookingData.pricing,\n         appliedCouponCode: bookingData.appliedCouponCode,\n         status: bookingData.status || 'confirmed', // Default to confirmed for direct creation/simulation\n         paymentInfo: paymentInfo,\n         notes: bookingData.notes,\n         source: bookingData.source || 'simulation', // Default source\n         externalId: bookingData.externalId,\n         createdAt: clientServerTimestamp(),\n         updatedAt: clientServerTimestamp(),\n     };\n\n      // Log prepared data (adjust Timestamp representation for readability)\n     console.log(`[createBooking] Firestore Doc Data Prepared for Payment Intent [${paymentIntentId}]:`, JSON.stringify({\n         ...docData,\n         checkInDate: `Timestamp(${checkInDate.toISOString()})`,\n         checkOutDate: `Timestamp(${checkOutDate.toISOString()})`,\n         paidAt: docData.paymentInfo.paidAt ? `Timestamp(${(docData.paymentInfo.paidAt as ClientTimestamp).toDate().toISOString()})` : null,\n         createdAt: 'ServerTimestamp',\n         updatedAt: 'ServerTimestamp'\n     }, null, 2));\n\n\n     // Firestore Operation (Client SDK)\n     console.log(`[createBooking] Attempting to add booking document to Firestore (Client SDK) for Payment Intent [${paymentIntentId}]...`);\n     const docRef = await addDoc(bookingsCollection, docData);\n     const bookingId = docRef.id;\n     console.log(`✅ [createBooking] Booking document created successfully! ID: ${bookingId} for Payment Intent [${paymentIntentId}]`);\n\n     // --- Update Property Availability (Client SDK) ---\n     console.log(`[createBooking] Triggering local availability update (Client SDK) for property ${propertyId}, booking ${bookingId}`);\n     try {\n       await updatePropertyAvailability(propertyId, checkInDate, checkOutDate, false);\n       console.log(`✅ [createBooking] Successfully finished update call for local availability for property ${propertyId}, booking ${bookingId}.`);\n     } catch (availabilityError) {\n       console.error(`❌ [createBooking] Failed to update local availability (Client SDK) for property ${propertyId} after creating booking ${bookingId}:`, availabilityError);\n       // Decide if this should block the entire process or just log a warning\n       // In simulation, maybe log and continue? For real bookings, re-throw.\n        // throw availabilityError; // Uncomment if availability update failure should halt creation\n        console.warn(`⚠️ [createBooking] Availability update failed, but booking ${bookingId} was created (source: ${docData.source}). Manual check needed.`);\n     }\n\n     // --- Synchronize Availability with External Platforms ---\n     // Skip sync for simulation/test bookings or handle differently if needed\n      if (docData.source !== 'simulation' && docData.source !== 'test-button') {\n          console.log(`[createBooking] Starting external platform sync for property ${propertyId}, booking ${bookingId}...`);\n          try {\n             // Fetch property details using the slug (propertyId)\n             const propertyDetails = await getPropertyForSync(propertyId);\n             if (propertyDetails) {\n                 if (propertyDetails.channelIds?.airbnb) {\n                     await updateAirbnbListingAvailability(propertyDetails.channelIds.airbnb, false, checkInDate, checkOutDate);\n                 }\n                 if (propertyDetails.channelIds?.booking_com) {\n                     await updateBookingComListingAvailability(propertyDetails.channelIds.booking_com, false, checkInDate, checkOutDate);\n                 }\n             } else {\n                  console.warn(`[createBooking Sync] Could not retrieve property details for ${propertyId} to perform external sync.`);\n             }\n         } catch (syncError) {\n             console.error(`❌ [createBooking Sync] Error synchronizing availability with external platforms for property ${propertyId} after creating booking ${bookingId}:`, syncError);\n         }\n     } else {\n          console.log(`[createBooking] Skipping external sync for booking source: ${docData.source}`);\n     }\n\n     console.log(`--- [createBooking] Function returning successfully with booking ID: ${bookingId} ---`);\n     return bookingId;\n\n   } catch (error) {\n      if (!(error instanceof Error && error.message.startsWith('Invalid booking data:'))) {\n          console.error(`❌ [createBooking] Error during booking creation process:`, error);\n      }\n     const errorMessage = error instanceof Error\n         ? (error.message.startsWith('Invalid booking data:') ? error.message : `Failed to create booking (Ref: ${paymentIntentId}). Please contact support.`)\n         : `An unexpected error occurred while creating the booking (Ref: ${paymentIntentId}). Please contact support.`;\n\n     throw new Error(errorMessage);\n   }\n }\n\n/**\n * Retrieves a booking document by its ID using the Client SDK.\n */\nexport async function getBookingById(bookingId: string): Promise<Booking | null> {\n    try {\n        const bookingRef = doc(db, 'bookings', bookingId); // Use Client SDK 'db'\n        const docSnap = await getDoc(bookingRef);\n\n        if (docSnap.exists()) {\n            const data = docSnap.data();\n            // Convert Timestamps if needed for client consumption, or keep as Timestamps\n            const bookingResult = {\n                id: docSnap.id,\n                ...data,\n                // Ensure propertyId is the slug\n                propertyId: data.propertyId,\n                checkInDate: data.checkInDate, // Client Timestamp\n                checkOutDate: data.checkOutDate, // Client Timestamp\n                createdAt: data.createdAt, // Client Timestamp\n                updatedAt: data.updatedAt, // Client Timestamp\n                 paymentInfo: {\n                    ...data.paymentInfo,\n                    paidAt: data.paymentInfo?.paidAt, // Client Timestamp or null\n                },\n            } as Booking;\n            return bookingResult;\n        } else {\n            console.warn(`[getBookingById] No booking found with ID: ${bookingId}`);\n            return null;\n        }\n    } catch (error) {\n        console.error(`❌ [getBookingById] Error fetching booking with ID ${bookingId}:`, error);\n        throw new Error(`Failed to fetch booking: ${error instanceof Error ? error.message : String(error)}`);\n    }\n}\n\n/**\n * Updates the status of a specific booking document using the Client SDK.\n * Calls updatePropertyAvailability (Client SDK) if status is 'cancelled'.\n */\nexport async function updateBookingStatus(bookingId: string, status: Booking['status']): Promise<void> {\n    try {\n        const bookingRef = doc(db, 'bookings', bookingId); // Use Client SDK 'db'\n        await updateDoc(bookingRef, {\n            status: status,\n            updatedAt: clientServerTimestamp(), // Use Client serverTimestamp\n        });\n        console.log(`✅ [updateBookingStatus] Successfully updated booking ${bookingId} to status: ${status}`);\n\n        if (status === 'cancelled') {\n          const booking = await getBookingById(bookingId); // Re-fetch using Client SDK\n          if (booking && booking.checkInDate && booking.checkOutDate) {\n             // propertyId is already the slug from getBookingById\n             const propertyId = booking.propertyId;\n            // Convert Client Timestamps back to Dates\n             const checkInDate = booking.checkInDate instanceof ClientTimestamp\n                ? booking.checkInDate.toDate()\n                : booking.checkInDate ? new Date(booking.checkInDate as any) : null;\n             const checkOutDate = booking.checkOutDate instanceof ClientTimestamp\n                ? booking.checkOutDate.toDate()\n                : booking.checkOutDate ? new Date(booking.checkOutDate as any) : null;\n\n             if (checkInDate && checkOutDate && propertyId) {\n                 try {\n                     // Make dates available again\n                     await updatePropertyAvailability(propertyId, checkInDate, checkOutDate, true);\n                     console.log(`✅ [updateBookingStatus] Successfully updated local availability (Client SDK) for cancelled booking ${bookingId}.`);\n\n                      // Trigger external sync to release dates\n                     await triggerExternalSyncForDateUpdate(propertyId, checkInDate, checkOutDate, true);\n\n                 } catch (availError) {\n                      console.error(`❌ [updateBookingStatus] Failed to update local availability or sync for cancelled booking ${bookingId}:`, availError);\n                 }\n             } else {\n                  console.warn(`[updateBookingStatus] Could not parse dates or missing propertyId for booking ${bookingId} to update availability after cancellation.`);\n             }\n          } else {\n             console.warn(`[updateBookingStatus] Could not find booking ${bookingId} or its dates to update availability after cancellation.`);\n          }\n        }\n\n    } catch (error) {\n        console.error(`❌ [updateBookingStatus] Error updating status for booking ${bookingId} (Client SDK):`, error);\n        throw new Error(`Failed to update booking status: ${error instanceof Error ? error.message : String(error)}`);\n    }\n}\n\n/**\n * Retrieves all bookings associated with a specific property slug using the Client SDK.\n */\nexport async function getBookingsForProperty(propertySlug: string): Promise<Booking[]> {\n    const bookings: Booking[] = [];\n    try {\n        const bookingsCollection = collection(db, 'bookings'); // Use Client SDK 'db'\n        // Query using the property slug\n        const q = query(bookingsCollection, where('propertyId', '==', propertySlug));\n        const querySnapshot = await getDocs(q);\n\n        querySnapshot.forEach((doc) => {\n            const data = doc.data();\n            bookings.push({\n                id: doc.id,\n                ...data,\n                propertyId: data.propertyId, // Should be the slug\n                checkInDate: data.checkInDate, // Client Timestamp\n                checkOutDate: data.checkOutDate, // Client Timestamp\n                createdAt: data.createdAt, // Client Timestamp\n                updatedAt: data.updatedAt, // Client Timestamp\n                 paymentInfo: {\n                    ...data.paymentInfo,\n                    paidAt: data.paymentInfo?.paidAt, // Client Timestamp or null\n                },\n            } as Booking);\n        });\n        return bookings;\n    } catch (error) {\n        console.error(`❌ [getBookingsForProperty] Error fetching bookings for property ${propertySlug}:`, error);\n        throw new Error(`Failed to fetch bookings for property: ${error instanceof Error ? error.message : String(error)}`);\n    }\n}\n\n/**\n * Retrieves all bookings associated with a specific user ID using the Client SDK.\n */\nexport async function getBookingsForUser(userId: string): Promise<Booking[]> {\n     const bookings: Booking[] = [];\n    try {\n        const bookingsCollection = collection(db, 'bookings'); // Use Client SDK 'db'\n        const q = query(bookingsCollection, where('guestInfo.userId', '==', userId));\n        const querySnapshot = await getDocs(q);\n\n        querySnapshot.forEach((doc) => {\n             const data = doc.data();\n             bookings.push({\n                 id: doc.id,\n                ...data,\n                propertyId: data.propertyId, // Should be the slug\n                checkInDate: data.checkInDate, // Client Timestamp\n                checkOutDate: data.checkOutDate, // Client Timestamp\n                createdAt: data.createdAt, // Client Timestamp\n                updatedAt: data.updatedAt, // Client Timestamp\n                 paymentInfo: {\n                    ...data.paymentInfo,\n                    paidAt: data.paymentInfo?.paidAt, // Client Timestamp or null\n                },\n             } as Booking);\n        });\n        return bookings;\n    } catch (error) {\n        console.error(`❌ [getBookingsForUser] Error fetching bookings for user ${userId}:`, error);\n        throw new Error(`Failed to fetch bookings for user: ${error instanceof Error ? error.message : String(error)}`);\n    }\n}\n\n/**\n * Updates the availability status for a given property and date range in Firestore\n * using the **Firebase Client SDK**. Requires appropriate security rules.\n * The propertyId parameter is expected to be the property slug.\n */\nexport async function updatePropertyAvailability(propertyId: string, checkInDate: Date, checkOutDate: Date, available: boolean): Promise<void> {\n  console.log(`--- [updatePropertyAvailability - CLIENT SDK] Function called ---`);\n  console.log(`[updatePropertyAvailability - CLIENT SDK] Args: propertyId=${propertyId} (slug), checkIn=${format(checkInDate, 'yyyy-MM-dd')}, checkOut=${format(checkOutDate, 'yyyy-MM-dd')} (exclusive), available=${available}`);\n\n  if (!db) {\n    console.error(\"❌ [updatePropertyAvailability - CLIENT SDK] Firestore Client SDK (db) is not initialized.\");\n    throw new Error(\"Firestore Client SDK is not initialized.\");\n  }\n\n  if (checkOutDate <= checkInDate) {\n    console.warn(`[updatePropertyAvailability] Check-out date (${format(checkOutDate, 'yyyy-MM-dd')}) must be after check-in date (${format(checkInDate, 'yyyy-MM-dd')}). No update performed.`);\n    return;\n  }\n\n  // Ensure dates are at the start of the day UTC for consistency\n  const start = startOfDay(checkInDate);\n  const end = startOfDay(subDays(checkOutDate, 1)); // Make checkout date exclusive\n\n  const datesToUpdate = eachDayOfInterval({ start, end });\n\n  if (datesToUpdate.length === 0) {\n    console.log(\"[updatePropertyAvailability - CLIENT SDK] No dates need updating.\");\n    return;\n  }\n  console.log(`[updatePropertyAvailability - CLIENT SDK] Dates to update (${datesToUpdate.length}): ${datesToUpdate.map(d => format(d, 'yyyy-MM-dd')).join(', ')}`);\n\n  const updatesByMonth: { [month: string]: { [day: number]: boolean } } = {};\n  datesToUpdate.forEach(date => {\n    const monthStr = format(date, 'yyyy-MM'); // Use UTC month\n    const dayOfMonth = date.getUTCDate(); // Use UTC day\n    if (!updatesByMonth[monthStr]) {\n      updatesByMonth[monthStr] = {};\n    }\n    updatesByMonth[monthStr][dayOfMonth] = available;\n  });\n  console.log(`[updatePropertyAvailability - CLIENT SDK] Updates grouped by month:`, JSON.stringify(updatesByMonth));\n\n  const batch = clientWriteBatch(db);\n  const availabilityCollection = collection(db, 'availability');\n  console.log(`[updatePropertyAvailability - CLIENT SDK] Initialized Firestore Client batch.`);\n\n  try {\n    const monthStrings = Object.keys(updatesByMonth);\n    console.log(`[updatePropertyAvailability - CLIENT SDK] Processing months: ${monthStrings.join(', ')}`);\n\n    if (monthStrings.length === 0) return;\n\n    // Generate document IDs using the property slug\n    const docIdsToFetch = monthStrings.map(monthStr => `${propertyId}_${monthStr}`);\n    console.log(`[updatePropertyAvailability - CLIENT SDK] Fetching existing availability docs for ${monthStrings.length} months...`);\n\n    // Firestore 'in' query limit is 30 values\n    const idBatches: string[][] = [];\n    for (let i = 0; i < docIdsToFetch.length; i += 30) {\n      idBatches.push(docIdsToFetch.slice(i, i + 30));\n    }\n\n    const fetchedDocsMap = new Map<string, Availability>();\n    await Promise.all(idBatches.map(async (batchIds) => {\n      if (batchIds.length === 0) return;\n      const q = query(availabilityCollection, where(documentId(), 'in', batchIds));\n      const querySnapshot = await getDocs(q);\n      querySnapshot.forEach(docSnap => {\n        if (docSnap.exists()) {\n          fetchedDocsMap.set(docSnap.id, { id: docSnap.id, ...docSnap.data() } as Availability);\n        }\n      });\n    }));\n    console.log(`[updatePropertyAvailability - CLIENT SDK] Fetched ${fetchedDocsMap.size} existing doc snapshots.`);\n\n    monthStrings.forEach(monthStr => {\n      const availabilityDocId = `${propertyId}_${monthStr}`; // Use slug in doc ID\n      console.log(`[updatePropertyAvailability Batch Prep] Processing month ${monthStr} (Doc ID: ${availabilityDocId}). Days: ${Object.keys(updatesByMonth[monthStr]).join(', ')}`);\n      const availabilityDocRef = doc(availabilityCollection, availabilityDocId);\n      const updatesForDay = updatesByMonth[monthStr];\n\n      const updatePayload: { [key: string]: any } = {};\n      for (const day in updatesForDay) {\n        updatePayload[`available.${String(day)}`] = updatesForDay[day];\n      }\n      updatePayload.updatedAt = clientServerTimestamp();\n      console.log(`[updatePropertyAvailability Batch Prep] Payload for ${availabilityDocId}:`, JSON.stringify({ ...updatePayload, updatedAt: 'ServerTimestamp' }));\n\n\n      const existingDoc = fetchedDocsMap.get(availabilityDocId);\n\n      if (existingDoc) {\n        console.log(`[updatePropertyAvailability Batch Prep] Doc ${availabilityDocId} exists. Adding UPDATE.`);\n        batch.update(availabilityDocRef, updatePayload);\n      } else {\n        console.log(`[updatePropertyAvailability Batch Prep] Doc ${availabilityDocId} DOES NOT exist. Creating initial.`);\n        const [year, month] = monthStr.split('-').map(Number);\n        const daysInMonth = new Date(year, month, 0).getDate();\n        const initialAvailableMap: { [day: number]: boolean } = {};\n        for (let day = 1; day <= daysInMonth; day++) {\n          initialAvailableMap[day] = updatesForDay[day] !== undefined ? updatesForDay[day] : true;\n        }\n\n        // When creating a new doc, ensure propertyId is the slug\n        const newDocData: Partial<Availability> = {\n          propertyId: propertyId, // Store slug here\n          month: monthStr,\n          available: initialAvailableMap,\n          updatedAt: clientServerTimestamp(),\n        };\n        console.log(`[updatePropertyAvailability Batch Prep] Adding SET (merge: true) for ${availabilityDocId}.`);\n        batch.set(availabilityDocRef, newDocData, { merge: true });\n      }\n    });\n\n    console.log(`[updatePropertyAvailability - CLIENT SDK] Committing client batch for property ${propertyId}...`);\n    await batch.commit();\n    console.log(`✅ [updatePropertyAvailability - CLIENT SDK] Batch committed for property ${propertyId}.`);\n    console.log(`--- [updatePropertyAvailability - CLIENT SDK] Function finished successfully ---`);\n\n  } catch (error) {\n    console.error(`❌ Error during Client SDK batch update/creation for property availability ${propertyId}:`, error);\n    console.log(`--- [updatePropertyAvailability - CLIENT SDK] Function throwing error ---`);\n    // Rethrow with a more specific message if it's a permission error\n     if (error instanceof Error && (error.message.includes('PERMISSION_DENIED') || error.message.includes('Missing or insufficient permissions'))) {\n        throw new Error(`Permission denied updating availability for property ${propertyId}. Check Firestore rules.`);\n     }\n    throw new Error(`Failed to update local property availability using Client SDK: ${error instanceof Error ? error.message : String(error)}`);\n  }\n}\n\n/**\n * Helper function to trigger external sync after availability update.\n * Expects propertyId to be the slug.\n */\nasync function triggerExternalSyncForDateUpdate(propertyId: string, checkInDate: Date, checkOutDate: Date, isAvailable: boolean): Promise<void> {\n    console.log(`[Sync Trigger] Syncing availability change for property ${propertyId} (slug) (${isAvailable ? 'Release' : 'Block'})`);\n     try {\n       // Fetch property using the slug\n       const propertyDetails = await getPropertyForSync(propertyId);\n       if (propertyDetails) {\n           if (propertyDetails.channelIds?.airbnb) {\n               await updateAirbnbListingAvailability(propertyDetails.channelIds.airbnb, isAvailable, checkInDate, checkOutDate);\n           }\n           if (propertyDetails.channelIds?.booking_com) {\n               await updateBookingComListingAvailability(propertyDetails.channelIds.booking_com, isAvailable, checkInDate, checkOutDate);\n           }\n       } else {\n           console.warn(`[Sync Trigger] Could not find property ${propertyId} for external sync.`);\n       }\n   } catch (syncError) {\n        console.error(`❌ [Sync Trigger] Error syncing externally for property ${propertyId}:`, syncError);\n   }\n}\n\n\n/**\n * Fetches all unavailable dates for a given property slug using the Client SDK.\n */\nexport async function getUnavailableDatesForProperty(propertySlug: string, monthsToFetch: number = 12): Promise<Date[]> {\n  const unavailableDates: Date[] = [];\n  console.log(`--- [getUnavailableDatesForProperty] Function called ---`);\n  console.log(`[getUnavailableDatesForProperty] Fetching for property ${propertySlug} for the next ${monthsToFetch} months.`);\n\n  if (!db) {\n      console.error(\"❌ [getUnavailableDatesForProperty] Firestore Client SDK (db) is not initialized.\");\n      return [];\n  }\n\n  const availabilityCollection = collection(db, 'availability');\n  const today = new Date();\n  const currentMonthStart = new Date(Date.UTC(today.getUTCFullYear(), today.getUTCMonth(), 1));\n\n\n  try {\n    const monthDocIds: string[] = [];\n    for (let i = 0; i < monthsToFetch; i++) {\n      const targetMonth = new Date(Date.UTC(currentMonthStart.getUTCFullYear(), currentMonthStart.getUTCMonth() + i, 1));\n      const monthStr = format(targetMonth, 'yyyy-MM');\n      // Use slug in document ID\n      monthDocIds.push(`${propertySlug}_${monthStr}`);\n    }\n\n     if (monthDocIds.length === 0) {\n        console.log(\"[getUnavailableDatesForProperty] No month document IDs to query.\");\n        return [];\n    }\n    console.log(`[getUnavailableDatesForProperty] Querying for document IDs: ${monthDocIds.join(', ')}`);\n\n    // Firestore 'in' query limit is 30 values\n    const queryBatches: string[][] = [];\n    for (let i = 0; i < monthDocIds.length; i += 30) {\n        queryBatches.push(monthDocIds.slice(i, i + 30));\n    }\n    console.log(`[getUnavailableDatesForProperty] Split into ${queryBatches.length} query batches due to 'in' operator limit.`);\n\n\n    const allQuerySnapshots = await Promise.all(\n      queryBatches.map(async (batchIds, index) => {\n          console.log(`[getUnavailableDatesForProperty] Executing query for batch ${index + 1}: ${batchIds.join(', ')}`);\n          const q = query(availabilityCollection, where(documentId(), 'in', batchIds));\n          return getDocs(q);\n      })\n    );\n    console.log(`[getUnavailableDatesForProperty] Fetched results from ${allQuerySnapshots.length} batches.`);\n\n    let docCount = 0;\n    allQuerySnapshots.forEach((querySnapshot, batchIndex) => {\n        console.log(`[getUnavailableDatesForProperty] Processing batch ${batchIndex + 1}: Found ${querySnapshot.docs.length} documents.`);\n         docCount += querySnapshot.docs.length;\n         querySnapshot.forEach((doc) => {\n            const data = doc.data() as Partial<Availability>;\n            const docId = doc.id;\n            // Ensure propertyId in document matches the requested slug\n             if (data.propertyId !== propertySlug) {\n                 console.warn(`[getUnavailableDates] Mismatch: Doc ${docId} has propertyId ${data.propertyId}, expected ${propertySlug}. Skipping.`);\n                 return;\n             }\n\n            const monthStr = data.month || docId.split('_')[1]; // Prefer data.month\n\n             if (!monthStr || !/^\\d{4}-\\d{2}$/.test(monthStr)) {\n                 console.warn(`[getUnavailableDates] Invalid month string for doc ${docId}. Skipping.`);\n                 return;\n             }\n\n            if (data.available && typeof data.available === 'object') {\n                const [year, monthIndex] = monthStr.split('-').map(num => parseInt(num, 10));\n                const month = monthIndex - 1; // JS months 0-indexed\n\n                for (const dayStr in data.available) {\n                    const day = parseInt(dayStr, 10);\n                    if (!isNaN(day) && data.available[day] === false) {\n                        try {\n                            // Construct date as UTC date\n                            const date = new Date(Date.UTC(year, month, day));\n                             // Double check date validity after creation\n                             if (date.getUTCFullYear() === year && date.getUTCMonth() === month && date.getUTCDate() === day) {\n                                const todayUtcStart = startOfDay(new Date()); // Compare against local start of today\n                                if (date >= todayUtcStart) {\n                                    unavailableDates.push(date);\n                                }\n                             } else {\n                                 console.warn(`[getUnavailableDates] Invalid date created for ${monthStr}-${dayStr}. Skipping.`);\n                             }\n                        } catch (dateError) {\n                             console.warn(`[getUnavailableDates] Error creating date ${monthStr}-${dayStr}:`, dateError);\n                        }\n                    }\n                }\n            }\n        });\n    });\n    console.log(`[getUnavailableDates] Processed ${docCount} total documents.`);\n\n    unavailableDates.sort((a, b) => a.getTime() - b.getTime());\n    console.log(`[getUnavailableDates] Found ${unavailableDates.length} unavailable dates for ${propertySlug}.`);\n    // console.log(`[getUnavailableDates] Returning sorted unavailable dates: ${unavailableDates.map(d => format(d, 'yyyy-MM-dd')).join(', ')}`);\n    console.log(`--- [getUnavailableDatesForProperty] Function finished successfully ---`);\n    return unavailableDates;\n\n  } catch (error) {\n    console.error(`❌ Error fetching unavailable dates for property ${propertySlug}:`, error);\n    console.log(`--- [getUnavailableDatesForProperty] Function finished with error ---`);\n    return [];\n  }\n}\n"],"names":[],"mappings":"AACA,iCAAiC;;;;;;;;;;;;;IA8GX;IAsGA;IAqJA;IAqCA;IAmDA;IAkCA;IAmCA;IA0JA","debugId":null}},
    {"offset": {"line": 602, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/services/couponService.ts"],"sourcesContent":["// src/services/couponService.ts\n'use server';\n\nimport { collection, doc, getDoc, Timestamp, where, query, getDocs, limit } from 'firebase/firestore';\nimport { db } from '@/lib/firebase'; // Client SDK Firestore instance\nimport type { Coupon, SerializableTimestamp } from '@/types';\nimport { parseISO, isWithinInterval, areIntervalsOverlapping } from 'date-fns';\nimport { sanitizeText } from '@/lib/sanitize'; // Import sanitizer\n\n// Helper function to convert SerializableTimestamp to Date or null\nconst toDate = (timestamp: SerializableTimestamp | undefined | null): Date | null => {\n  if (!timestamp) return null;\n  if (timestamp instanceof Date) return timestamp;\n  if (timestamp instanceof Timestamp) return timestamp.toDate();\n  if (typeof timestamp === 'string') {\n    try {\n      return parseISO(timestamp);\n    } catch {\n      return null;\n    }\n  }\n  if (typeof timestamp === 'number') {\n    return new Date(timestamp);\n  }\n  return null;\n};\n\nexport async function validateAndApplyCoupon(\n  couponCodeInput: string, // Renamed to avoid confusion with sanitized version\n  bookingCheckInDate: Date | null,\n  bookingCheckOutDate: Date | null,\n  propertyId?: string | null\n): Promise<{ discountPercentage?: number; error?: string }> {\n  const couponCode = sanitizeText(couponCodeInput); // Sanitize the input code\n\n  if (!couponCode) {\n    return { error: 'Coupon code cannot be empty.' };\n  }\n  if (!bookingCheckInDate || !bookingCheckOutDate || bookingCheckOutDate <= bookingCheckInDate) {\n    return { error: 'Valid booking dates are required to apply a coupon.' };\n  }\n\n  const couponCodeUpper = couponCode.toUpperCase();\n\n  try {\n    const couponsCollection = collection(db, 'coupons');\n    const q = query(couponsCollection, where('code', '==', couponCodeUpper), limit(1));\n    const querySnapshot = await getDocs(q);\n\n    if (querySnapshot.empty) {\n      console.warn(`[Coupon Service] Coupon code \"${couponCodeUpper}\" not found.`);\n      return { error: 'Invalid coupon code.' };\n    }\n\n    const couponDoc = querySnapshot.docs[0];\n    const couponData = couponDoc.data() as Coupon;\n\n    if (!couponData.isActive) {\n      console.warn(`[Coupon Service] Coupon code \"${couponCodeUpper}\" is not active.`);\n      return { error: 'Coupon code is no longer active.' };\n    }\n\n    const couponExpiryDate = toDate(couponData.validUntil);\n    const now = new Date();\n    const todayStart = new Date(now.getFullYear(), now.getMonth(), now.getDate());\n    if (couponExpiryDate && couponExpiryDate < todayStart) {\n      console.warn(`[Coupon Service] Coupon code \"${couponCodeUpper}\" has expired on ${couponExpiryDate.toISOString().split('T')[0]}.`);\n      return { error: 'Coupon code has expired.' };\n    }\n\n    if (typeof couponData.discount !== 'number' || couponData.discount <= 0 || couponData.discount > 100) {\n      console.error(`[Coupon Service] Invalid discount percentage (${couponData.discount}) for coupon \"${couponCodeUpper}\".`);\n      return { error: 'Invalid coupon configuration.' };\n    }\n\n    if (couponData.propertyId && propertyId && couponData.propertyId !== propertyId) {\n      console.warn(`[Coupon Service] Coupon \"${couponCodeUpper}\" is only valid for property ${couponData.propertyId}, but booking is for ${propertyId}.`);\n      return { error: 'Coupon is not valid for this property.' };\n    }\n    if (couponData.propertyId && !propertyId) {\n      console.warn(`[Coupon Service] Coupon \"${couponCodeUpper}\" requires a specific property, but none was provided for the booking.`);\n      return { error: 'Coupon requires a specific property.' };\n    }\n\n    const bookingValidFrom = toDate(couponData.bookingValidFrom);\n    const bookingValidUntil = toDate(couponData.bookingValidUntil);\n\n    if (bookingValidFrom && bookingCheckInDate < bookingValidFrom) {\n      console.warn(`[Coupon Service] Booking check-in (${bookingCheckInDate.toISOString().split('T')[0]}) is before coupon booking validity start (${bookingValidFrom.toISOString().split('T')[0]}) for \"${couponCodeUpper}\".`);\n      return { error: 'Coupon not valid for selected check-in date.' };\n    }\n\n    if (bookingValidUntil) {\n      const validityEndDate = new Date(bookingValidUntil.getFullYear(), bookingValidUntil.getMonth(), bookingValidUntil.getDate(), 23, 59, 59, 999);\n      if (bookingCheckInDate > validityEndDate) {\n        console.warn(`[Coupon Service] Booking check-in (${bookingCheckInDate.toISOString().split('T')[0]}) is after coupon booking validity end (${bookingValidUntil.toISOString().split('T')[0]}) for \"${couponCodeUpper}\".`);\n        return { error: 'Coupon not valid for selected check-in date.' };\n      }\n    }\n\n    if (couponData.exclusionPeriods && Array.isArray(couponData.exclusionPeriods)) {\n      const bookingInterval = { start: bookingCheckInDate, end: new Date(bookingCheckOutDate.getTime() - 1) };\n      for (const period of couponData.exclusionPeriods) {\n        const exclusionStart = toDate(period.start);\n        const exclusionEnd = toDate(period.end);\n        if (exclusionStart && exclusionEnd) {\n          const exclusionInterval = { start: exclusionStart, end: new Date(exclusionEnd.getFullYear(), exclusionEnd.getMonth(), exclusionEnd.getDate(), 23, 59, 59, 999)};\n          if (areIntervalsOverlapping(bookingInterval, exclusionInterval, { inclusive: true })) {\n            console.warn(`[Coupon Service] Booking dates (${bookingCheckInDate.toISOString().split('T')[0]} - ${bookingCheckOutDate.toISOString().split('T')[0]}) overlap with exclusion period (${exclusionStart.toISOString().split('T')[0]} - ${exclusionEnd.toISOString().split('T')[0]}) for \"${couponCodeUpper}\".`);\n            return { error: 'Coupon not valid for the selected dates due to an exclusion period.' };\n          }\n        } else {\n          console.warn(`[Coupon Service] Invalid exclusion period found for coupon \"${couponCodeUpper}\":`, period);\n        }\n      }\n    }\n\n    console.log(`[Coupon Service] Coupon code \"${couponCodeUpper}\" validated successfully for the booking dates. Discount: ${couponData.discount}%`);\n    return { discountPercentage: couponData.discount };\n  } catch (error) {\n    console.error(`❌ [Coupon Service] Error validating coupon code \"${couponCodeUpper}\":`, error);\n    return { error: 'Could not validate coupon code. Please try again.' };\n  }\n}\n"],"names":[],"mappings":"AAAA,gCAAgC;;;;;;IA2BV","debugId":null}},
    {"offset": {"line": 615, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/app/actions/booking-actions.ts"],"sourcesContent":["// src/app/actions/booking-actions.ts\n\"use server\";\n\nimport { z } from 'zod';\nimport { collection, addDoc, serverTimestamp, Timestamp } from 'firebase/firestore';\nimport { db } from '@/lib/firebase'; // Client SDK\nimport type { Booking, Property } from '@/types';\nimport { revalidatePath } from 'next/cache';\nimport { sanitizeEmail, sanitizePhone, sanitizeText } from '@/lib/sanitize'; // Import sanitizers\n\n// Schema for creating a PENDING booking\nconst CreatePendingBookingSchema = z.object({\n  propertyId: z.string().min(1), // This is the property SLUG now\n  guestInfo: z.object({\n    firstName: z.string().min(1, \"First name is required.\").transform(sanitizeText),\n    lastName: z.string().min(1, \"Last name is required.\").transform(sanitizeText),\n    email: z.string().email(\"Invalid email address.\").transform(sanitizeEmail),\n    phone: z.string().min(1, \"Phone number is required.\").transform(sanitizePhone),\n  }).passthrough(),\n  checkInDate: z.string().datetime(), // ISO string\n  checkOutDate: z.string().datetime(), // ISO string\n  numberOfGuests: z.number().int().positive(),\n  pricing: z.object({\n    baseRate: z.number().nonnegative(),\n    numberOfNights: z.number().int().positive(),\n    cleaningFee: z.number().nonnegative(),\n    extraGuestFee: z.number().nonnegative().optional(),\n    numberOfExtraGuests: z.number().int().nonnegative().optional(),\n    accommodationTotal: z.number().nonnegative(),\n    subtotal: z.number().nonnegative(),\n    taxes: z.number().nonnegative().optional(),\n    discountAmount: z.number().nonnegative().optional(),\n    total: z.number().nonnegative(),\n  }).passthrough(),\n  status: z.literal('pending'),\n  appliedCouponCode: z.string().trim().toUpperCase().nullable().optional().transform(val => val ? sanitizeText(val) : null),\n});\n\ntype CreatePendingBookingInput = z.infer<typeof CreatePendingBookingSchema>;\n\nexport async function createPendingBookingAction(\n  input: CreatePendingBookingInput\n): Promise<{ bookingId?: string; error?: string }> {\n  const validationResult = CreatePendingBookingSchema.safeParse(input);\n\n  if (!validationResult.success) {\n    const errorMessages = validationResult.error.errors.map(e => `${e.path.join('.')}: ${e.message}`).join(', ');\n    console.error(\"[Action createPendingBookingAction] Validation Error:\", errorMessages);\n    return { error: `Invalid pending booking data: ${errorMessages}` };\n  }\n\n  const {\n    propertyId,\n    guestInfo, // Already sanitized by Zod transform\n    checkInDate: checkInStr,\n    checkOutDate: checkOutStr,\n    numberOfGuests,\n    pricing,\n    status,\n    appliedCouponCode, // Already sanitized by Zod transform\n  } = validationResult.data;\n\n  try {\n    const bookingsCollection = collection(db, 'bookings');\n    const checkIn = new Date(checkInStr);\n    const checkOut = new Date(checkOutStr);\n\n    const bookingData: Omit<Booking, 'id' | 'paymentInfo'> = {\n      propertyId: propertyId,\n      guestInfo, // Sanitized guestInfo\n      checkInDate: Timestamp.fromDate(checkIn),\n      checkOutDate: Timestamp.fromDate(checkOut),\n      numberOfGuests,\n      pricing,\n      status: 'pending',\n      appliedCouponCode: appliedCouponCode ?? null, // Sanitized appliedCouponCode\n      createdAt: serverTimestamp(),\n      updatedAt: serverTimestamp(),\n      paymentInfo: {\n        stripePaymentIntentId: '',\n        amount: pricing.total,\n        status: 'pending',\n        paidAt: null,\n      },\n      source: 'website-pending',\n    };\n\n    const docRef = await addDoc(bookingsCollection, bookingData);\n    return { bookingId: docRef.id };\n  } catch (error) {\n    console.error(`❌ [Action createPendingBookingAction] Error creating pending booking:`, error);\n    const errorMessage = error instanceof Error ? error.message : String(error);\n    if (errorMessage.includes('PERMISSION_DENIED')) {\n      return { error: 'Permission denied. Could not create pending booking.' };\n    }\n    if (errorMessage.includes('invalid data') || errorMessage.includes('Unsupported field value')) {\n      return { error: `Failed to create pending booking due to invalid data. Please check input values. Details: ${errorMessage.split(' (')[0]}` };\n    }\n    return { error: `Failed to create pending booking: ${errorMessage}` };\n  }\n}\n"],"names":[],"mappings":"AAAA,qCAAqC;;;;;;IAwCf","debugId":null}},
    {"offset": {"line": 628, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/components/ui/checkbox.tsx"],"sourcesContent":["\"use client\"\n\nimport * as React from \"react\"\nimport * as CheckboxPrimitive from \"@radix-ui/react-checkbox\"\nimport { Check } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Checkbox = React.forwardRef<\n  React.ElementRef<typeof CheckboxPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof CheckboxPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <CheckboxPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground\",\n      className\n    )}\n    {...props}\n  >\n    <CheckboxPrimitive.Indicator\n      className={cn(\"flex items-center justify-center text-current\")}\n    >\n      <Check className=\"h-4 w-4\" />\n    </CheckboxPrimitive.Indicator>\n  </CheckboxPrimitive.Root>\n))\nCheckbox.displayName = CheckboxPrimitive.Root.displayName\n\nexport { Checkbox }\n"],"names":[],"mappings":";;;;AAEA;AACA;AACA;AAEA;AANA;;;;;;AAQA,MAAM,yBAAW,CAAA,GAAA,qMAAA,CAAA,aAAgB,AAAD,EAG9B,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,8OAAC,oKAAA,CAAA,OAAsB;QACrB,KAAK;QACL,WAAW,CAAA,GAAA,mHAAA,CAAA,KAAE,AAAD,EACV,kTACA;QAED,GAAG,KAAK;kBAET,cAAA,8OAAC,oKAAA,CAAA,YAA2B;YAC1B,WAAW,CAAA,GAAA,mHAAA,CAAA,KAAE,AAAD,EAAE;sBAEd,cAAA,8OAAC,oMAAA,CAAA,QAAK;gBAAC,WAAU;;;;;;;;;;;;;;;;AAIvB,SAAS,WAAW,GAAG,oKAAA,CAAA,OAAsB,CAAC,WAAW","debugId":null}},
    {"offset": {"line": 673, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/components/ui/card.tsx"],"sourcesContent":["import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Card = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"rounded-lg border bg-card text-card-foreground shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n))\nCard.displayName = \"Card\"\n\nconst CardHeader = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex flex-col space-y-1.5 p-6\", className)}\n    {...props}\n  />\n))\nCardHeader.displayName = \"CardHeader\"\n\nconst CardTitle = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"text-2xl font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nCardTitle.displayName = \"CardTitle\"\n\nconst CardDescription = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nCardDescription.displayName = \"CardDescription\"\n\nconst CardContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"p-6 pt-0\", className)} {...props} />\n))\nCardContent.displayName = \"CardContent\"\n\nconst CardFooter = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex items-center p-6 pt-0\", className)}\n    {...props}\n  />\n))\nCardFooter.displayName = \"CardFooter\"\n\nexport { Card, CardHeader, CardFooter, CardTitle, CardDescription, CardContent }\n"],"names":[],"mappings":";;;;;;;;;AAAA;AAEA;;;;AAEA,MAAM,qBAAO,CAAA,GAAA,qMAAA,CAAA,aAAgB,AAAD,EAG1B,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,8OAAC;QACC,KAAK;QACL,WAAW,CAAA,GAAA,mHAAA,CAAA,KAAE,AAAD,EACV,4DACA;QAED,GAAG,KAAK;;;;;;AAGb,KAAK,WAAW,GAAG;AAEnB,MAAM,2BAAa,CAAA,GAAA,qMAAA,CAAA,aAAgB,AAAD,EAGhC,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,8OAAC;QACC,KAAK;QACL,WAAW,CAAA,GAAA,mHAAA,CAAA,KAAE,AAAD,EAAE,iCAAiC;QAC9C,GAAG,KAAK;;;;;;AAGb,WAAW,WAAW,GAAG;AAEzB,MAAM,0BAAY,CAAA,GAAA,qMAAA,CAAA,aAAgB,AAAD,EAG/B,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,8OAAC;QACC,KAAK;QACL,WAAW,CAAA,GAAA,mHAAA,CAAA,KAAE,AAAD,EACV,sDACA;QAED,GAAG,KAAK;;;;;;AAGb,UAAU,WAAW,GAAG;AAExB,MAAM,gCAAkB,CAAA,GAAA,qMAAA,CAAA,aAAgB,AAAD,EAGrC,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,8OAAC;QACC,KAAK;QACL,WAAW,CAAA,GAAA,mHAAA,CAAA,KAAE,AAAD,EAAE,iCAAiC;QAC9C,GAAG,KAAK;;;;;;AAGb,gBAAgB,WAAW,GAAG;AAE9B,MAAM,4BAAc,CAAA,GAAA,qMAAA,CAAA,aAAgB,AAAD,EAGjC,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,8OAAC;QAAI,KAAK;QAAK,WAAW,CAAA,GAAA,mHAAA,CAAA,KAAE,AAAD,EAAE,YAAY;QAAa,GAAG,KAAK;;;;;;AAEhE,YAAY,WAAW,GAAG;AAE1B,MAAM,2BAAa,CAAA,GAAA,qMAAA,CAAA,aAAgB,AAAD,EAGhC,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,8OAAC;QACC,KAAK;QACL,WAAW,CAAA,GAAA,mHAAA,CAAA,KAAE,AAAD,EAAE,8BAA8B;QAC3C,GAAG,KAAK;;;;;;AAGb,WAAW,WAAW,GAAG","debugId":null}},
    {"offset": {"line": 754, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/components/ui/separator.tsx"],"sourcesContent":["\"use client\"\n\nimport * as React from \"react\"\nimport * as SeparatorPrimitive from \"@radix-ui/react-separator\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Separator = React.forwardRef<\n  React.ElementRef<typeof SeparatorPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SeparatorPrimitive.Root>\n>(\n  (\n    { className, orientation = \"horizontal\", decorative = true, ...props },\n    ref\n  ) => (\n    <SeparatorPrimitive.Root\n      ref={ref}\n      decorative={decorative}\n      orientation={orientation}\n      className={cn(\n        \"shrink-0 bg-border\",\n        orientation === \"horizontal\" ? \"h-[1px] w-full\" : \"h-full w-[1px]\",\n        className\n      )}\n      {...props}\n    />\n  )\n)\nSeparator.displayName = SeparatorPrimitive.Root.displayName\n\nexport { Separator }\n"],"names":[],"mappings":";;;;AAEA;AACA;AAEA;AALA;;;;;AAOA,MAAM,0BAAY,CAAA,GAAA,qMAAA,CAAA,aAAgB,AAAD,EAI/B,CACE,EAAE,SAAS,EAAE,cAAc,YAAY,EAAE,aAAa,IAAI,EAAE,GAAG,OAAO,EACtE,oBAEA,8OAAC,qKAAA,CAAA,OAAuB;QACtB,KAAK;QACL,YAAY;QACZ,aAAa;QACb,WAAW,CAAA,GAAA,mHAAA,CAAA,KAAE,AAAD,EACV,sBACA,gBAAgB,eAAe,mBAAmB,kBAClD;QAED,GAAG,KAAK;;;;;;AAIf,UAAU,WAAW,GAAG,qKAAA,CAAA,OAAuB,CAAC,WAAW","debugId":null}},
    {"offset": {"line": 785, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/components/ui/input.tsx"],"sourcesContent":["import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Input = React.forwardRef<HTMLInputElement, React.ComponentProps<\"input\">>(\n  ({ className, type, ...props }, ref) => {\n    return (\n      <input\n        type={type}\n        className={cn(\n          \"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n          className\n        )}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nInput.displayName = \"Input\"\n\nexport { Input }\n"],"names":[],"mappings":";;;;AAAA;AAEA;;;;AAEA,MAAM,sBAAQ,CAAA,GAAA,qMAAA,CAAA,aAAgB,AAAD,EAC3B,CAAC,EAAE,SAAS,EAAE,IAAI,EAAE,GAAG,OAAO,EAAE;IAC9B,qBACE,8OAAC;QACC,MAAM;QACN,WAAW,CAAA,GAAA,mHAAA,CAAA,KAAE,AAAD,EACV,kYACA;QAEF,KAAK;QACJ,GAAG,KAAK;;;;;;AAGf;AAEF,MAAM,WAAW,GAAG","debugId":null}},
    {"offset": {"line": 814, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/components/ui/label.tsx"],"sourcesContent":["\"use client\"\n\nimport * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst labelVariants = cva(\n  \"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70\"\n)\n\nconst Label = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root> &\n    VariantProps<typeof labelVariants>\n>(({ className, ...props }, ref) => (\n  <LabelPrimitive.Root\n    ref={ref}\n    className={cn(labelVariants(), className)}\n    {...props}\n  />\n))\nLabel.displayName = LabelPrimitive.Root.displayName\n\nexport { Label }\n"],"names":[],"mappings":";;;;AAEA;AACA;AACA;AAEA;AANA;;;;;;AAQA,MAAM,gBAAgB,CAAA,GAAA,gKAAA,CAAA,MAAG,AAAD,EACtB;AAGF,MAAM,sBAAQ,CAAA,GAAA,qMAAA,CAAA,aAAgB,AAAD,EAI3B,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,8OAAC,iKAAA,CAAA,OAAmB;QAClB,KAAK;QACL,WAAW,CAAA,GAAA,mHAAA,CAAA,KAAE,AAAD,EAAE,iBAAiB;QAC9B,GAAG,KAAK;;;;;;AAGb,MAAM,WAAW,GAAG,iKAAA,CAAA,OAAmB,CAAC,WAAW","debugId":null}},
    {"offset": {"line": 846, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/components/ui/radio-group.tsx"],"sourcesContent":["\"use client\"\n\nimport * as React from \"react\"\nimport * as RadioGroupPrimitive from \"@radix-ui/react-radio-group\"\nimport { Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst RadioGroup = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Root\n      className={cn(\"grid gap-2\", className)}\n      {...props}\n      ref={ref}\n    />\n  )\n})\nRadioGroup.displayName = RadioGroupPrimitive.Root.displayName\n\nconst RadioGroupItem = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Item>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        \"aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    >\n      <RadioGroupPrimitive.Indicator className=\"flex items-center justify-center\">\n        <Circle className=\"h-2.5 w-2.5 fill-current text-current\" />\n      </RadioGroupPrimitive.Indicator>\n    </RadioGroupPrimitive.Item>\n  )\n})\nRadioGroupItem.displayName = RadioGroupPrimitive.Item.displayName\n\nexport { RadioGroup, RadioGroupItem }\n"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;AAEA;AANA;;;;;;AAQA,MAAM,2BAAa,CAAA,GAAA,qMAAA,CAAA,aAAgB,AAAD,EAGhC,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE;IAC1B,qBACE,8OAAC,0KAAA,CAAA,OAAwB;QACvB,WAAW,CAAA,GAAA,mHAAA,CAAA,KAAE,AAAD,EAAE,cAAc;QAC3B,GAAG,KAAK;QACT,KAAK;;;;;;AAGX;AACA,WAAW,WAAW,GAAG,0KAAA,CAAA,OAAwB,CAAC,WAAW;AAE7D,MAAM,+BAAiB,CAAA,GAAA,qMAAA,CAAA,aAAgB,AAAD,EAGpC,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE;IAC1B,qBACE,8OAAC,0KAAA,CAAA,OAAwB;QACvB,KAAK;QACL,WAAW,CAAA,GAAA,mHAAA,CAAA,KAAE,AAAD,EACV,4OACA;QAED,GAAG,KAAK;kBAET,cAAA,8OAAC,0KAAA,CAAA,YAA6B;YAAC,WAAU;sBACvC,cAAA,8OAAC,sMAAA,CAAA,SAAM;gBAAC,WAAU;;;;;;;;;;;;;;;;AAI1B;AACA,eAAe,WAAW,GAAG,0KAAA,CAAA,OAAwB,CAAC,WAAW","debugId":null}},
    {"offset": {"line": 906, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/components/ui/alert.tsx"],"sourcesContent":["import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst alertVariants = cva(\n  \"relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-background text-foreground\",\n        destructive:\n          \"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Alert = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & VariantProps<typeof alertVariants>\n>(({ className, variant, ...props }, ref) => (\n  <div\n    ref={ref}\n    role=\"alert\"\n    className={cn(alertVariants({ variant }), className)}\n    {...props}\n  />\n))\nAlert.displayName = \"Alert\"\n\nconst AlertTitle = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLHeadingElement>\n>(({ className, ...props }, ref) => (\n  <h5\n    ref={ref}\n    className={cn(\"mb-1 font-medium leading-none tracking-tight\", className)}\n    {...props}\n  />\n))\nAlertTitle.displayName = \"AlertTitle\"\n\nconst AlertDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm [&_p]:leading-relaxed\", className)}\n    {...props}\n  />\n))\nAlertDescription.displayName = \"AlertDescription\"\n\nexport { Alert, AlertTitle, AlertDescription }\n"],"names":[],"mappings":";;;;;;AAAA;AACA;AAEA;;;;;AAEA,MAAM,gBAAgB,CAAA,GAAA,gKAAA,CAAA,MAAG,AAAD,EACtB,6JACA;IACE,UAAU;QACR,SAAS;YACP,SAAS;YACT,aACE;QACJ;IACF;IACA,iBAAiB;QACf,SAAS;IACX;AACF;AAGF,MAAM,sBAAQ,CAAA,GAAA,qMAAA,CAAA,aAAgB,AAAD,EAG3B,CAAC,EAAE,SAAS,EAAE,OAAO,EAAE,GAAG,OAAO,EAAE,oBACnC,8OAAC;QACC,KAAK;QACL,MAAK;QACL,WAAW,CAAA,GAAA,mHAAA,CAAA,KAAE,AAAD,EAAE,cAAc;YAAE;QAAQ,IAAI;QACzC,GAAG,KAAK;;;;;;AAGb,MAAM,WAAW,GAAG;AAEpB,MAAM,2BAAa,CAAA,GAAA,qMAAA,CAAA,aAAgB,AAAD,EAGhC,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,8OAAC;QACC,KAAK;QACL,WAAW,CAAA,GAAA,mHAAA,CAAA,KAAE,AAAD,EAAE,gDAAgD;QAC7D,GAAG,KAAK;;;;;;AAGb,WAAW,WAAW,GAAG;AAEzB,MAAM,iCAAmB,CAAA,GAAA,qMAAA,CAAA,aAAgB,AAAD,EAGtC,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,8OAAC;QACC,KAAK;QACL,WAAW,CAAA,GAAA,mHAAA,CAAA,KAAE,AAAD,EAAE,iCAAiC;QAC9C,GAAG,KAAK;;;;;;AAGb,iBAAiB,WAAW,GAAG","debugId":null}},
    {"offset": {"line": 970, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/components/ui/calendar.tsx"],"sourcesContent":["\"use client\"\n\nimport * as React from \"react\"\nimport { ChevronLeft, ChevronRight } from \"lucide-react\"\nimport { DayPicker } from \"react-day-picker\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nexport type CalendarProps = React.ComponentProps<typeof DayPicker>\n\nfunction Calendar({\n  className,\n  classNames,\n  showOutsideDays = true,\n  ...props\n}: CalendarProps) {\n  return (\n    <DayPicker\n      showOutsideDays={showOutsideDays}\n      className={cn(\"p-3\", className)}\n      classNames={{\n        months: \"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0\",\n        month: \"space-y-4\",\n        caption: \"flex justify-center pt-1 relative items-center\",\n        caption_label: \"text-sm font-medium\",\n        nav: \"space-x-1 flex items-center\",\n        nav_button: cn(\n          buttonVariants({ variant: \"outline\" }),\n          \"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100\"\n        ),\n        nav_button_previous: \"absolute left-1\",\n        nav_button_next: \"absolute right-1\",\n        table: \"w-full border-collapse space-y-1\",\n        head_row: \"flex\",\n        head_cell:\n          \"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]\",\n        row: \"flex w-full mt-2\",\n        cell: \"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20\",\n        day: cn(\n          buttonVariants({ variant: \"ghost\" }),\n          \"h-9 w-9 p-0 font-normal aria-selected:opacity-100\"\n        ),\n        day_range_end: \"day-range-end\",\n        day_selected:\n          \"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground\",\n        day_today: \"bg-accent text-accent-foreground\",\n        day_outside:\n          \"day-outside text-muted-foreground aria-selected:bg-accent/50 aria-selected:text-muted-foreground\",\n        day_disabled: \"text-muted-foreground opacity-50\",\n        day_range_middle:\n          \"aria-selected:bg-accent aria-selected:text-accent-foreground\",\n        day_hidden: \"invisible\",\n        ...classNames,\n      }}\n      components={{\n        IconLeft: ({ className, ...props }) => (\n          <ChevronLeft className={cn(\"h-4 w-4\", className)} {...props} />\n        ),\n        IconRight: ({ className, ...props }) => (\n          <ChevronRight className={cn(\"h-4 w-4\", className)} {...props} />\n        ),\n      }}\n      {...props}\n    />\n  )\n}\nCalendar.displayName = \"Calendar\"\n\nexport { Calendar }\n"],"names":[],"mappings":";;;;AAGA;AAAA;AACA;AAEA;AACA;AAPA;;;;;;AAWA,SAAS,SAAS,EAChB,SAAS,EACT,UAAU,EACV,kBAAkB,IAAI,EACtB,GAAG,OACW;IACd,qBACE,8OAAC,8JAAA,CAAA,YAAS;QACR,iBAAiB;QACjB,WAAW,CAAA,GAAA,mHAAA,CAAA,KAAE,AAAD,EAAE,OAAO;QACrB,YAAY;YACV,QAAQ;YACR,OAAO;YACP,SAAS;YACT,eAAe;YACf,KAAK;YACL,YAAY,CAAA,GAAA,mHAAA,CAAA,KAAE,AAAD,EACX,CAAA,GAAA,kIAAA,CAAA,iBAAc,AAAD,EAAE;gBAAE,SAAS;YAAU,IACpC;YAEF,qBAAqB;YACrB,iBAAiB;YACjB,OAAO;YACP,UAAU;YACV,WACE;YACF,KAAK;YACL,MAAM;YACN,KAAK,CAAA,GAAA,mHAAA,CAAA,KAAE,AAAD,EACJ,CAAA,GAAA,kIAAA,CAAA,iBAAc,AAAD,EAAE;gBAAE,SAAS;YAAQ,IAClC;YAEF,eAAe;YACf,cACE;YACF,WAAW;YACX,aACE;YACF,cAAc;YACd,kBACE;YACF,YAAY;YACZ,GAAG,UAAU;QACf;QACA,YAAY;YACV,UAAU,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,iBAChC,8OAAC,oNAAA,CAAA,cAAW;oBAAC,WAAW,CAAA,GAAA,mHAAA,CAAA,KAAE,AAAD,EAAE,WAAW;oBAAa,GAAG,KAAK;;;;;;YAE7D,WAAW,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,iBACjC,8OAAC,sNAAA,CAAA,eAAY;oBAAC,WAAW,CAAA,GAAA,mHAAA,CAAA,KAAE,AAAD,EAAE,WAAW;oBAAa,GAAG,KAAK;;;;;;QAEhE;QACC,GAAG,KAAK;;;;;;AAGf;AACA,SAAS,WAAW,GAAG","debugId":null}},
    {"offset": {"line": 1050, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/components/booking/availability-calendar.tsx"],"sourcesContent":["\"use client\";\n\nimport * as React from 'react';\nimport { Calendar } from \"@/components/ui/calendar\";\nimport type { DateRange } from 'react-day-picker';\nimport { cn } from '@/lib/utils';\nimport { format, startOfDay, subMonths } from 'date-fns'; // Import subMonths\n\ninterface AvailabilityCalendarProps {\n  currentMonth: Date; // The month to center around (usually based on check-in date)\n  unavailableDates: Date[];\n  selectedRange?: DateRange;\n  // numberOfMonths removed, always 3 now\n  onDateClick?: (date: Date) => void; // Optional callback for clicking a date\n}\n\nexport function AvailabilityCalendar({\n  currentMonth,\n  unavailableDates,\n  selectedRange,\n  onDateClick,\n}: AvailabilityCalendarProps) {\n\n  const disabledDays = [\n    { before: startOfDay(new Date()) }, // Disable dates before today\n    ...unavailableDates.map(date => startOfDay(date)), // Disable specific unavailable dates\n  ];\n\n  // Modifiers to style specific date types\n  const modifiers = {\n    unavailable: unavailableDates.map(date => startOfDay(date)),\n    selected: selectedRange ? { from: selectedRange.from ? startOfDay(selectedRange.from) : undefined, to: selectedRange.to ? startOfDay(selectedRange.to): undefined } : undefined,\n  };\n\n  // Modifier styles\n  const modifierStyles = {\n    unavailable: {\n        textDecoration: 'line-through',\n        color: 'hsl(var(--muted-foreground))',\n        opacity: 0.6,\n        pointerEvents: 'none' as const, // Make unavailable dates unclickable\n    },\n    selected: {\n        backgroundColor: 'hsl(var(--primary) / 0.2)', // Light primary background\n        fontWeight: 'bold',\n        color: 'hsl(var(--primary))',\n    },\n     // Style for today\n    today: {\n        fontWeight: 'bold',\n        color: 'hsl(var(--accent))', // Use accent color for today\n        border: '1px solid hsl(var(--accent))',\n    }\n  };\n\n  // Calculate the month to start the display from (one month before the target month)\n  const displayStartMonth = subMonths(currentMonth, 1);\n\n  return (\n    <div className=\"flex justify-center\">\n       <Calendar\n        mode=\"range\" // Keep range mode for consistency\n        month={displayStartMonth} // Start display from the previous month\n        numberOfMonths={3} // Always display 3 months\n        disabled={disabledDays}\n        modifiers={modifiers}\n        modifierStyles={modifierStyles}\n        selected={selectedRange} // Visually highlight the selected range\n        onDayClick={onDateClick} // Handle date clicks if needed\n        showOutsideDays // Good practice for calendar context\n        className=\"border rounded-md p-3 bg-card\" // Add some basic styling\n         classNames={{\n            day: cn(\n              \"h-9 w-9 p-0 font-normal relative\", // Ensure relative positioning for potential overlays\n               // Add hover effect for available dates if needed\n               \"[&:not([aria-disabled=true])]:hover:bg-accent/10\"\n            ),\n            // Customize other parts if necessary\n          }}\n       />\n    </div>\n  );\n}\n"],"names":[],"mappings":";;;;AAGA;AAEA;AACA,mPAA0D,mBAAmB;AAA7E;AANA;;;;;AAgBO,SAAS,qBAAqB,EACnC,YAAY,EACZ,gBAAgB,EAChB,aAAa,EACb,WAAW,EACe;IAE1B,MAAM,eAAe;QACnB;YAAE,QAAQ,CAAA,GAAA,0IAAA,CAAA,aAAU,AAAD,EAAE,IAAI;QAAQ;WAC9B,iBAAiB,GAAG,CAAC,CAAA,OAAQ,CAAA,GAAA,0IAAA,CAAA,aAAU,AAAD,EAAE;KAC5C;IAED,yCAAyC;IACzC,MAAM,YAAY;QAChB,aAAa,iBAAiB,GAAG,CAAC,CAAA,OAAQ,CAAA,GAAA,0IAAA,CAAA,aAAU,AAAD,EAAE;QACrD,UAAU,gBAAgB;YAAE,MAAM,cAAc,IAAI,GAAG,CAAA,GAAA,0IAAA,CAAA,aAAU,AAAD,EAAE,cAAc,IAAI,IAAI;YAAW,IAAI,cAAc,EAAE,GAAG,CAAA,GAAA,0IAAA,CAAA,aAAU,AAAD,EAAE,cAAc,EAAE,IAAG;QAAU,IAAI;IACxK;IAEA,kBAAkB;IAClB,MAAM,iBAAiB;QACrB,aAAa;YACT,gBAAgB;YAChB,OAAO;YACP,SAAS;YACT,eAAe;QACnB;QACA,UAAU;YACN,iBAAiB;YACjB,YAAY;YACZ,OAAO;QACX;QACC,kBAAkB;QACnB,OAAO;YACH,YAAY;YACZ,OAAO;YACP,QAAQ;QACZ;IACF;IAEA,oFAAoF;IACpF,MAAM,oBAAoB,CAAA,GAAA,yIAAA,CAAA,YAAS,AAAD,EAAE,cAAc;IAElD,qBACE,8OAAC;QAAI,WAAU;kBACZ,cAAA,8OAAC,oIAAA,CAAA,WAAQ;YACR,MAAK,QAAQ,kCAAkC;;YAC/C,OAAO;YACP,gBAAgB;YAChB,UAAU;YACV,WAAW;YACX,gBAAgB;YAChB,UAAU;YACV,YAAY;YACZ,eAAe;YACf,WAAU,gCAAgC,yBAAyB;;YAClE,YAAY;gBACT,KAAK,CAAA,GAAA,mHAAA,CAAA,KAAE,AAAD,EACJ,oCACC,iDAAiD;gBACjD;YAGL;;;;;;;;;;;AAIV","debugId":null}},
    {"offset": {"line": 1136, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/lib/price-utils.ts"],"sourcesContent":["\n// src/lib/price-utils.ts\n\ninterface PriceDetails {\n  basePrice: number; // (pricePerNight * numberOfNights)\n  extraGuestFee: number; // Total extra guest fee for the stay\n  cleaningFee: number;\n  subtotal: number; // (basePrice + extraGuestFee + cleaningFee)\n  discountAmount: number;\n  total: number; // (subtotal - discountAmount)\n}\n\n/**\n * Calculates the booking price details.\n *\n * @param pricePerNight - The base price per night for the property.\n * @param numberOfNights - The total number of nights for the booking.\n * @param cleaningFee - The fixed cleaning fee for the booking.\n * @param numberOfGuests - The total number of guests.\n * @param baseOccupancy - The number of guests included in the base price.\n * @param extraGuestFeePerNight - The fee per extra guest, per night.\n * @param discountPercentage - Optional discount percentage to apply (0-100).\n * @returns An object containing the detailed price breakdown.\n */\nexport function calculatePrice(\n  pricePerNight: number,\n  numberOfNights: number,\n  cleaningFee: number,\n  numberOfGuests: number,\n  baseOccupancy: number,\n  extraGuestFeePerNight: number,\n  discountPercentage: number = 0\n): PriceDetails {\n  if (numberOfNights <= 0) {\n    // Return zero values if nights are invalid\n    return { basePrice: 0, extraGuestFee: 0, cleaningFee: 0, subtotal: 0, discountAmount: 0, total: 0 };\n  }\n\n  const basePrice = pricePerNight * numberOfNights;\n\n  const extraGuests = Math.max(0, numberOfGuests - baseOccupancy);\n  const totalExtraGuestFee = extraGuests * extraGuestFeePerNight * numberOfNights;\n\n  const subtotal = basePrice + totalExtraGuestFee + cleaningFee;\n\n  const discountAmount = subtotal * (discountPercentage / 100);\n\n  const total = subtotal - discountAmount;\n\n  return {\n    basePrice: basePrice,\n    extraGuestFee: totalExtraGuestFee,\n    cleaningFee: cleaningFee,\n    subtotal: subtotal,\n    discountAmount: discountAmount,\n    total: total,\n  };\n}\n"],"names":[],"mappings":"AACA,yBAAyB;;;;AAuBlB,SAAS,eACd,aAAqB,EACrB,cAAsB,EACtB,WAAmB,EACnB,cAAsB,EACtB,aAAqB,EACrB,qBAA6B,EAC7B,qBAA6B,CAAC;IAE9B,IAAI,kBAAkB,GAAG;QACvB,2CAA2C;QAC3C,OAAO;YAAE,WAAW;YAAG,eAAe;YAAG,aAAa;YAAG,UAAU;YAAG,gBAAgB;YAAG,OAAO;QAAE;IACpG;IAEA,MAAM,YAAY,gBAAgB;IAElC,MAAM,cAAc,KAAK,GAAG,CAAC,GAAG,iBAAiB;IACjD,MAAM,qBAAqB,cAAc,wBAAwB;IAEjE,MAAM,WAAW,YAAY,qBAAqB;IAElD,MAAM,iBAAiB,WAAW,CAAC,qBAAqB,GAAG;IAE3D,MAAM,QAAQ,WAAW;IAEzB,OAAO;QACL,WAAW;QACX,eAAe;QACf,aAAa;QACb,UAAU;QACV,gBAAgB;QAChB,OAAO;IACT;AACF","debugId":null}},
    {"offset": {"line": 1173, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/hooks/use-session-storage.ts"],"sourcesContent":["\n\"use client\"; // This hook needs access to window.sessionStorage\n\nimport { useState, useEffect, useCallback } from 'react';\n\n// Helper function to safely parse JSON or return primitive if possible\nfunction safeJsonParse<T>(value: string | null): T | string | boolean | number | null { // Return type allows primitives or original string\n  if (value === null || value === undefined) return null;\n  try {\n    // Try parsing as JSON first\n    return JSON.parse(value);\n  } catch (e) {\n    // If JSON parsing fails, check if it might be a primitive stored as a string\n    const trimmedValue = value.trim();\n    if (trimmedValue.toLowerCase() === 'true') return true;\n    if (trimmedValue.toLowerCase() === 'false') return false;\n    if (trimmedValue === 'null') return null;\n    if (trimmedValue === 'undefined') return undefined; // Handle stored 'undefined' string\n\n    // Check if it's a number string (handle potential leading/trailing spaces)\n    // Ensure it's not an empty string before converting to number\n    if (trimmedValue !== '' && !isNaN(Number(trimmedValue))) {\n        // It looks like a number, return it as a number\n        return Number(trimmedValue);\n    }\n\n    // If it's neither valid JSON nor a recognizable primitive string,\n    // return the original string for the caller to potentially handle.\n    // console.warn(`Session storage value for key wasn't JSON, returning raw string: \"${value}\"`);\n    return value;\n  }\n}\n\n// Helper function to potentially parse stored date strings or return other parsed types/strings\nfunction parseStoredValue<T>(storedValue: string | null): T | string | boolean | number | null | undefined { // Return type updated\n    const parsed = safeJsonParse<T>(storedValue); // This now returns T | string | boolean | number | null | undefined\n\n    // If parsed is a string, try parsing as ISO date\n    if (typeof parsed === 'string') {\n        // Basic ISO date check (YYYY-MM-DDTHH:mm:ss.sssZ or YYYY-MM-DD)\n        const isoDateRegex = /^\\d{4}-\\d{2}-\\d{2}(T\\d{2}:\\d{2}:\\d{2}(\\.\\d+)?(Z|([+-]\\d{2}:\\d{2}))?)?$/;\n        if (isoDateRegex.test(parsed)) {\n            const date = new Date(parsed);\n            // Check if the date is valid (Date object handles invalid dates gracefully sometimes)\n            // A more robust check might be needed depending on expected date formats\n            if (!isNaN(date.getTime())) {\n                // Ensure the parsed date string wasn't just YYYY-MM-DD which Date might interpret wrongly depending on timezone\n                // If the original string contains 'T', it's likely a full ISO string\n                if (parsed.includes('T') || parsed.length === 10) { // Accept YYYY-MM-DD too\n                     return date as T; // Return Date object if valid\n                }\n            }\n        }\n    }\n    // Return the parsed value (could be T, string, boolean, number, undefined) or null\n    return parsed;\n}\n\n\n// Hook definition\nexport function useSessionStorage<T>(key: string, initialValue: T): [T, (value: T | ((val: T) => T)) => void] {\n  const [storedValue, setStoredValue] = useState<T>(() => {\n    if (typeof window === 'undefined') {\n      return initialValue;\n    }\n    try {\n      const item = window.sessionStorage.getItem(key);\n      const parsedItem = item ? parseStoredValue<T>(item) : null;\n\n      if (parsedItem !== null && parsedItem !== undefined) {\n          // Now we check the type of parsedItem against initialValue more carefully\n          if (typeof parsedItem === typeof initialValue ||\n              (parsedItem instanceof Date && initialValue instanceof Date) ||\n              (initialValue === null && parsedItem === null) || // Allow null match\n              (initialValue === undefined && parsedItem === undefined) // Allow undefined match\n             ) {\n             return parsedItem as T;\n          } else {\n              // Attempt type coercion if reasonable (e.g., string '1' to number 1)\n               if (typeof initialValue === 'number' && typeof parsedItem === 'number') {\n                  return parsedItem as T;\n              }\n              if (typeof initialValue === 'boolean' && typeof parsedItem === 'boolean') {\n                  return parsedItem as T;\n              }\n               if (typeof initialValue === 'string' && typeof parsedItem === 'string') {\n                  return parsedItem as T;\n              }\n              // If coercion isn't straightforward or types mismatch significantly, warn and fallback\n             console.warn(`Session storage type mismatch for key \"${key}\". Expected ${typeof initialValue}, found ${typeof parsedItem}. Using initial value.`);\n             return initialValue;\n          }\n\n      }\n      return initialValue; // Fallback if item is null or undefined after parsing\n    } catch (error) {\n      console.error(`Error reading sessionStorage key “${key}”:`, error);\n      return initialValue;\n    }\n  });\n\n  const setValue = useCallback((value: T | ((val: T) => T)) => {\n    try {\n      const valueToStore = value instanceof Function ? value(storedValue) : value;\n      setStoredValue(valueToStore);\n      if (typeof window !== 'undefined') {\n         // Convert value to string for storage\n          let stringifiedValue;\n          if (valueToStore === null) {\n              stringifiedValue = 'null';\n          } else if (valueToStore === undefined) {\n              stringifiedValue = 'undefined';\n          } else if (valueToStore instanceof Date) {\n              stringifiedValue = valueToStore.toISOString(); // Store dates as ISO strings\n          } else if (typeof valueToStore === 'object') { // Handle arrays and objects\n              stringifiedValue = JSON.stringify(valueToStore); // Stringify objects/arrays\n          } else {\n              stringifiedValue = String(valueToStore); // Convert other primitives to string\n          }\n          window.sessionStorage.setItem(key, stringifiedValue);\n      }\n    } catch (error) {\n      console.error(`Error setting sessionStorage key “${key}”:`, error);\n    }\n  }, [key, storedValue]);\n\n  // Optional: Listen for storage changes (consider impact on complex state)\n  useEffect(() => {\n    const handleStorageChange = (event: StorageEvent) => {\n      if (event.storageArea === window.sessionStorage && event.key === key) {\n        try {\n          const newValue = event.newValue ? parseStoredValue<T>(event.newValue) : null;\n          // Similar type check as initial load\n           if (newValue !== null && newValue !== undefined) {\n               if (typeof newValue === typeof initialValue ||\n                   (newValue instanceof Date && initialValue instanceof Date) ||\n                   (initialValue === null && newValue === null) ||\n                   (initialValue === undefined && newValue === undefined)) {\n                 setStoredValue(newValue as T);\n               } else {\n                   // Handle potential type mismatch on update, maybe fallback or log\n                    console.warn(`Session storage update type mismatch for key \"${key}\". Ignoring update.`);\n                    // Or fallback: setStoredValue(initialValue);\n               }\n            } else {\n                 // Handle case where value is removed or becomes null/undefined\n                 if (initialValue === null || initialValue === undefined) {\n                    setStoredValue(initialValue);\n                 } else {\n                     // If initial value wasn't null/undefined, but storage becomes so,\n                     // decide if you should revert to initial or accept null/undefined\n                     setStoredValue(newValue as T); // Accept null/undefined if parsed as such\n                 }\n\n            }\n        } catch (error) {\n          console.error(`Error handling storage change for key “${key}”:`, error);\n        }\n      }\n    };\n\n    window.addEventListener('storage', handleStorageChange);\n    return () => {\n      window.removeEventListener('storage', handleStorageChange);\n    };\n  }, [key, initialValue]); // Added initialValue to dependency array\n\n  return [storedValue, setValue];\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 1297, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/components/ui/badge.tsx"],"sourcesContent":["import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst badgeVariants = cva(\n  \"inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2\",\n  {\n    variants: {\n      variant: {\n        default:\n          \"border-transparent bg-primary text-primary-foreground hover:bg-primary/80\",\n        secondary:\n          \"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80\",\n        destructive:\n          \"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80\",\n        outline: \"text-foreground\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nexport interface BadgeProps\n  extends React.HTMLAttributes<HTMLDivElement>,\n    VariantProps<typeof badgeVariants> {}\n\nfunction Badge({ className, variant, ...props }: BadgeProps) {\n  return (\n    <div className={cn(badgeVariants({ variant }), className)} {...props} />\n  )\n}\n\nexport { Badge, badgeVariants }\n"],"names":[],"mappings":";;;;;AACA;AAEA;;;;AAEA,MAAM,gBAAgB,CAAA,GAAA,gKAAA,CAAA,MAAG,AAAD,EACtB,0KACA;IACE,UAAU;QACR,SAAS;YACP,SACE;YACF,WACE;YACF,aACE;YACF,SAAS;QACX;IACF;IACA,iBAAiB;QACf,SAAS;IACX;AACF;AAOF,SAAS,MAAM,EAAE,SAAS,EAAE,OAAO,EAAE,GAAG,OAAmB;IACzD,qBACE,8OAAC;QAAI,WAAW,CAAA,GAAA,mHAAA,CAAA,KAAE,AAAD,EAAE,cAAc;YAAE;QAAQ,IAAI;QAAa,GAAG,KAAK;;;;;;AAExE","debugId":null}},
    {"offset": {"line": 1339, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/lib/sanitize.ts"],"sourcesContent":["// src/lib/sanitize.ts\n/**\n * Basic HTML tag stripper.\n * WARNING: This is a very basic sanitizer and may not be sufficient for all use cases.\n * For robust sanitization, consider using a dedicated library like DOMPurify (client-side)\n * or a server-side sanitization library.\n * @param html The HTML string to sanitize.\n * @returns The sanitized string.\n */\nexport function stripHtmlTags(html: string | null | undefined): string {\n  if (html === null || html === undefined) {\n    return '';\n  }\n  // Replace HTML tags with an empty string\n  return String(html).replace(/(<([^>]+)>)/gi, '');\n}\n\n/**\n * Sanitizes text by trimming whitespace and stripping HTML tags.\n * @param text The text string to sanitize.\n * @returns The sanitized string.\n */\nexport function sanitizeText(text: string | null | undefined): string {\n  if (text === null || text === undefined) {\n    return '';\n  }\n  return stripHtmlTags(String(text).trim());\n}\n\n/**\n * A more specific sanitizer for email inputs.\n * For emails, we typically want to trim whitespace but not strip characters\n * like '<' or '>' which might (rarely) be part of a display name in an email string,\n * though for simple email address fields, simple trimming is often enough.\n * HTML tags should still be stripped.\n * @param email The email string to sanitize.\n * @returns The sanitized email string.\n */\nexport function sanitizeEmail(email: string | null | undefined): string {\n  if (email === null || email === undefined) {\n    return '';\n  }\n  // Trim whitespace and strip HTML tags.\n  // Avoid overly aggressive sanitization that might break valid email formats.\n  return stripHtmlTags(String(email).trim());\n}\n\n/**\n * A specific sanitizer for phone number inputs.\n * Often involves stripping non-numeric characters except for a leading '+'.\n * This example is basic and might need adjustment based on expected phone formats.\n * @param phone The phone number string to sanitize.\n * @returns The sanitized phone number string.\n */\nexport function sanitizePhone(phone: string | null | undefined): string {\n  if (phone === null || phone === undefined) {\n    return '';\n  }\n  // Basic: remove common non-numeric chars except '+' if it's at the start.\n  // This is highly dependent on the desired phone number formats.\n  // For more robust phone number handling, use a library like 'libphonenumber-js'.\n  let sanitized = String(phone).replace(/[^\\d+]/g, ''); // Allow + and digits\n  if (sanitized.startsWith('+')) {\n    sanitized = '+' + sanitized.substring(1).replace(/\\+/g, ''); // Keep only leading +\n  } else {\n    sanitized = sanitized.replace(/\\+/g, ''); // Remove + if not leading\n  }\n  return sanitized;\n}\n"],"names":[],"mappings":"AAAA,sBAAsB;AACtB;;;;;;;CAOC;;;;;;AACM,SAAS,cAAc,IAA+B;IAC3D,IAAI,SAAS,QAAQ,SAAS,WAAW;QACvC,OAAO;IACT;IACA,yCAAyC;IACzC,OAAO,OAAO,MAAM,OAAO,CAAC,iBAAiB;AAC/C;AAOO,SAAS,aAAa,IAA+B;IAC1D,IAAI,SAAS,QAAQ,SAAS,WAAW;QACvC,OAAO;IACT;IACA,OAAO,cAAc,OAAO,MAAM,IAAI;AACxC;AAWO,SAAS,cAAc,KAAgC;IAC5D,IAAI,UAAU,QAAQ,UAAU,WAAW;QACzC,OAAO;IACT;IACA,uCAAuC;IACvC,6EAA6E;IAC7E,OAAO,cAAc,OAAO,OAAO,IAAI;AACzC;AASO,SAAS,cAAc,KAAgC;IAC5D,IAAI,UAAU,QAAQ,UAAU,WAAW;QACzC,OAAO;IACT;IACA,0EAA0E;IAC1E,gEAAgE;IAChE,iFAAiF;IACjF,IAAI,YAAY,OAAO,OAAO,OAAO,CAAC,WAAW,KAAK,qBAAqB;IAC3E,IAAI,UAAU,UAAU,CAAC,MAAM;QAC7B,YAAY,MAAM,UAAU,SAAS,CAAC,GAAG,OAAO,CAAC,OAAO,KAAK,sBAAsB;IACrF,OAAO;QACL,YAAY,UAAU,OAAO,CAAC,OAAO,KAAK,0BAA0B;IACtE;IACA,OAAO;AACT","debugId":null}},
    {"offset": {"line": 1395, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/hooks/useSanitizedState.ts"],"sourcesContent":["// src/hooks/useSanitizedState.ts\n'use client';\n\nimport { useState, useCallback, type Dispatch, type SetStateAction } from 'react';\nimport { sanitizeText } from '@/lib/sanitize'; // Default sanitizer\n\ntype SanitizerFunction = (value: string) => string;\n\n/**\n * A custom React hook for managing input string state with built-in sanitization.\n *\n * @param initialValue The initial value of the input.\n * @param sanitizer A function to sanitize the input value. Defaults to a basic text sanitizer.\n * @returns A tuple containing the sanitized value and a setter function.\n */\nexport function useSanitizedState(\n  initialValue: string,\n  sanitizer: SanitizerFunction = sanitizeText\n): [string, Dispatch<SetStateAction<string>>] {\n  const [value, _setValue] = useState<string>(sanitizer(initialValue));\n\n  const setValue: Dispatch<SetStateAction<string>> = useCallback(\n    (newValueOrCallback) => {\n      _setValue((currentValue) => {\n        const resolvedNewValue =\n          typeof newValueOrCallback === 'function'\n            ? (newValueOrCallback as (prevState: string) => string)(currentValue)\n            : newValueOrCallback;\n        return sanitizer(resolvedNewValue);\n      });\n    },\n    [sanitizer]\n  );\n\n  return [value, setValue];\n}\n"],"names":[],"mappings":"AAAA,iCAAiC;;;;AAGjC;AACA,8MAA+C,oBAAoB;AAHnE;;;AAcO,SAAS,kBACd,YAAoB,EACpB,YAA+B,sHAAA,CAAA,eAAY;IAE3C,MAAM,CAAC,OAAO,UAAU,GAAG,CAAA,GAAA,qMAAA,CAAA,WAAQ,AAAD,EAAU,UAAU;IAEtD,MAAM,WAA6C,CAAA,GAAA,qMAAA,CAAA,cAAW,AAAD,EAC3D,CAAC;QACC,UAAU,CAAC;YACT,MAAM,mBACJ,OAAO,uBAAuB,aAC1B,AAAC,mBAAqD,gBACtD;YACN,OAAO,UAAU;QACnB;IACF,GACA;QAAC;KAAU;IAGb,OAAO;QAAC;QAAO;KAAS;AAC1B","debugId":null}},
    {"offset": {"line": 1425, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/components/booking/availability-check.tsx"],"sourcesContent":["// src/components/booking/availability-check.tsx\n\"use client\";\n\nimport * as React from 'react';\nimport { useState, useEffect, useMemo, useCallback } from 'react';\nimport { useRouter } from 'next/navigation';\nimport Image from 'next/image';\nimport { format, differenceInDays, addDays, parseISO, isValid, isBefore, startOfDay, isAfter, startOfMonth, subMonths } from 'date-fns';\nimport {\n  Loader2,\n  Calendar as CalendarIcon,\n  Users,\n  CheckCircle,\n  XCircle,\n  Info,\n  Mail,\n  Phone,\n  TicketPercent,\n  X,\n  AlertTriangle,\n  ArrowRight,\n  MapPin,\n  BedDouble,\n  Minus,\n  Bath,\n  Home,\n  Building,\n  Wind,\n  Plus,\n} from 'lucide-react';\n\nimport type { Property, Coupon, Availability } from '@/types';\nimport type { Stripe } from '@stripe/stripe-js';\nimport { getUnavailableDatesForProperty } from '@/services/bookingService';\nimport { validateAndApplyCoupon } from '@/services/couponService';\nimport { createPendingBookingAction } from '@/app/actions/booking-actions';\n\nimport { Button } from '@/components/ui/button';\nimport { Checkbox } from '@/components/ui/checkbox';\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Separator } from '@/components/ui/separator';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\nimport { RadioGroup, RadioGroupItem } from \"@/components/ui/radio-group\";\nimport { useToast } from '@/hooks/use-toast';\nimport { Alert, AlertDescription, AlertTitle } from \"@/components/ui/alert\";\nimport { AvailabilityCalendar } from './availability-calendar';\nimport { calculatePrice } from '@/lib/price-utils';\nimport { useSessionStorage } from '@/hooks/use-session-storage';\nimport { Badge } from '@/components/ui/badge';\nimport { useSanitizedState } from '@/hooks/useSanitizedState';\nimport { sanitizeEmail, sanitizePhone, sanitizeText } from '@/lib/sanitize';\n\n\ninterface AvailabilityCheckProps {\n  property: Property;\n  initialCheckIn?: string;\n  initialCheckOut?: string;\n}\n\nconst parseDateSafe = (dateStr: string | undefined | null): Date | null => {\n  if (!dateStr) return null;\n  try {\n    const parsed = parseISO(dateStr);\n    return isValid(parsed) ? startOfDay(parsed) : null;\n  } catch {\n    return null;\n  }\n};\n\nexport function AvailabilityCheck({\n  property,\n  initialCheckIn,\n  initialCheckOut,\n}: AvailabilityCheckProps) {\n  const router = useRouter();\n  const { toast } = useToast();\n  const propertySlug = property.slug;\n\n  const [checkInDate, setCheckInDate] = useState<Date | null>(parseDateSafe(initialCheckIn));\n  const [checkOutDate, setCheckOutDate] = useState<Date | null>(parseDateSafe(initialCheckOut));\n  const [numberOfGuests, setNumberOfGuests] = useSessionStorage<number>(`booking_${propertySlug}_guests`, property.baseOccupancy || 1);\n\n  const [isAvailable, setIsAvailable] = useState<boolean | null>(null);\n  const [isLoadingAvailability, setIsLoadingAvailability] = useState(true);\n  const [unavailableDates, setUnavailableDates] = useState<Date[]>([]);\n  const [suggestedDates, setSuggestedDates] = useState<Array<{ from: Date; to: Date; recommendation?: string }>>([]);\n\n  // Guest Information State - Using useSanitizedState and syncing with useSessionStorage\n  const [initialFirstNameFromSession, setInitialFirstNameInSession] = useSessionStorage<string>(`booking_${propertySlug}_firstName`, '');\n  const [firstName, setFirstName] = useSanitizedState(initialFirstNameFromSession, sanitizeText);\n  useEffect(() => { setInitialFirstNameInSession(firstName); }, [firstName, setInitialFirstNameInSession]);\n\n  const [initialLastNameFromSession, setInitialLastNameInSession] = useSessionStorage<string>(`booking_${propertySlug}_lastName`, '');\n  const [lastName, setLastName] = useSanitizedState(initialLastNameFromSession, sanitizeText);\n  useEffect(() => { setInitialLastNameInSession(lastName); }, [lastName, setInitialLastNameInSession]);\n\n  const [initialEmailFromSession, setInitialEmailInSession] = useSessionStorage<string>(`booking_${propertySlug}_email`, '');\n  const [email, setEmail] = useSanitizedState(initialEmailFromSession, sanitizeEmail);\n  useEffect(() => { setInitialEmailInSession(email); }, [email, setInitialEmailInSession]);\n\n  const [initialPhoneFromSession, setInitialPhoneInSession] = useSessionStorage<string>(`booking_${propertySlug}_phone`, '');\n  const [phone, setPhone] = useSanitizedState(initialPhoneFromSession, sanitizePhone);\n  useEffect(() => { setInitialPhoneInSession(phone); }, [phone, setInitialPhoneInSession]);\n\n  const [stripePromise, setStripePromise] = useState<Promise<Stripe | null> | null>(null);\n\n  const [couponCode, setCouponCode] = useState('');\n  const [appliedCoupon, setAppliedCoupon] = useState<{ code: string; discountPercentage: number } | null>(null);\n  const [couponError, setCouponError] = useState<string | null>(null);\n  const [isApplyingCoupon, setIsApplyingCoupon] = useState(false);\n\n  const [notifyAvailability, setNotifyAvailability] = useState(false);\n  const [notificationMethod, setNotificationMethod] = useState<'email' | 'sms'>('email');\n\n  const [isProcessingBooking, setIsProcessingBooking] = useState(false);\n  const [formError, setFormError] = useState<string | null>(null);\n\n  const datesSelected = checkInDate && checkOutDate && isValid(checkInDate) && isValid(checkOutDate) && isAfter(checkOutDate, checkInDate);\n  const numberOfNights = useMemo(() => {\n    if (datesSelected && checkInDate && checkOutDate) {\n      return differenceInDays(startOfDay(checkOutDate), startOfDay(checkInDate));\n    }\n    return 0;\n  }, [checkInDate, checkOutDate, datesSelected]);\n\n  useEffect(() => {\n    if (process.env.NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY) {\n      setStripePromise(import('@stripe/stripe-js').then(m => m.loadStripe(process.env.NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY!)));\n    } else {\n      console.error(\"Stripe Publishable Key not found in environment variables.\");\n    }\n  }, []);\n\n  const pricingDetails = useMemo(() => {\n    if (datesSelected && numberOfGuests > 0) {\n      return calculatePrice(\n        property.pricePerNight,\n        numberOfNights,\n        property.cleaningFee ?? 0,\n        numberOfGuests,\n        property.baseOccupancy,\n        property.extraGuestFee ?? 0,\n        appliedCoupon?.discountPercentage\n      );\n    }\n    return null;\n  }, [datesSelected, property, numberOfNights, numberOfGuests, appliedCoupon]);\n\n  const checkPropertyAvailability = useCallback(async () => {\n    if (!datesSelected || !checkInDate || !checkOutDate) {\n      setIsAvailable(null);\n      setIsLoadingAvailability(false);\n      setSuggestedDates([]);\n      return;\n    }\n\n    setIsLoadingAvailability(true);\n    setIsAvailable(null);\n    setSuggestedDates([]);\n\n    try {\n      const fetchedUnavailableDates = await getUnavailableDatesForProperty(propertySlug);\n      setUnavailableDates(fetchedUnavailableDates);\n\n      let conflict = false;\n      let current = new Date(checkInDate.getTime());\n      while (isBefore(current, checkOutDate)) {\n        const dateString = format(startOfDay(current), 'yyyy-MM-dd');\n        if (fetchedUnavailableDates.some(d => format(startOfDay(d), 'yyyy-MM-dd') === dateString)) {\n          conflict = true;\n          break;\n        }\n        current = addDays(current, 1);\n      }\n      setIsAvailable(!conflict);\n\n      if (conflict) {\n        const suggested = [\n          { from: addDays(checkOutDate!, 1), to: addDays(checkOutDate!, 1 + numberOfNights), recommendation: \"Next Available\" },\n          { from: addDays(checkInDate!, 7), to: addDays(checkInDate!, 7 + numberOfNights) },\n        ];\n        const validSuggestions = suggested.filter(range => {\n          let isValidSuggestion = true;\n          let checkCurrent = new Date(range.from.getTime());\n          while (isBefore(checkCurrent, range.to)) {\n            const checkDateString = format(startOfDay(checkCurrent), 'yyyy-MM-dd');\n            if (fetchedUnavailableDates.some(d => format(startOfDay(d), 'yyyy-MM-dd') === checkDateString)) {\n              isValidSuggestion = false;\n              break;\n            }\n            checkCurrent = addDays(checkCurrent, 1);\n          }\n          return isValidSuggestion && !isBefore(startOfDay(range.from), startOfDay(new Date()));\n        });\n        setSuggestedDates(validSuggestions.slice(0, 3));\n      }\n    } catch (error) {\n      console.error(\"Error checking availability:\", error);\n      toast({\n        title: \"Error Checking Availability\",\n        description: \"Could not check property availability. Please try again.\",\n        variant: \"destructive\",\n      });\n      setIsAvailable(false);\n    } finally {\n      setIsLoadingAvailability(false);\n    }\n  }, [checkInDate, checkOutDate, datesSelected, propertySlug, numberOfNights, toast]);\n\n  useEffect(() => {\n    checkPropertyAvailability();\n  }, [checkPropertyAvailability]);\n\n  const handleGuestChange = (change: number) => {\n    setNumberOfGuests((prev) => {\n      const newCount = prev + change;\n      return Math.max(1, Math.min(newCount, property.maxGuests));\n    });\n  };\n\n  const handleGuestInfoChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const { name, value } = e.target;\n    // The setters from useSanitizedState will automatically sanitize\n    if (name === 'firstName') setFirstName(value);\n    else if (name === 'lastName') setLastName(value);\n    else if (name === 'email') setEmail(value);\n    else if (name === 'phone') setPhone(value);\n  };\n\n  const handleApplyCoupon = async () => {\n    if (!couponCode.trim()) {\n      setCouponError('Please enter a coupon code.');\n      return;\n    }\n    if (!datesSelected || !checkInDate || !checkOutDate) {\n      setCouponError('Please select valid booking dates first.');\n      return;\n    }\n\n    setIsApplyingCoupon(true);\n    setCouponError(null);\n    setAppliedCoupon(null);\n\n    try {\n      const result = await validateAndApplyCoupon(couponCode.trim(), checkInDate, checkOutDate, propertySlug);\n      if (result.error) {\n        setCouponError(result.error);\n      } else if (result.discountPercentage) {\n        setAppliedCoupon({ code: couponCode.trim().toUpperCase(), discountPercentage: result.discountPercentage });\n        toast({\n          title: \"Coupon Applied!\",\n          description: `Successfully applied ${result.discountPercentage}% discount.`,\n        });\n      }\n    } catch (error) {\n      console.error('Error applying coupon:', error);\n      setCouponError('Could not apply coupon. Please try again.');\n    } finally {\n      setIsApplyingCoupon(false);\n    }\n  };\n\n  const handleRemoveCoupon = () => {\n    setAppliedCoupon(null);\n    setCouponCode('');\n    setCouponError(null);\n    toast({ title: \"Coupon Removed\" });\n  };\n\n  const handleSelectAlternativeDate = (range: { from: Date; to: Date }) => {\n    setCheckInDate(range.from);\n    setCheckOutDate(range.to);\n    window.scrollTo({ top: 0, behavior: 'smooth' });\n  };\n\n  const handleContinueToPayment = async (e: React.FormEvent) => {\n    e.preventDefault();\n    setFormError(null);\n\n    if (!datesSelected || isAvailable !== true || !checkInDate || !checkOutDate) {\n      setFormError(\"Selected dates are not available or invalid.\");\n      return;\n    }\n    if (!firstName || !lastName || !email) {\n      setFormError(\"Please fill in your first name, last name, and email.\");\n      return;\n    }\n    if (!/\\S+@\\S+\\.\\S+/.test(email)) { // Basic email format validation\n      setFormError(\"Please enter a valid email address.\");\n      return;\n    }\n    if (!phone) {\n      setFormError(\"Please enter your phone number.\");\n      return;\n    }\n    if (numberOfGuests < 1 || numberOfGuests > property.maxGuests) {\n      setFormError(`Number of guests must be between 1 and ${property.maxGuests}.`);\n      return;\n    }\n    if (!pricingDetails) {\n      setFormError(\"Could not calculate pricing. Please try again.\");\n      return;\n    }\n\n    setIsProcessingBooking(true);\n\n    try {\n      const bookingInput = {\n        propertyId: propertySlug,\n        guestInfo: { firstName, lastName, email, phone },\n        checkInDate: checkInDate.toISOString(),\n        checkOutDate: checkOutDate.toISOString(),\n        numberOfGuests: numberOfGuests,\n        pricing: {\n          baseRate: property.pricePerNight,\n          numberOfNights: numberOfNights,\n          cleaningFee: pricingDetails.cleaningFee,\n          extraGuestFee: property.extraGuestFee || 0,\n          numberOfExtraGuests: Math.max(0, numberOfGuests - property.baseOccupancy),\n          accommodationTotal: pricingDetails.basePrice + pricingDetails.extraGuestFee,\n          subtotal: pricingDetails.subtotal,\n          taxes: 0,\n          discountAmount: pricingDetails.discountAmount,\n          total: pricingDetails.total,\n        },\n        status: 'pending' as const,\n        appliedCouponCode: appliedCoupon?.code ?? null,\n      };\n      const pendingBookingResult = await createPendingBookingAction(bookingInput);\n\n      if (pendingBookingResult.error || !pendingBookingResult.bookingId) {\n        throw new Error(pendingBookingResult.error || \"Failed to create pending booking.\");\n      }\n\n      const { bookingId } = pendingBookingResult;\n\n      const checkoutInput = {\n        property: property,\n        checkInDate: checkInDate.toISOString(),\n        checkOutDate: checkOutDate.toISOString(),\n        numberOfGuests: numberOfGuests,\n        totalPrice: pricingDetails!.total,\n        numberOfNights: numberOfNights,\n        appliedCouponCode: appliedCoupon?.code,\n        discountPercentage: appliedCoupon?.discountPercentage,\n        guestFirstName: firstName,\n        guestLastName: lastName,\n        guestEmail: email,\n        pendingBookingId: bookingId,\n      };\n\n      const stripeResult = await import('@/app/actions/create-checkout-session').then(m => m.createCheckoutSession(checkoutInput));\n\n      if (stripeResult.error || !stripeResult.sessionId || !stripeResult.sessionUrl) {\n        throw new Error(stripeResult.error || 'Failed to create Stripe session or missing session URL.');\n      }\n      \n      // Try direct assignment first\n      try {\n        window.location.assign(stripeResult.sessionUrl);\n      } catch (assignError) {\n         console.warn(\"[handleContinueToPayment] window.location.assign failed, attempting fallback with stripe.redirectToCheckout...\", assignError);\n         const stripe = await stripePromise;\n         if (!stripe) throw new Error('Stripe.js failed to load.');\n         const { error: stripeRedirectError } = await stripe.redirectToCheckout({ sessionId: stripeResult.sessionId });\n         if (stripeRedirectError) {\n           if (stripeRedirectError.name === 'SecurityError' && stripeRedirectError.message.includes('permission to navigate the target frame')) {\n             console.error(\"[Stripe Redirect Error] SecurityError: Likely due to cross-origin restrictions in the iframe environment. Redirection might be blocked.\");\n             setFormError(\"Could not redirect to Stripe due to security restrictions in this environment. Please try booking from the deployed site.\");\n           } else {\n             throw new Error(stripeRedirectError.message || 'Could not redirect to Stripe (fallback attempt).');\n           }\n         }\n      }\n\n    } catch (error) {\n      console.error(\"Error processing booking:\", error);\n      const errorMessage = error instanceof Error ? error.message : \"An unexpected error occurred.\";\n      setFormError(errorMessage);\n      toast({\n        title: \"Booking Error\",\n        description: errorMessage,\n        variant: \"destructive\",\n      });\n    } finally {\n      setIsProcessingBooking(false);\n    }\n  };\n\n  const handleNotifyAvailability = async () => {\n    if (!datesSelected || !checkInDate || !checkOutDate) return;\n\n    if (notificationMethod === 'email' && !email) {\n      toast({ title: \"Missing Information\", description: \"Please enter your email address.\", variant: \"destructive\" });\n      return;\n    }\n    if (notificationMethod === 'sms' && !phone) {\n      toast({ title: \"Missing Information\", description: \"Please enter your phone number.\", variant: \"destructive\" });\n      return;\n    }\n\n    setIsProcessingBooking(true);\n    try {\n      // Placeholder for createAvailabilityAlertAction\n      console.log(\"[handleNotifyAvailability] Simulating availability alert request:\", {\n        propertyId: propertySlug,\n        checkInDate: format(checkInDate, 'yyyy-MM-dd'),\n        checkOutDate: format(checkOutDate, 'yyyy-MM-dd'),\n        method: notificationMethod,\n        contact: notificationMethod === 'email' ? email : phone,\n      });\n      await new Promise(res => setTimeout(res, 500));\n\n      toast({\n        title: \"Alert Request Saved\",\n        description: `We'll notify you via ${notificationMethod} if ${format(checkInDate, 'MMM d')} - ${format(checkOutDate, 'MMM d')} becomes available.`,\n      });\n      setNotifyAvailability(false);\n    } catch (error) {\n      console.error(\"Error creating availability alert:\", error);\n      toast({\n        title: \"Error Saving Alert\",\n        description: `Could not save your notification request. ${error instanceof Error ? error.message : ''}`,\n        variant: \"destructive\",\n      });\n    } finally {\n      setIsProcessingBooking(false);\n    }\n  };\n\n  const renderAvailabilityStatus = () => {\n    if (isLoadingAvailability) {\n      return (\n        <Alert variant=\"default\" className=\"bg-blue-50 border-blue-200\">\n          <Loader2 className=\"h-4 w-4 animate-spin\" />\n          <AlertTitle>Checking Availability...</AlertTitle>\n          <AlertDescription>Please wait while we check the dates.</AlertDescription>\n        </Alert>\n      );\n    }\n    if (isAvailable === true && datesSelected && checkInDate && checkOutDate) {\n      return (\n        <Alert variant=\"default\" className=\"bg-green-50 border-green-200 text-green-800\">\n          <CheckCircle className=\"h-4 w-4 text-green-600\" />\n          <AlertTitle>Dates Available!</AlertTitle>\n          <AlertDescription>\n            Good news! The dates {`${format(checkInDate, 'MMM d')} - ${format(checkOutDate, 'MMM d')} (${numberOfNights} nights)`} are available. Please fill in your details below to proceed.\n          </AlertDescription>\n        </Alert>\n      );\n    }\n    if (isAvailable === false && datesSelected && checkInDate && checkOutDate) {\n      return (\n        <Alert variant=\"destructive\">\n          <XCircle className=\"h-4 w-4\" />\n          <AlertTitle>Dates Unavailable</AlertTitle>\n          <AlertDescription>\n            Unfortunately, the selected dates ({`${format(checkInDate, 'MMM d')} - ${format(checkOutDate, 'MMM d')}`}) are not available.\n          </AlertDescription>\n        </Alert>\n      );\n    }\n    if (!datesSelected) {\n      return (\n        <Alert variant=\"default\" className=\"border-yellow-300 bg-yellow-50 text-yellow-800\">\n          <Info className=\"h-4 w-4 text-yellow-600\" />\n          <AlertTitle>Select Dates</AlertTitle>\n          <AlertDescription>Please select your check-in and check-out dates using the initial form or by selecting alternative dates below.</AlertDescription>\n        </Alert>\n      );\n    }\n    return null;\n  };\n\n  const renderSuggestedDates = () => {\n    if (isLoadingAvailability || isAvailable !== false || suggestedDates.length === 0) {\n      return null;\n    }\n    return (\n      <Card className=\"mt-6 bg-amber-50 border-amber-200\">\n        <CardHeader>\n          <CardTitle className=\"text-lg text-amber-900\">Alternative Dates</CardTitle>\n          <CardDescription className=\"text-amber-800\">\n            The dates you selected are unavailable. Here are some alternatives:\n          </CardDescription>\n        </CardHeader>\n        <CardContent className=\"space-y-3\">\n          {suggestedDates.map((range, index) => (\n            <Button\n              key={index}\n              variant=\"outline\"\n              className=\"w-full justify-between bg-white hover:bg-gray-50 border-gray-300\"\n              onClick={() => handleSelectAlternativeDate(range)}\n            >\n              <span>\n                {format(range.from, 'MMM d, yyyy')} - {format(range.to, 'MMM d, yyyy')} ({differenceInDays(range.to, range.from)} nights)\n              </span>\n              {range.recommendation && <Badge variant=\"secondary\">{range.recommendation}</Badge>}\n            </Button>\n          ))}\n        </CardContent>\n      </Card>\n    );\n  };\n\n  const renderAvailabilityCalendar = () => {\n    if (isAvailable === true || (isLoadingAvailability && unavailableDates.length === 0)) {\n      return null;\n    }\n    const validCheckIn = checkInDate && isValid(checkInDate) ? checkInDate : new Date();\n    const calendarCenterMonth = startOfMonth(validCheckIn);\n    return (\n      <div className=\"mt-6\">\n        <h3 className=\"text-lg font-semibold mb-3\">Availability Calendar</h3>\n        <AvailabilityCalendar\n          currentMonth={calendarCenterMonth}\n          unavailableDates={unavailableDates}\n          selectedRange={datesSelected && checkInDate && checkOutDate ? { from: checkInDate, to: checkOutDate } : undefined}\n        />\n      </div>\n    );\n  }\n\n  const renderNotificationForm = () => {\n    if (isLoadingAvailability || isAvailable !== false || !datesSelected || !checkInDate || !checkOutDate) return null;\n    return (\n      <Card className=\"mt-6 bg-blue-50 border-blue-200\">\n        <CardHeader>\n          <CardTitle className=\"text-lg text-blue-900\">Get Notified</CardTitle>\n          <CardDescription className=\"text-blue-800\">\n            Want to know if {`${format(checkInDate, 'MMM d')} - ${format(checkOutDate, 'MMM d')}`} become available?\n          </CardDescription>\n        </CardHeader>\n        <CardContent className=\"space-y-4\">\n          <div className=\"flex items-center space-x-2\">\n            <Checkbox\n              id=\"notify-availability\"\n              checked={notifyAvailability}\n              onCheckedChange={(checked) => setNotifyAvailability(checked as boolean)}\n            />\n            <Label htmlFor=\"notify-availability\" className=\"font-medium\">\n              Yes, notify me if these dates become available.\n            </Label>\n          </div>\n          {notifyAvailability && (\n            <>\n              <Separator />\n              <p className=\"text-sm font-medium\">How should we notify you?</p>\n              <RadioGroup\n                value={notificationMethod}\n                onValueChange={(value) => setNotificationMethod(value as 'email' | 'sms')}\n                className=\"flex gap-4\"\n              >\n                <div className=\"flex items-center space-x-2\">\n                  <RadioGroupItem value=\"email\" id=\"notify-email\" />\n                  <Label htmlFor=\"notify-email\" className=\"flex items-center gap-1\"><Mail className=\"h-4 w-4\" /> Email</Label>\n                </div>\n                <div className=\"flex items-center space-x-2\">\n                  <RadioGroupItem value=\"sms\" id=\"notify-sms\" />\n                  <Label htmlFor=\"notify-sms\" className=\"flex items-center gap-1\"><Phone className=\"h-4 w-4\" /> SMS</Label>\n                </div>\n              </RadioGroup>\n              {notificationMethod === 'email' && (\n                <Input\n                  type=\"email\"\n                  placeholder=\"Enter your email\"\n                  value={email}\n                  onChange={(e) => setEmail(e.target.value)}\n                  required={notificationMethod === 'email'}\n                  className=\"bg-white\"\n                />\n              )}\n              {notificationMethod === 'sms' && (\n                <Input\n                  type=\"tel\"\n                  placeholder=\"Enter your phone number\"\n                  value={phone}\n                  onChange={(e) => setPhone(e.target.value)}\n                  required={notificationMethod === 'sms'}\n                  className=\"bg-white\"\n                />\n              )}\n              <Button\n                onClick={handleNotifyAvailability}\n                disabled={isProcessingBooking}\n                size=\"sm\"\n              >\n                {isProcessingBooking ? <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" /> : null}\n                Request Notification\n              </Button>\n            </>\n          )}\n        </CardContent>\n      </Card>\n    )\n  }\n\n  return (\n    <div className=\"max-w-3xl mx-auto w-full px-4 md:px-0\">\n      <div className=\"space-y-6 mb-8\">\n        {renderAvailabilityStatus()}\n        {renderSuggestedDates()}\n        {renderAvailabilityCalendar()}\n        {renderNotificationForm()}\n      </div>\n\n      {isAvailable === true && (\n        <Card className=\"w-full\">\n          <CardHeader>\n            <CardTitle>Booking Summary & Details</CardTitle>\n            <CardDescription>Confirm details and proceed to payment.</CardDescription>\n          </CardHeader>\n          <CardContent>\n            {isLoadingAvailability ? (\n              <div className=\"flex justify-center items-center p-8\">\n                <Loader2 className=\"h-8 w-8 animate-spin text-muted-foreground\" />\n              </div>\n            ) : (\n              <form onSubmit={handleContinueToPayment} className=\"space-y-6\">\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4 items-end border-b pb-4\">\n                  {datesSelected && checkInDate && checkOutDate && (\n                    <div className=\"space-y-1\">\n                      <Label>Selected Dates</Label>\n                      <div className=\"flex items-center justify-between rounded-md border p-2 mt-1 bg-muted/50\">\n                        <span className=\"font-medium text-sm\">\n                          {format(checkInDate, 'MMM dd, yyyy')} - {format(checkOutDate, 'MMM dd, yyyy')}\n                        </span>\n                        <span className=\"text-sm text-muted-foreground\">({numberOfNights} nights)</span>\n                      </div>\n                    </div>\n                  )}\n                  <div className=\"space-y-1\">\n                    <Label htmlFor=\"guests\">Number of Guests</Label>\n                    <div className=\"flex items-center justify-between rounded-md border p-2 mt-1\">\n                      <Button\n                        type=\"button\"\n                        variant=\"outline\"\n                        size=\"icon\"\n                        className=\"h-7 w-7\"\n                        onClick={() => handleGuestChange(-1)}\n                        disabled={numberOfGuests <= 1 || isProcessingBooking}\n                        aria-label=\"Decrease guests\"\n                      >\n                        <Minus className=\"h-4 w-4\" />\n                      </Button>\n                      <span className=\"mx-4 font-medium w-8 text-center\" id=\"guests\">\n                        {numberOfGuests}\n                      </span>\n                      <Button\n                        type=\"button\"\n                        variant=\"outline\"\n                        size=\"icon\"\n                        className=\"h-7 w-7\"\n                        onClick={() => handleGuestChange(1)}\n                        disabled={numberOfGuests >= property.maxGuests || isProcessingBooking}\n                        aria-label=\"Increase guests\"\n                      >\n                        <Plus className=\"h-4 w-4\" />\n                      </Button>\n                    </div>\n                    <p className=\"text-xs text-muted-foreground mt-1\">\n                      Max {property.maxGuests}. Base for {property.baseOccupancy}.\n                      {(property.extraGuestFee ?? 0) > 0 && ` Extra: $${(property.extraGuestFee ?? 0).toFixed(2)}/guest/night.`}\n                    </p>\n                  </div>\n                </div>\n                <div className=\"grid grid-cols-1 gap-4 border-b pb-4\">\n                  <div className=\"space-y-1\">\n                    <Label htmlFor=\"coupon\">Discount Coupon (Optional)</Label>\n                    <div className=\"flex gap-2\">\n                      <Input id=\"coupon\" placeholder=\"Enter code\" value={couponCode} onChange={(e) => setCouponCode(e.target.value)} disabled={isApplyingCoupon || !!appliedCoupon || isProcessingBooking} />\n                      {!appliedCoupon ? (\n                        <Button type=\"button\" variant=\"outline\" onClick={handleApplyCoupon} disabled={isApplyingCoupon || !couponCode.trim() || isProcessingBooking}>\n                          {isApplyingCoupon ? <Loader2 className=\"h-4 w-4 animate-spin\" /> : <TicketPercent className=\"h-4 w-4\" />}\n                        </Button>\n                      ) : (\n                        <Button type=\"button\" variant=\"ghost\" size=\"icon\" onClick={handleRemoveCoupon} disabled={isProcessingBooking}><X className=\"h-4 w-4 text-destructive\" /></Button>\n                      )}\n                    </div>\n                    <div className=\"h-4 text-xs mt-1\">\n                      {couponError && <p className=\"text-destructive\">{couponError}</p>}\n                      {appliedCoupon && <p className=\"text-green-600\">Applied: {appliedCoupon.code} ({appliedCoupon.discountPercentage}%)</p>}\n                    </div>\n                  </div>\n                </div>\n                {pricingDetails && (\n                  <div className=\"space-y-2 text-sm border-b pb-4\">\n                    <h3 className=\"font-semibold mb-2\">Price Details</h3>\n                    <div className=\"flex justify-between\"><span>Base price ({numberOfNights} nights)</span><span>${pricingDetails.basePrice.toFixed(2)}</span></div>\n                    {pricingDetails.extraGuestFee > 0 && <div className=\"flex justify-between text-muted-foreground\"><span>Extra guest fee</span><span>+${pricingDetails.extraGuestFee.toFixed(2)}</span></div>}\n                    <div className=\"flex justify-between\"><span>Cleaning fee</span><span>+${pricingDetails.cleaningFee.toFixed(2)}</span></div>\n                    <Separator className=\"my-1\" />\n                    <div className=\"flex justify-between font-medium\"><span>Subtotal</span><span>${pricingDetails.subtotal.toFixed(2)}</span></div>\n                    {appliedCoupon && <div className=\"flex justify-between text-green-600\"><span>Discount ({appliedCoupon.code})</span><span>-${pricingDetails.discountAmount.toFixed(2)}</span></div>}\n                    <Separator className=\"my-2 font-bold\" />\n                    <div className=\"flex justify-between font-bold text-base\"><span>Total</span><span>${pricingDetails.total.toFixed(2)}</span></div>\n                  </div>\n                )}\n                <div className=\"space-y-4\">\n                  <h3 className=\"font-semibold\">Your Information</h3>\n                  <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                    <div className=\"space-y-1\">\n                      <Label htmlFor=\"firstName\">First Name</Label>\n                      <Input id=\"firstName\" name=\"firstName\" value={firstName} onChange={handleGuestInfoChange} required disabled={isProcessingBooking} />\n                    </div>\n                    <div className=\"space-y-1\">\n                      <Label htmlFor=\"lastName\">Last Name</Label>\n                      <Input id=\"lastName\" name=\"lastName\" value={lastName} onChange={handleGuestInfoChange} required disabled={isProcessingBooking} />\n                    </div>\n                  </div>\n                  <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                    <div className=\"space-y-1\">\n                      <Label htmlFor=\"email\">Email</Label>\n                      <Input id=\"email\" name=\"email\" type=\"email\" value={email} onChange={handleGuestInfoChange} required disabled={isProcessingBooking} />\n                    </div>\n                    <div className=\"space-y-1\">\n                      <Label htmlFor=\"phone\">Phone Number</Label>\n                      <Input id=\"phone\" name=\"phone\" type=\"tel\" value={phone} onChange={handleGuestInfoChange} required disabled={isProcessingBooking} />\n                    </div>\n                  </div>\n                </div>\n                {formError && (\n                  <Alert variant=\"destructive\">\n                    <AlertTriangle className=\"h-4 w-4\" />\n                    <AlertTitle>Error</AlertTitle>\n                    <AlertDescription>{formError}</AlertDescription>\n                  </Alert>\n                )}\n                <Button type=\"submit\" className=\"w-full\" disabled={isProcessingBooking}>\n                  {isProcessingBooking ? <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" /> : <ArrowRight className=\"mr-2 h-4 w-4\" />}\n                  {isProcessingBooking ? 'Processing...' : 'Continue to Payment'}\n                </Button>\n              </form>\n            )}\n          </CardContent>\n        </Card>\n      )}\n    </div>\n  );\n}\n"],"names":[],"mappings":"AAAA,gDAAgD;;;;;AAIhD;AACA;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAyBA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAlDA;;;;;;;;;;;;;;;;;;;;;;;;AA2DA,MAAM,gBAAgB,CAAC;IACrB,IAAI,CAAC,SAAS,OAAO;IACrB,IAAI;QACF,MAAM,SAAS,CAAA,GAAA,wIAAA,CAAA,WAAQ,AAAD,EAAE;QACxB,OAAO,CAAA,GAAA,uIAAA,CAAA,UAAO,AAAD,EAAE,UAAU,CAAA,GAAA,0IAAA,CAAA,aAAU,AAAD,EAAE,UAAU;IAChD,EAAE,OAAM;QACN,OAAO;IACT;AACF;AAEO,SAAS,kBAAkB,EAChC,QAAQ,EACR,cAAc,EACd,eAAe,EACQ;IACvB,MAAM,SAAS,CAAA,GAAA,kIAAA,CAAA,YAAS,AAAD;IACvB,MAAM,EAAE,KAAK,EAAE,GAAG,CAAA,GAAA,4HAAA,CAAA,WAAQ,AAAD;IACzB,MAAM,eAAe,SAAS,IAAI;IAElC,MAAM,CAAC,aAAa,eAAe,GAAG,CAAA,GAAA,qMAAA,CAAA,WAAQ,AAAD,EAAe,cAAc;IAC1E,MAAM,CAAC,cAAc,gBAAgB,GAAG,CAAA,GAAA,qMAAA,CAAA,WAAQ,AAAD,EAAe,cAAc;IAC5E,MAAM,CAAC,gBAAgB,kBAAkB,GAAG,CAAA,GAAA,yIAAA,CAAA,oBAAiB,AAAD,EAAU,CAAC,QAAQ,EAAE,aAAa,OAAO,CAAC,EAAE,SAAS,aAAa,IAAI;IAElI,MAAM,CAAC,aAAa,eAAe,GAAG,CAAA,GAAA,qMAAA,CAAA,WAAQ,AAAD,EAAkB;IAC/D,MAAM,CAAC,uBAAuB,yBAAyB,GAAG,CAAA,GAAA,qMAAA,CAAA,WAAQ,AAAD,EAAE;IACnE,MAAM,CAAC,kBAAkB,oBAAoB,GAAG,CAAA,GAAA,qMAAA,CAAA,WAAQ,AAAD,EAAU,EAAE;IACnE,MAAM,CAAC,gBAAgB,kBAAkB,GAAG,CAAA,GAAA,qMAAA,CAAA,WAAQ,AAAD,EAA4D,EAAE;IAEjH,uFAAuF;IACvF,MAAM,CAAC,6BAA6B,6BAA6B,GAAG,CAAA,GAAA,yIAAA,CAAA,oBAAiB,AAAD,EAAU,CAAC,QAAQ,EAAE,aAAa,UAAU,CAAC,EAAE;IACnI,MAAM,CAAC,WAAW,aAAa,GAAG,CAAA,GAAA,iIAAA,CAAA,oBAAiB,AAAD,EAAE,6BAA6B,sHAAA,CAAA,eAAY;IAC7F,CAAA,GAAA,qMAAA,CAAA,YAAS,AAAD,EAAE;QAAQ,6BAA6B;IAAY,GAAG;QAAC;QAAW;KAA6B;IAEvG,MAAM,CAAC,4BAA4B,4BAA4B,GAAG,CAAA,GAAA,yIAAA,CAAA,oBAAiB,AAAD,EAAU,CAAC,QAAQ,EAAE,aAAa,SAAS,CAAC,EAAE;IAChI,MAAM,CAAC,UAAU,YAAY,GAAG,CAAA,GAAA,iIAAA,CAAA,oBAAiB,AAAD,EAAE,4BAA4B,sHAAA,CAAA,eAAY;IAC1F,CAAA,GAAA,qMAAA,CAAA,YAAS,AAAD,EAAE;QAAQ,4BAA4B;IAAW,GAAG;QAAC;QAAU;KAA4B;IAEnG,MAAM,CAAC,yBAAyB,yBAAyB,GAAG,CAAA,GAAA,yIAAA,CAAA,oBAAiB,AAAD,EAAU,CAAC,QAAQ,EAAE,aAAa,MAAM,CAAC,EAAE;IACvH,MAAM,CAAC,OAAO,SAAS,GAAG,CAAA,GAAA,iIAAA,CAAA,oBAAiB,AAAD,EAAE,yBAAyB,sHAAA,CAAA,gBAAa;IAClF,CAAA,GAAA,qMAAA,CAAA,YAAS,AAAD,EAAE;QAAQ,yBAAyB;IAAQ,GAAG;QAAC;QAAO;KAAyB;IAEvF,MAAM,CAAC,yBAAyB,yBAAyB,GAAG,CAAA,GAAA,yIAAA,CAAA,oBAAiB,AAAD,EAAU,CAAC,QAAQ,EAAE,aAAa,MAAM,CAAC,EAAE;IACvH,MAAM,CAAC,OAAO,SAAS,GAAG,CAAA,GAAA,iIAAA,CAAA,oBAAiB,AAAD,EAAE,yBAAyB,sHAAA,CAAA,gBAAa;IAClF,CAAA,GAAA,qMAAA,CAAA,YAAS,AAAD,EAAE;QAAQ,yBAAyB;IAAQ,GAAG;QAAC;QAAO;KAAyB;IAEvF,MAAM,CAAC,eAAe,iBAAiB,GAAG,CAAA,GAAA,qMAAA,CAAA,WAAQ,AAAD,EAAiC;IAElF,MAAM,CAAC,YAAY,cAAc,GAAG,CAAA,GAAA,qMAAA,CAAA,WAAQ,AAAD,EAAE;IAC7C,MAAM,CAAC,eAAe,iBAAiB,GAAG,CAAA,GAAA,qMAAA,CAAA,WAAQ,AAAD,EAAuD;IACxG,MAAM,CAAC,aAAa,eAAe,GAAG,CAAA,GAAA,qMAAA,CAAA,WAAQ,AAAD,EAAiB;IAC9D,MAAM,CAAC,kBAAkB,oBAAoB,GAAG,CAAA,GAAA,qMAAA,CAAA,WAAQ,AAAD,EAAE;IAEzD,MAAM,CAAC,oBAAoB,sBAAsB,GAAG,CAAA,GAAA,qMAAA,CAAA,WAAQ,AAAD,EAAE;IAC7D,MAAM,CAAC,oBAAoB,sBAAsB,GAAG,CAAA,GAAA,qMAAA,CAAA,WAAQ,AAAD,EAAmB;IAE9E,MAAM,CAAC,qBAAqB,uBAAuB,GAAG,CAAA,GAAA,qMAAA,CAAA,WAAQ,AAAD,EAAE;IAC/D,MAAM,CAAC,WAAW,aAAa,GAAG,CAAA,GAAA,qMAAA,CAAA,WAAQ,AAAD,EAAiB;IAE1D,MAAM,gBAAgB,eAAe,gBAAgB,CAAA,GAAA,uIAAA,CAAA,UAAO,AAAD,EAAE,gBAAgB,CAAA,GAAA,uIAAA,CAAA,UAAO,AAAD,EAAE,iBAAiB,CAAA,GAAA,uIAAA,CAAA,UAAO,AAAD,EAAE,cAAc;IAC5H,MAAM,iBAAiB,CAAA,GAAA,qMAAA,CAAA,UAAO,AAAD,EAAE;QAC7B,IAAI,iBAAiB,eAAe,cAAc;YAChD,OAAO,CAAA,GAAA,gJAAA,CAAA,mBAAgB,AAAD,EAAE,CAAA,GAAA,0IAAA,CAAA,aAAU,AAAD,EAAE,eAAe,CAAA,GAAA,0IAAA,CAAA,aAAU,AAAD,EAAE;QAC/D;QACA,OAAO;IACT,GAAG;QAAC;QAAa;QAAc;KAAc;IAE7C,CAAA,GAAA,qMAAA,CAAA,YAAS,AAAD,EAAE;QACR,wCAAoD;YAClD,iBAAiB,gJAA4B,IAAI,CAAC,CAAA,IAAK,EAAE,UAAU;QACrE,OAAO;;QAEP;IACF,GAAG,EAAE;IAEL,MAAM,iBAAiB,CAAA,GAAA,qMAAA,CAAA,UAAO,AAAD,EAAE;QAC7B,IAAI,iBAAiB,iBAAiB,GAAG;YACvC,OAAO,CAAA,GAAA,4HAAA,CAAA,iBAAc,AAAD,EAClB,SAAS,aAAa,EACtB,gBACA,SAAS,WAAW,IAAI,GACxB,gBACA,SAAS,aAAa,EACtB,SAAS,aAAa,IAAI,GAC1B,eAAe;QAEnB;QACA,OAAO;IACT,GAAG;QAAC;QAAe;QAAU;QAAgB;QAAgB;KAAc;IAE3E,MAAM,4BAA4B,CAAA,GAAA,qMAAA,CAAA,cAAW,AAAD,EAAE;QAC5C,IAAI,CAAC,iBAAiB,CAAC,eAAe,CAAC,cAAc;YACnD,eAAe;YACf,yBAAyB;YACzB,kBAAkB,EAAE;YACpB;QACF;QAEA,yBAAyB;QACzB,eAAe;QACf,kBAAkB,EAAE;QAEpB,IAAI;YACF,MAAM,0BAA0B,MAAM,CAAA,GAAA,iIAAA,CAAA,iCAA8B,AAAD,EAAE;YACrE,oBAAoB;YAEpB,IAAI,WAAW;YACf,IAAI,UAAU,IAAI,KAAK,YAAY,OAAO;YAC1C,MAAO,CAAA,GAAA,wIAAA,CAAA,WAAQ,AAAD,EAAE,SAAS,cAAe;gBACtC,MAAM,aAAa,CAAA,GAAA,sJAAA,CAAA,SAAM,AAAD,EAAE,CAAA,GAAA,0IAAA,CAAA,aAAU,AAAD,EAAE,UAAU;gBAC/C,IAAI,wBAAwB,IAAI,CAAC,CAAA,IAAK,CAAA,GAAA,sJAAA,CAAA,SAAM,AAAD,EAAE,CAAA,GAAA,0IAAA,CAAA,aAAU,AAAD,EAAE,IAAI,kBAAkB,aAAa;oBACzF,WAAW;oBACX;gBACF;gBACA,UAAU,CAAA,GAAA,uIAAA,CAAA,UAAO,AAAD,EAAE,SAAS;YAC7B;YACA,eAAe,CAAC;YAEhB,IAAI,UAAU;gBACZ,MAAM,YAAY;oBAChB;wBAAE,MAAM,CAAA,GAAA,uIAAA,CAAA,UAAO,AAAD,EAAE,cAAe;wBAAI,IAAI,CAAA,GAAA,uIAAA,CAAA,UAAO,AAAD,EAAE,cAAe,IAAI;wBAAiB,gBAAgB;oBAAiB;oBACpH;wBAAE,MAAM,CAAA,GAAA,uIAAA,CAAA,UAAO,AAAD,EAAE,aAAc;wBAAI,IAAI,CAAA,GAAA,uIAAA,CAAA,UAAO,AAAD,EAAE,aAAc,IAAI;oBAAgB;iBACjF;gBACD,MAAM,mBAAmB,UAAU,MAAM,CAAC,CAAA;oBACxC,IAAI,oBAAoB;oBACxB,IAAI,eAAe,IAAI,KAAK,MAAM,IAAI,CAAC,OAAO;oBAC9C,MAAO,CAAA,GAAA,wIAAA,CAAA,WAAQ,AAAD,EAAE,cAAc,MAAM,EAAE,EAAG;wBACvC,MAAM,kBAAkB,CAAA,GAAA,sJAAA,CAAA,SAAM,AAAD,EAAE,CAAA,GAAA,0IAAA,CAAA,aAAU,AAAD,EAAE,eAAe;wBACzD,IAAI,wBAAwB,IAAI,CAAC,CAAA,IAAK,CAAA,GAAA,sJAAA,CAAA,SAAM,AAAD,EAAE,CAAA,GAAA,0IAAA,CAAA,aAAU,AAAD,EAAE,IAAI,kBAAkB,kBAAkB;4BAC9F,oBAAoB;4BACpB;wBACF;wBACA,eAAe,CAAA,GAAA,uIAAA,CAAA,UAAO,AAAD,EAAE,cAAc;oBACvC;oBACA,OAAO,qBAAqB,CAAC,CAAA,GAAA,wIAAA,CAAA,WAAQ,AAAD,EAAE,CAAA,GAAA,0IAAA,CAAA,aAAU,AAAD,EAAE,MAAM,IAAI,GAAG,CAAA,GAAA,0IAAA,CAAA,aAAU,AAAD,EAAE,IAAI;gBAC/E;gBACA,kBAAkB,iBAAiB,KAAK,CAAC,GAAG;YAC9C;QACF,EAAE,OAAO,OAAO;YACd,QAAQ,KAAK,CAAC,gCAAgC;YAC9C,MAAM;gBACJ,OAAO;gBACP,aAAa;gBACb,SAAS;YACX;YACA,eAAe;QACjB,SAAU;YACR,yBAAyB;QAC3B;IACF,GAAG;QAAC;QAAa;QAAc;QAAe;QAAc;QAAgB;KAAM;IAElF,CAAA,GAAA,qMAAA,CAAA,YAAS,AAAD,EAAE;QACR;IACF,GAAG;QAAC;KAA0B;IAE9B,MAAM,oBAAoB,CAAC;QACzB,kBAAkB,CAAC;YACjB,MAAM,WAAW,OAAO;YACxB,OAAO,KAAK,GAAG,CAAC,GAAG,KAAK,GAAG,CAAC,UAAU,SAAS,SAAS;QAC1D;IACF;IAEA,MAAM,wBAAwB,CAAC;QAC7B,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,EAAE,MAAM;QAChC,iEAAiE;QACjE,IAAI,SAAS,aAAa,aAAa;aAClC,IAAI,SAAS,YAAY,YAAY;aACrC,IAAI,SAAS,SAAS,SAAS;aAC/B,IAAI,SAAS,SAAS,SAAS;IACtC;IAEA,MAAM,oBAAoB;QACxB,IAAI,CAAC,WAAW,IAAI,IAAI;YACtB,eAAe;YACf;QACF;QACA,IAAI,CAAC,iBAAiB,CAAC,eAAe,CAAC,cAAc;YACnD,eAAe;YACf;QACF;QAEA,oBAAoB;QACpB,eAAe;QACf,iBAAiB;QAEjB,IAAI;YACF,MAAM,SAAS,MAAM,CAAA,GAAA,gIAAA,CAAA,yBAAsB,AAAD,EAAE,WAAW,IAAI,IAAI,aAAa,cAAc;YAC1F,IAAI,OAAO,KAAK,EAAE;gBAChB,eAAe,OAAO,KAAK;YAC7B,OAAO,IAAI,OAAO,kBAAkB,EAAE;gBACpC,iBAAiB;oBAAE,MAAM,WAAW,IAAI,GAAG,WAAW;oBAAI,oBAAoB,OAAO,kBAAkB;gBAAC;gBACxG,MAAM;oBACJ,OAAO;oBACP,aAAa,CAAC,qBAAqB,EAAE,OAAO,kBAAkB,CAAC,WAAW,CAAC;gBAC7E;YACF;QACF,EAAE,OAAO,OAAO;YACd,QAAQ,KAAK,CAAC,0BAA0B;YACxC,eAAe;QACjB,SAAU;YACR,oBAAoB;QACtB;IACF;IAEA,MAAM,qBAAqB;QACzB,iBAAiB;QACjB,cAAc;QACd,eAAe;QACf,MAAM;YAAE,OAAO;QAAiB;IAClC;IAEA,MAAM,8BAA8B,CAAC;QACnC,eAAe,MAAM,IAAI;QACzB,gBAAgB,MAAM,EAAE;QACxB,OAAO,QAAQ,CAAC;YAAE,KAAK;YAAG,UAAU;QAAS;IAC/C;IAEA,MAAM,0BAA0B,OAAO;QACrC,EAAE,cAAc;QAChB,aAAa;QAEb,IAAI,CAAC,iBAAiB,gBAAgB,QAAQ,CAAC,eAAe,CAAC,cAAc;YAC3E,aAAa;YACb;QACF;QACA,IAAI,CAAC,aAAa,CAAC,YAAY,CAAC,OAAO;YACrC,aAAa;YACb;QACF;QACA,IAAI,CAAC,eAAe,IAAI,CAAC,QAAQ;YAC/B,aAAa;YACb;QACF;QACA,IAAI,CAAC,OAAO;YACV,aAAa;YACb;QACF;QACA,IAAI,iBAAiB,KAAK,iBAAiB,SAAS,SAAS,EAAE;YAC7D,aAAa,CAAC,uCAAuC,EAAE,SAAS,SAAS,CAAC,CAAC,CAAC;YAC5E;QACF;QACA,IAAI,CAAC,gBAAgB;YACnB,aAAa;YACb;QACF;QAEA,uBAAuB;QAEvB,IAAI;YACF,MAAM,eAAe;gBACnB,YAAY;gBACZ,WAAW;oBAAE;oBAAW;oBAAU;oBAAO;gBAAM;gBAC/C,aAAa,YAAY,WAAW;gBACpC,cAAc,aAAa,WAAW;gBACtC,gBAAgB;gBAChB,SAAS;oBACP,UAAU,SAAS,aAAa;oBAChC,gBAAgB;oBAChB,aAAa,eAAe,WAAW;oBACvC,eAAe,SAAS,aAAa,IAAI;oBACzC,qBAAqB,KAAK,GAAG,CAAC,GAAG,iBAAiB,SAAS,aAAa;oBACxE,oBAAoB,eAAe,SAAS,GAAG,eAAe,aAAa;oBAC3E,UAAU,eAAe,QAAQ;oBACjC,OAAO;oBACP,gBAAgB,eAAe,cAAc;oBAC7C,OAAO,eAAe,KAAK;gBAC7B;gBACA,QAAQ;gBACR,mBAAmB,eAAe,QAAQ;YAC5C;YACA,MAAM,uBAAuB,MAAM,CAAA,GAAA,2IAAA,CAAA,6BAA0B,AAAD,EAAE;YAE9D,IAAI,qBAAqB,KAAK,IAAI,CAAC,qBAAqB,SAAS,EAAE;gBACjE,MAAM,IAAI,MAAM,qBAAqB,KAAK,IAAI;YAChD;YAEA,MAAM,EAAE,SAAS,EAAE,GAAG;YAEtB,MAAM,gBAAgB;gBACpB,UAAU;gBACV,aAAa,YAAY,WAAW;gBACpC,cAAc,aAAa,WAAW;gBACtC,gBAAgB;gBAChB,YAAY,eAAgB,KAAK;gBACjC,gBAAgB;gBAChB,mBAAmB,eAAe;gBAClC,oBAAoB,eAAe;gBACnC,gBAAgB;gBAChB,eAAe;gBACf,YAAY;gBACZ,kBAAkB;YACpB;YAEA,MAAM,eAAe,MAAM,8IAAgD,IAAI,CAAC,CAAA,IAAK,EAAE,qBAAqB,CAAC;YAE7G,IAAI,aAAa,KAAK,IAAI,CAAC,aAAa,SAAS,IAAI,CAAC,aAAa,UAAU,EAAE;gBAC7E,MAAM,IAAI,MAAM,aAAa,KAAK,IAAI;YACxC;YAEA,8BAA8B;YAC9B,IAAI;gBACF,OAAO,QAAQ,CAAC,MAAM,CAAC,aAAa,UAAU;YAChD,EAAE,OAAO,aAAa;gBACnB,QAAQ,IAAI,CAAC,kHAAkH;gBAC/H,MAAM,SAAS,MAAM;gBACrB,IAAI,CAAC,QAAQ,MAAM,IAAI,MAAM;gBAC7B,MAAM,EAAE,OAAO,mBAAmB,EAAE,GAAG,MAAM,OAAO,kBAAkB,CAAC;oBAAE,WAAW,aAAa,SAAS;gBAAC;gBAC3G,IAAI,qBAAqB;oBACvB,IAAI,oBAAoB,IAAI,KAAK,mBAAmB,oBAAoB,OAAO,CAAC,QAAQ,CAAC,4CAA4C;wBACnI,QAAQ,KAAK,CAAC;wBACd,aAAa;oBACf,OAAO;wBACL,MAAM,IAAI,MAAM,oBAAoB,OAAO,IAAI;oBACjD;gBACF;YACH;QAEF,EAAE,OAAO,OAAO;YACd,QAAQ,KAAK,CAAC,6BAA6B;YAC3C,MAAM,eAAe,iBAAiB,QAAQ,MAAM,OAAO,GAAG;YAC9D,aAAa;YACb,MAAM;gBACJ,OAAO;gBACP,aAAa;gBACb,SAAS;YACX;QACF,SAAU;YACR,uBAAuB;QACzB;IACF;IAEA,MAAM,2BAA2B;QAC/B,IAAI,CAAC,iBAAiB,CAAC,eAAe,CAAC,cAAc;QAErD,IAAI,uBAAuB,WAAW,CAAC,OAAO;YAC5C,MAAM;gBAAE,OAAO;gBAAuB,aAAa;gBAAoC,SAAS;YAAc;YAC9G;QACF;QACA,IAAI,uBAAuB,SAAS,CAAC,OAAO;YAC1C,MAAM;gBAAE,OAAO;gBAAuB,aAAa;gBAAmC,SAAS;YAAc;YAC7G;QACF;QAEA,uBAAuB;QACvB,IAAI;YACF,gDAAgD;YAChD,QAAQ,GAAG,CAAC,qEAAqE;gBAC/E,YAAY;gBACZ,aAAa,CAAA,GAAA,sJAAA,CAAA,SAAM,AAAD,EAAE,aAAa;gBACjC,cAAc,CAAA,GAAA,sJAAA,CAAA,SAAM,AAAD,EAAE,cAAc;gBACnC,QAAQ;gBACR,SAAS,uBAAuB,UAAU,QAAQ;YACpD;YACA,MAAM,IAAI,QAAQ,CAAA,MAAO,WAAW,KAAK;YAEzC,MAAM;gBACJ,OAAO;gBACP,aAAa,CAAC,qBAAqB,EAAE,mBAAmB,IAAI,EAAE,CAAA,GAAA,sJAAA,CAAA,SAAM,AAAD,EAAE,aAAa,SAAS,GAAG,EAAE,CAAA,GAAA,sJAAA,CAAA,SAAM,AAAD,EAAE,cAAc,SAAS,mBAAmB,CAAC;YACpJ;YACA,sBAAsB;QACxB,EAAE,OAAO,OAAO;YACd,QAAQ,KAAK,CAAC,sCAAsC;YACpD,MAAM;gBACJ,OAAO;gBACP,aAAa,CAAC,0CAA0C,EAAE,iBAAiB,QAAQ,MAAM,OAAO,GAAG,IAAI;gBACvG,SAAS;YACX;QACF,SAAU;YACR,uBAAuB;QACzB;IACF;IAEA,MAAM,2BAA2B;QAC/B,IAAI,uBAAuB;YACzB,qBACE,8OAAC,iIAAA,CAAA,QAAK;gBAAC,SAAQ;gBAAU,WAAU;;kCACjC,8OAAC,iNAAA,CAAA,UAAO;wBAAC,WAAU;;;;;;kCACnB,8OAAC,iIAAA,CAAA,aAAU;kCAAC;;;;;;kCACZ,8OAAC,iIAAA,CAAA,mBAAgB;kCAAC;;;;;;;;;;;;QAGxB;QACA,IAAI,gBAAgB,QAAQ,iBAAiB,eAAe,cAAc;YACxE,qBACE,8OAAC,iIAAA,CAAA,QAAK;gBAAC,SAAQ;gBAAU,WAAU;;kCACjC,8OAAC,2NAAA,CAAA,cAAW;wBAAC,WAAU;;;;;;kCACvB,8OAAC,iIAAA,CAAA,aAAU;kCAAC;;;;;;kCACZ,8OAAC,iIAAA,CAAA,mBAAgB;;4BAAC;4BACM,GAAG,CAAA,GAAA,sJAAA,CAAA,SAAM,AAAD,EAAE,aAAa,SAAS,GAAG,EAAE,CAAA,GAAA,sJAAA,CAAA,SAAM,AAAD,EAAE,cAAc,SAAS,EAAE,EAAE,eAAe,QAAQ,CAAC;4BAAC;;;;;;;;;;;;;QAI9H;QACA,IAAI,gBAAgB,SAAS,iBAAiB,eAAe,cAAc;YACzE,qBACE,8OAAC,iIAAA,CAAA,QAAK;gBAAC,SAAQ;;kCACb,8OAAC,4MAAA,CAAA,UAAO;wBAAC,WAAU;;;;;;kCACnB,8OAAC,iIAAA,CAAA,aAAU;kCAAC;;;;;;kCACZ,8OAAC,iIAAA,CAAA,mBAAgB;;4BAAC;4BACoB,GAAG,CAAA,GAAA,sJAAA,CAAA,SAAM,AAAD,EAAE,aAAa,SAAS,GAAG,EAAE,CAAA,GAAA,sJAAA,CAAA,SAAM,AAAD,EAAE,cAAc,UAAU;4BAAC;;;;;;;;;;;;;QAIjH;QACA,IAAI,CAAC,eAAe;YAClB,qBACE,8OAAC,iIAAA,CAAA,QAAK;gBAAC,SAAQ;gBAAU,WAAU;;kCACjC,8OAAC,kMAAA,CAAA,OAAI;wBAAC,WAAU;;;;;;kCAChB,8OAAC,iIAAA,CAAA,aAAU;kCAAC;;;;;;kCACZ,8OAAC,iIAAA,CAAA,mBAAgB;kCAAC;;;;;;;;;;;;QAGxB;QACA,OAAO;IACT;IAEA,MAAM,uBAAuB;QAC3B,IAAI,yBAAyB,gBAAgB,SAAS,eAAe,MAAM,KAAK,GAAG;YACjF,OAAO;QACT;QACA,qBACE,8OAAC,gIAAA,CAAA,OAAI;YAAC,WAAU;;8BACd,8OAAC,gIAAA,CAAA,aAAU;;sCACT,8OAAC,gIAAA,CAAA,YAAS;4BAAC,WAAU;sCAAyB;;;;;;sCAC9C,8OAAC,gIAAA,CAAA,kBAAe;4BAAC,WAAU;sCAAiB;;;;;;;;;;;;8BAI9C,8OAAC,gIAAA,CAAA,cAAW;oBAAC,WAAU;8BACpB,eAAe,GAAG,CAAC,CAAC,OAAO,sBAC1B,8OAAC,kIAAA,CAAA,SAAM;4BAEL,SAAQ;4BACR,WAAU;4BACV,SAAS,IAAM,4BAA4B;;8CAE3C,8OAAC;;wCACE,CAAA,GAAA,sJAAA,CAAA,SAAM,AAAD,EAAE,MAAM,IAAI,EAAE;wCAAe;wCAAI,CAAA,GAAA,sJAAA,CAAA,SAAM,AAAD,EAAE,MAAM,EAAE,EAAE;wCAAe;wCAAG,CAAA,GAAA,gJAAA,CAAA,mBAAgB,AAAD,EAAE,MAAM,EAAE,EAAE,MAAM,IAAI;wCAAE;;;;;;;gCAElH,MAAM,cAAc,kBAAI,8OAAC,iIAAA,CAAA,QAAK;oCAAC,SAAQ;8CAAa,MAAM,cAAc;;;;;;;2BARpE;;;;;;;;;;;;;;;;IAcjB;IAEA,MAAM,6BAA6B;QACjC,IAAI,gBAAgB,QAAS,yBAAyB,iBAAiB,MAAM,KAAK,GAAI;YACpF,OAAO;QACT;QACA,MAAM,eAAe,eAAe,CAAA,GAAA,uIAAA,CAAA,UAAO,AAAD,EAAE,eAAe,cAAc,IAAI;QAC7E,MAAM,sBAAsB,CAAA,GAAA,4IAAA,CAAA,eAAY,AAAD,EAAE;QACzC,qBACE,8OAAC;YAAI,WAAU;;8BACb,8OAAC;oBAAG,WAAU;8BAA6B;;;;;;8BAC3C,8OAAC,yJAAA,CAAA,uBAAoB;oBACnB,cAAc;oBACd,kBAAkB;oBAClB,eAAe,iBAAiB,eAAe,eAAe;wBAAE,MAAM;wBAAa,IAAI;oBAAa,IAAI;;;;;;;;;;;;IAIhH;IAEA,MAAM,yBAAyB;QAC7B,IAAI,yBAAyB,gBAAgB,SAAS,CAAC,iBAAiB,CAAC,eAAe,CAAC,cAAc,OAAO;QAC9G,qBACE,8OAAC,gIAAA,CAAA,OAAI;YAAC,WAAU;;8BACd,8OAAC,gIAAA,CAAA,aAAU;;sCACT,8OAAC,gIAAA,CAAA,YAAS;4BAAC,WAAU;sCAAwB;;;;;;sCAC7C,8OAAC,gIAAA,CAAA,kBAAe;4BAAC,WAAU;;gCAAgB;gCACxB,GAAG,CAAA,GAAA,sJAAA,CAAA,SAAM,AAAD,EAAE,aAAa,SAAS,GAAG,EAAE,CAAA,GAAA,sJAAA,CAAA,SAAM,AAAD,EAAE,cAAc,UAAU;gCAAC;;;;;;;;;;;;;8BAG1F,8OAAC,gIAAA,CAAA,cAAW;oBAAC,WAAU;;sCACrB,8OAAC;4BAAI,WAAU;;8CACb,8OAAC,oIAAA,CAAA,WAAQ;oCACP,IAAG;oCACH,SAAS;oCACT,iBAAiB,CAAC,UAAY,sBAAsB;;;;;;8CAEtD,8OAAC,iIAAA,CAAA,QAAK;oCAAC,SAAQ;oCAAsB,WAAU;8CAAc;;;;;;;;;;;;wBAI9D,oCACC;;8CACE,8OAAC,qIAAA,CAAA,YAAS;;;;;8CACV,8OAAC;oCAAE,WAAU;8CAAsB;;;;;;8CACnC,8OAAC,0IAAA,CAAA,aAAU;oCACT,OAAO;oCACP,eAAe,CAAC,QAAU,sBAAsB;oCAChD,WAAU;;sDAEV,8OAAC;4CAAI,WAAU;;8DACb,8OAAC,0IAAA,CAAA,iBAAc;oDAAC,OAAM;oDAAQ,IAAG;;;;;;8DACjC,8OAAC,iIAAA,CAAA,QAAK;oDAAC,SAAQ;oDAAe,WAAU;;sEAA0B,8OAAC,kMAAA,CAAA,OAAI;4DAAC,WAAU;;;;;;wDAAY;;;;;;;;;;;;;sDAEhG,8OAAC;4CAAI,WAAU;;8DACb,8OAAC,0IAAA,CAAA,iBAAc;oDAAC,OAAM;oDAAM,IAAG;;;;;;8DAC/B,8OAAC,iIAAA,CAAA,QAAK;oDAAC,SAAQ;oDAAa,WAAU;;sEAA0B,8OAAC,oMAAA,CAAA,QAAK;4DAAC,WAAU;;;;;;wDAAY;;;;;;;;;;;;;;;;;;;gCAGhG,uBAAuB,yBACtB,8OAAC,iIAAA,CAAA,QAAK;oCACJ,MAAK;oCACL,aAAY;oCACZ,OAAO;oCACP,UAAU,CAAC,IAAM,SAAS,EAAE,MAAM,CAAC,KAAK;oCACxC,UAAU,uBAAuB;oCACjC,WAAU;;;;;;gCAGb,uBAAuB,uBACtB,8OAAC,iIAAA,CAAA,QAAK;oCACJ,MAAK;oCACL,aAAY;oCACZ,OAAO;oCACP,UAAU,CAAC,IAAM,SAAS,EAAE,MAAM,CAAC,KAAK;oCACxC,UAAU,uBAAuB;oCACjC,WAAU;;;;;;8CAGd,8OAAC,kIAAA,CAAA,SAAM;oCACL,SAAS;oCACT,UAAU;oCACV,MAAK;;wCAEJ,oCAAsB,8OAAC,iNAAA,CAAA,UAAO;4CAAC,WAAU;;;;;mDAAiC;wCAAK;;;;;;;;;;;;;;;;;;;;;IAQ9F;IAEA,qBACE,8OAAC;QAAI,WAAU;;0BACb,8OAAC;gBAAI,WAAU;;oBACZ;oBACA;oBACA;oBACA;;;;;;;YAGF,gBAAgB,sBACf,8OAAC,gIAAA,CAAA,OAAI;gBAAC,WAAU;;kCACd,8OAAC,gIAAA,CAAA,aAAU;;0CACT,8OAAC,gIAAA,CAAA,YAAS;0CAAC;;;;;;0CACX,8OAAC,gIAAA,CAAA,kBAAe;0CAAC;;;;;;;;;;;;kCAEnB,8OAAC,gIAAA,CAAA,cAAW;kCACT,sCACC,8OAAC;4BAAI,WAAU;sCACb,cAAA,8OAAC,iNAAA,CAAA,UAAO;gCAAC,WAAU;;;;;;;;;;iDAGrB,8OAAC;4BAAK,UAAU;4BAAyB,WAAU;;8CACjD,8OAAC;oCAAI,WAAU;;wCACZ,iBAAiB,eAAe,8BAC/B,8OAAC;4CAAI,WAAU;;8DACb,8OAAC,iIAAA,CAAA,QAAK;8DAAC;;;;;;8DACP,8OAAC;oDAAI,WAAU;;sEACb,8OAAC;4DAAK,WAAU;;gEACb,CAAA,GAAA,sJAAA,CAAA,SAAM,AAAD,EAAE,aAAa;gEAAgB;gEAAI,CAAA,GAAA,sJAAA,CAAA,SAAM,AAAD,EAAE,cAAc;;;;;;;sEAEhE,8OAAC;4DAAK,WAAU;;gEAAgC;gEAAE;gEAAe;;;;;;;;;;;;;;;;;;;sDAIvE,8OAAC;4CAAI,WAAU;;8DACb,8OAAC,iIAAA,CAAA,QAAK;oDAAC,SAAQ;8DAAS;;;;;;8DACxB,8OAAC;oDAAI,WAAU;;sEACb,8OAAC,kIAAA,CAAA,SAAM;4DACL,MAAK;4DACL,SAAQ;4DACR,MAAK;4DACL,WAAU;4DACV,SAAS,IAAM,kBAAkB,CAAC;4DAClC,UAAU,kBAAkB,KAAK;4DACjC,cAAW;sEAEX,cAAA,8OAAC,oMAAA,CAAA,QAAK;gEAAC,WAAU;;;;;;;;;;;sEAEnB,8OAAC;4DAAK,WAAU;4DAAmC,IAAG;sEACnD;;;;;;sEAEH,8OAAC,kIAAA,CAAA,SAAM;4DACL,MAAK;4DACL,SAAQ;4DACR,MAAK;4DACL,WAAU;4DACV,SAAS,IAAM,kBAAkB;4DACjC,UAAU,kBAAkB,SAAS,SAAS,IAAI;4DAClD,cAAW;sEAEX,cAAA,8OAAC,kMAAA,CAAA,OAAI;gEAAC,WAAU;;;;;;;;;;;;;;;;;8DAGpB,8OAAC;oDAAE,WAAU;;wDAAqC;wDAC3C,SAAS,SAAS;wDAAC;wDAAY,SAAS,aAAa;wDAAC;wDAC1D,CAAC,SAAS,aAAa,IAAI,CAAC,IAAI,KAAK,CAAC,SAAS,EAAE,CAAC,SAAS,aAAa,IAAI,CAAC,EAAE,OAAO,CAAC,GAAG,aAAa,CAAC;;;;;;;;;;;;;;;;;;;8CAI/G,8OAAC;oCAAI,WAAU;8CACb,cAAA,8OAAC;wCAAI,WAAU;;0DACb,8OAAC,iIAAA,CAAA,QAAK;gDAAC,SAAQ;0DAAS;;;;;;0DACxB,8OAAC;gDAAI,WAAU;;kEACb,8OAAC,iIAAA,CAAA,QAAK;wDAAC,IAAG;wDAAS,aAAY;wDAAa,OAAO;wDAAY,UAAU,CAAC,IAAM,cAAc,EAAE,MAAM,CAAC,KAAK;wDAAG,UAAU,oBAAoB,CAAC,CAAC,iBAAiB;;;;;;oDAC/J,CAAC,8BACA,8OAAC,kIAAA,CAAA,SAAM;wDAAC,MAAK;wDAAS,SAAQ;wDAAU,SAAS;wDAAmB,UAAU,oBAAoB,CAAC,WAAW,IAAI,MAAM;kEACrH,iCAAmB,8OAAC,iNAAA,CAAA,UAAO;4DAAC,WAAU;;;;;iFAA4B,8OAAC,wNAAA,CAAA,gBAAa;4DAAC,WAAU;;;;;;;;;;6EAG9F,8OAAC,kIAAA,CAAA,SAAM;wDAAC,MAAK;wDAAS,SAAQ;wDAAQ,MAAK;wDAAO,SAAS;wDAAoB,UAAU;kEAAqB,cAAA,8OAAC,4LAAA,CAAA,IAAC;4DAAC,WAAU;;;;;;;;;;;;;;;;;0DAG/H,8OAAC;gDAAI,WAAU;;oDACZ,6BAAe,8OAAC;wDAAE,WAAU;kEAAoB;;;;;;oDAChD,+BAAiB,8OAAC;wDAAE,WAAU;;4DAAiB;4DAAU,cAAc,IAAI;4DAAC;4DAAG,cAAc,kBAAkB;4DAAC;;;;;;;;;;;;;;;;;;;;;;;;gCAItH,gCACC,8OAAC;oCAAI,WAAU;;sDACb,8OAAC;4CAAG,WAAU;sDAAqB;;;;;;sDACnC,8OAAC;4CAAI,WAAU;;8DAAuB,8OAAC;;wDAAK;wDAAa;wDAAe;;;;;;;8DAAe,8OAAC;;wDAAK;wDAAE,eAAe,SAAS,CAAC,OAAO,CAAC;;;;;;;;;;;;;wCAC/H,eAAe,aAAa,GAAG,mBAAK,8OAAC;4CAAI,WAAU;;8DAA6C,8OAAC;8DAAK;;;;;;8DAAsB,8OAAC;;wDAAK;wDAAG,eAAe,aAAa,CAAC,OAAO,CAAC;;;;;;;;;;;;;sDAC3K,8OAAC;4CAAI,WAAU;;8DAAuB,8OAAC;8DAAK;;;;;;8DAAmB,8OAAC;;wDAAK;wDAAG,eAAe,WAAW,CAAC,OAAO,CAAC;;;;;;;;;;;;;sDAC3G,8OAAC,qIAAA,CAAA,YAAS;4CAAC,WAAU;;;;;;sDACrB,8OAAC;4CAAI,WAAU;;8DAAmC,8OAAC;8DAAK;;;;;;8DAAe,8OAAC;;wDAAK;wDAAE,eAAe,QAAQ,CAAC,OAAO,CAAC;;;;;;;;;;;;;wCAC9G,+BAAiB,8OAAC;4CAAI,WAAU;;8DAAsC,8OAAC;;wDAAK;wDAAW,cAAc,IAAI;wDAAC;;;;;;;8DAAQ,8OAAC;;wDAAK;wDAAG,eAAe,cAAc,CAAC,OAAO,CAAC;;;;;;;;;;;;;sDAClK,8OAAC,qIAAA,CAAA,YAAS;4CAAC,WAAU;;;;;;sDACrB,8OAAC;4CAAI,WAAU;;8DAA2C,8OAAC;8DAAK;;;;;;8DAAY,8OAAC;;wDAAK;wDAAE,eAAe,KAAK,CAAC,OAAO,CAAC;;;;;;;;;;;;;;;;;;;8CAGrH,8OAAC;oCAAI,WAAU;;sDACb,8OAAC;4CAAG,WAAU;sDAAgB;;;;;;sDAC9B,8OAAC;4CAAI,WAAU;;8DACb,8OAAC;oDAAI,WAAU;;sEACb,8OAAC,iIAAA,CAAA,QAAK;4DAAC,SAAQ;sEAAY;;;;;;sEAC3B,8OAAC,iIAAA,CAAA,QAAK;4DAAC,IAAG;4DAAY,MAAK;4DAAY,OAAO;4DAAW,UAAU;4DAAuB,QAAQ;4DAAC,UAAU;;;;;;;;;;;;8DAE/G,8OAAC;oDAAI,WAAU;;sEACb,8OAAC,iIAAA,CAAA,QAAK;4DAAC,SAAQ;sEAAW;;;;;;sEAC1B,8OAAC,iIAAA,CAAA,QAAK;4DAAC,IAAG;4DAAW,MAAK;4DAAW,OAAO;4DAAU,UAAU;4DAAuB,QAAQ;4DAAC,UAAU;;;;;;;;;;;;;;;;;;sDAG9G,8OAAC;4CAAI,WAAU;;8DACb,8OAAC;oDAAI,WAAU;;sEACb,8OAAC,iIAAA,CAAA,QAAK;4DAAC,SAAQ;sEAAQ;;;;;;sEACvB,8OAAC,iIAAA,CAAA,QAAK;4DAAC,IAAG;4DAAQ,MAAK;4DAAQ,MAAK;4DAAQ,OAAO;4DAAO,UAAU;4DAAuB,QAAQ;4DAAC,UAAU;;;;;;;;;;;;8DAEhH,8OAAC;oDAAI,WAAU;;sEACb,8OAAC,iIAAA,CAAA,QAAK;4DAAC,SAAQ;sEAAQ;;;;;;sEACvB,8OAAC,iIAAA,CAAA,QAAK;4DAAC,IAAG;4DAAQ,MAAK;4DAAQ,MAAK;4DAAM,OAAO;4DAAO,UAAU;4DAAuB,QAAQ;4DAAC,UAAU;;;;;;;;;;;;;;;;;;;;;;;;gCAIjH,2BACC,8OAAC,iIAAA,CAAA,QAAK;oCAAC,SAAQ;;sDACb,8OAAC,wNAAA,CAAA,gBAAa;4CAAC,WAAU;;;;;;sDACzB,8OAAC,iIAAA,CAAA,aAAU;sDAAC;;;;;;sDACZ,8OAAC,iIAAA,CAAA,mBAAgB;sDAAE;;;;;;;;;;;;8CAGvB,8OAAC,kIAAA,CAAA,SAAM;oCAAC,MAAK;oCAAS,WAAU;oCAAS,UAAU;;wCAChD,oCAAsB,8OAAC,iNAAA,CAAA,UAAO;4CAAC,WAAU;;;;;iEAAiC,8OAAC,kNAAA,CAAA,aAAU;4CAAC,WAAU;;;;;;wCAChG,sBAAsB,kBAAkB;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAS3D","debugId":null}},
    {"offset": {"line": 3108, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/components/ui/popover.tsx"],"sourcesContent":["\"use client\"\n\nimport * as React from \"react\"\nimport * as PopoverPrimitive from \"@radix-ui/react-popover\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Popover = PopoverPrimitive.Root\n\nconst PopoverTrigger = PopoverPrimitive.Trigger\n\nconst PopoverContent = React.forwardRef<\n  React.ElementRef<typeof PopoverPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof PopoverPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <PopoverPrimitive.Portal>\n    <PopoverPrimitive.Content\n      ref={ref}\n      align={align}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2\",\n        className\n      )}\n      {...props}\n    />\n  </PopoverPrimitive.Portal>\n))\nPopoverContent.displayName = PopoverPrimitive.Content.displayName\n\nexport { Popover, PopoverTrigger, PopoverContent }\n"],"names":[],"mappings":";;;;;;AAEA;AACA;AAEA;AALA;;;;;AAOA,MAAM,UAAU,mKAAA,CAAA,OAAqB;AAErC,MAAM,iBAAiB,mKAAA,CAAA,UAAwB;AAE/C,MAAM,+BAAiB,CAAA,GAAA,qMAAA,CAAA,aAAgB,AAAD,EAGpC,CAAC,EAAE,SAAS,EAAE,QAAQ,QAAQ,EAAE,aAAa,CAAC,EAAE,GAAG,OAAO,EAAE,oBAC5D,8OAAC,mKAAA,CAAA,SAAuB;kBACtB,cAAA,8OAAC,mKAAA,CAAA,UAAwB;YACvB,KAAK;YACL,OAAO;YACP,YAAY;YACZ,WAAW,CAAA,GAAA,mHAAA,CAAA,KAAE,AAAD,EACV,8aACA;YAED,GAAG,KAAK;;;;;;;;;;;AAIf,eAAe,WAAW,GAAG,mKAAA,CAAA,UAAwB,CAAC,WAAW","debugId":null}},
    {"offset": {"line": 3149, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/components/booking/initial-booking-form.tsx"],"sourcesContent":["// src/components/booking/initial-booking-form.tsx\n\"use client\";\n\nimport * as React from 'react';\nimport { useState } from 'react';\nimport { useRouter } from 'next/navigation';\nimport { format, isAfter } from 'date-fns';\nimport type { DateRange } from 'react-day-picker';\nimport { Calendar as CalendarIcon, SearchCheck, Loader2 } from 'lucide-react';\n\nimport { cn } from '@/lib/utils';\nimport { Button } from '@/components/ui/button';\nimport { Calendar } from '@/components/ui/calendar';\nimport {\n  Popover,\n  PopoverContent,\n  PopoverTrigger,\n} from '@/components/ui/popover';\nimport { Label } from '@/components/ui/label';\nimport { useToast } from \"@/hooks/use-toast\";\nimport type { Property } from '@/types';\n\ninterface InitialBookingFormProps {\n  property: Property;\n  size?: 'compressed' | 'large'; // Add optional size prop\n}\n\nexport function InitialBookingForm({ property, size = 'compressed' }: InitialBookingFormProps) {\n  const [date, setDate] = useState<DateRange | undefined>(undefined);\n  const [isLoading, setIsLoading] = useState(false);\n  const router = useRouter();\n  const { toast } = useToast();\n\n  // Check if date range is valid (end date is after start date)\n  const isDateRangeValid = (): boolean => {\n    if (!date?.from || !date?.to) {\n      return false;\n    }\n    // Ensure end date is strictly after start date\n    return isAfter(date.to, date.from);\n  };\n\n  const handleCheckAvailability = () => {\n    if (!isDateRangeValid()) {\n      toast({\n        title: \"Invalid Dates\",\n        description: \"Please select a valid check-in and check-out date.\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    setIsLoading(true);\n\n    // Construct the URL for the availability check page (only dates)\n    const checkIn = format(date!.from!, 'yyyy-MM-dd');\n    const checkOut = format(date!.to!, 'yyyy-MM-dd');\n    const params = new URLSearchParams({\n      checkIn,\n      checkOut,\n    });\n\n    // Navigate to the new availability check page\n    router.push(`/booking/check/${property.slug}?${params.toString()}`);\n  };\n\n  const isButtonDisabled = !isDateRangeValid() || isLoading;\n\n  // Conditionally apply classes based on the size prop\n  const formContainerClasses = cn(\n    'space-y-4', // Default vertical spacing\n    size === 'large' && 'flex flex-col md:flex-row md:items-end md:space-y-0 md:space-x-2 w-full' // Flex layout for large size on medium screens and up\n  );\n\n  const datePickerContainerClasses = cn(\n    'grid gap-2',\n    size === 'large' && 'flex-grow' // Allow date picker to take up space in large layout\n  );\n\n  const buttonContainerClasses = cn(\n    'w-full',\n    size === 'large' && 'md:w-auto md:shrink-0' // Adjust button width for large layout\n  );\n\n  return (\n    <div className={formContainerClasses}>\n      {/* Date Range Picker */}\n      <div className={datePickerContainerClasses}>\n         {/* Hide label visually but keep for accessibility if needed, or remove if context is clear */}\n         <Label htmlFor=\"date\" className={cn(size === 'large' ? \"sr-only\" : \"text-sm font-medium text-foreground\")}>\n             Check-in / Check-out Dates\n         </Label>\n         <Popover>\n          <PopoverTrigger asChild>\n            <Button\n              id=\"date\"\n              variant={'outline'}\n              className={cn(\n                'w-full justify-start text-left font-normal', // Ensure full width by default\n                !date && 'text-muted-foreground'\n              )}\n              disabled={isLoading}\n            >\n              <CalendarIcon className=\"mr-2 h-4 w-4\" />\n              {date?.from ? (\n                date.to ? (\n                  <>\n                    {format(date.from, 'LLL dd, y')} -{' '}\n                    {format(date.to, 'LLL dd, y')}\n                  </>\n                ) : (\n                  format(date.from, 'LLL dd, y')\n                )\n              ) : (\n                <span>Pick a date range</span>\n              )}\n            </Button>\n          </PopoverTrigger>\n          <PopoverContent className=\"w-auto p-0\" align=\"start\">\n              <Calendar\n                  initialFocus\n                  mode=\"range\"\n                  defaultMonth={date?.from || new Date()}\n                  selected={date}\n                  onSelect={setDate}\n                  numberOfMonths={1}\n                  disabled={{ before: new Date(new Date().setHours(0, 0, 0, 0)) }} // Only disable past dates\n              />\n          </PopoverContent>\n        </Popover>\n      </div>\n\n      {/* Check Availability Button */}\n      <div className={buttonContainerClasses}>\n          {/* Add an invisible label for large layout alignment if needed, or adjust flex alignment */}\n          {size === 'large' && <Label htmlFor=\"check-availability-btn\" className=\"text-sm font-medium text-transparent md:block hidden\">Submit</Label> }\n          <Button\n            id=\"check-availability-btn\"\n            type=\"button\"\n            onClick={handleCheckAvailability}\n            className=\"w-full bg-primary hover:bg-primary/90 text-primary-foreground\" // Ensure full width by default\n            disabled={isButtonDisabled}\n          >\n            {isLoading ? (\n              <>\n                <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\n                Checking...\n              </>\n            ) : (\n              <>\n                <SearchCheck className=\"mr-2 h-4 w-4\" />\n                Check Availability\n              </>\n            )}\n          </Button>\n       </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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","debugId":null}}]
}