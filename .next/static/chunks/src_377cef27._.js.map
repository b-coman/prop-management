{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 7, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/components/ui/table.tsx"],"sourcesContent":["import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Table = React.forwardRef<\n  HTMLTableElement,\n  React.HTMLAttributes<HTMLTableElement>\n>(({ className, ...props }, ref) => (\n  <div className=\"relative w-full overflow-auto\">\n    <table\n      ref={ref}\n      className={cn(\"w-full caption-bottom text-sm\", className)}\n      {...props}\n    />\n  </div>\n))\nTable.displayName = \"Table\"\n\nconst TableHeader = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <thead ref={ref} className={cn(\"[&_tr]:border-b\", className)} {...props} />\n))\nTableHeader.displayName = \"TableHeader\"\n\nconst TableBody = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tbody\n    ref={ref}\n    className={cn(\"[&_tr:last-child]:border-0\", className)}\n    {...props}\n  />\n))\nTableBody.displayName = \"TableBody\"\n\nconst TableFooter = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tfoot\n    ref={ref}\n    className={cn(\n      \"border-t bg-muted/50 font-medium [&>tr]:last:border-b-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableFooter.displayName = \"TableFooter\"\n\nconst TableRow = React.forwardRef<\n  HTMLTableRowElement,\n  React.HTMLAttributes<HTMLTableRowElement>\n>(({ className, ...props }, ref) => (\n  <tr\n    ref={ref}\n    className={cn(\n      \"border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nTableRow.displayName = \"TableRow\"\n\nconst TableHead = React.forwardRef<\n  HTMLTableCellElement,\n  React.ThHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <th\n    ref={ref}\n    className={cn(\n      \"h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableHead.displayName = \"TableHead\"\n\nconst TableCell = React.forwardRef<\n  HTMLTableCellElement,\n  React.TdHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <td\n    ref={ref}\n    className={cn(\"p-4 align-middle [&:has([role=checkbox])]:pr-0\", className)}\n    {...props}\n  />\n))\nTableCell.displayName = \"TableCell\"\n\nconst TableCaption = React.forwardRef<\n  HTMLTableCaptionElement,\n  React.HTMLAttributes<HTMLTableCaptionElement>\n>(({ className, ...props }, ref) => (\n  <caption\n    ref={ref}\n    className={cn(\"mt-4 text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nTableCaption.displayName = \"TableCaption\"\n\nexport {\n  Table,\n  TableHeader,\n  TableBody,\n  TableFooter,\n  TableHead,\n  TableRow,\n  TableCell,\n  TableCaption,\n}\n"],"names":[],"mappings":";;;;;;;;;;;AAAA;AAEA;;;;AAEA,MAAM,sBAAQ,CAAA,GAAA,6JAAA,CAAA,aAAgB,AAAD,OAG3B,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,6LAAC;QAAI,WAAU;kBACb,cAAA,6LAAC;YACC,KAAK;YACL,WAAW,CAAA,GAAA,sHAAA,CAAA,KAAE,AAAD,EAAE,iCAAiC;YAC9C,GAAG,KAAK;;;;;;;;;;;;AAIf,MAAM,WAAW,GAAG;AAEpB,MAAM,4BAAc,CAAA,GAAA,6JAAA,CAAA,aAAgB,AAAD,QAGjC,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,6LAAC;QAAM,KAAK;QAAK,WAAW,CAAA,GAAA,sHAAA,CAAA,KAAE,AAAD,EAAE,mBAAmB;QAAa,GAAG,KAAK;;;;;;;AAEzE,YAAY,WAAW,GAAG;AAE1B,MAAM,0BAAY,CAAA,GAAA,6JAAA,CAAA,aAAgB,AAAD,QAG/B,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,6LAAC;QACC,KAAK;QACL,WAAW,CAAA,GAAA,sHAAA,CAAA,KAAE,AAAD,EAAE,8BAA8B;QAC3C,GAAG,KAAK;;;;;;;AAGb,UAAU,WAAW,GAAG;AAExB,MAAM,4BAAc,CAAA,GAAA,6JAAA,CAAA,aAAgB,AAAD,QAGjC,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,6LAAC;QACC,KAAK;QACL,WAAW,CAAA,GAAA,sHAAA,CAAA,KAAE,AAAD,EACV,2DACA;QAED,GAAG,KAAK;;;;;;;AAGb,YAAY,WAAW,GAAG;AAE1B,MAAM,yBAAW,CAAA,GAAA,6JAAA,CAAA,aAAgB,AAAD,QAG9B,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,6LAAC;QACC,KAAK;QACL,WAAW,CAAA,GAAA,sHAAA,CAAA,KAAE,AAAD,EACV,+EACA;QAED,GAAG,KAAK;;;;;;;AAGb,SAAS,WAAW,GAAG;AAEvB,MAAM,0BAAY,CAAA,GAAA,6JAAA,CAAA,aAAgB,AAAD,SAG/B,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,6LAAC;QACC,KAAK;QACL,WAAW,CAAA,GAAA,sHAAA,CAAA,KAAE,AAAD,EACV,oGACA;QAED,GAAG,KAAK;;;;;;;AAGb,UAAU,WAAW,GAAG;AAExB,MAAM,0BAAY,CAAA,GAAA,6JAAA,CAAA,aAAgB,AAAD,SAG/B,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,6LAAC;QACC,KAAK;QACL,WAAW,CAAA,GAAA,sHAAA,CAAA,KAAE,AAAD,EAAE,kDAAkD;QAC/D,GAAG,KAAK;;;;;;;AAGb,UAAU,WAAW,GAAG;AAExB,MAAM,6BAAe,CAAA,GAAA,6JAAA,CAAA,aAAgB,AAAD,SAGlC,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,6LAAC;QACC,KAAK;QACL,WAAW,CAAA,GAAA,sHAAA,CAAA,KAAE,AAAD,EAAE,sCAAsC;QACnD,GAAG,KAAK;;;;;;;AAGb,aAAa,WAAW,GAAG","debugId":null}},
    {"offset": {"line": 145, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/components/ui/badge.tsx"],"sourcesContent":["import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst badgeVariants = cva(\n  \"inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2\",\n  {\n    variants: {\n      variant: {\n        default:\n          \"border-transparent bg-primary text-primary-foreground hover:bg-primary/80\",\n        secondary:\n          \"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80\",\n        destructive:\n          \"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80\",\n        outline: \"text-foreground\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nexport interface BadgeProps\n  extends React.HTMLAttributes<HTMLDivElement>,\n    VariantProps<typeof badgeVariants> {}\n\nfunction Badge({ className, variant, ...props }: BadgeProps) {\n  return (\n    <div className={cn(badgeVariants({ variant }), className)} {...props} />\n  )\n}\n\nexport { Badge, badgeVariants }\n"],"names":[],"mappings":";;;;;AACA;AAEA;;;;AAEA,MAAM,gBAAgB,CAAA,GAAA,mKAAA,CAAA,MAAG,AAAD,EACtB,0KACA;IACE,UAAU;QACR,SAAS;YACP,SACE;YACF,WACE;YACF,aACE;YACF,SAAS;QACX;IACF;IACA,iBAAiB;QACf,SAAS;IACX;AACF;AAOF,SAAS,MAAM,EAAE,SAAS,EAAE,OAAO,EAAE,GAAG,OAAmB;IACzD,qBACE,6LAAC;QAAI,WAAW,CAAA,GAAA,sHAAA,CAAA,KAAE,AAAD,EAAE,cAAc;YAAE;QAAQ,IAAI;QAAa,GAAG,KAAK;;;;;;AAExE;KAJS","debugId":null}},
    {"offset": {"line": 193, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/components/ui/switch.tsx"],"sourcesContent":["\"use client\"\n\nimport * as React from \"react\"\nimport * as SwitchPrimitives from \"@radix-ui/react-switch\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Switch = React.forwardRef<\n  React.ElementRef<typeof SwitchPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof SwitchPrimitives.Root>\n>(({ className, ...props }, ref) => (\n  <SwitchPrimitives.Root\n    className={cn(\n      \"peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  >\n    <SwitchPrimitives.Thumb\n      className={cn(\n        \"pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0\"\n      )}\n    />\n  </SwitchPrimitives.Root>\n))\nSwitch.displayName = SwitchPrimitives.Root.displayName\n\nexport { Switch }\n"],"names":[],"mappings":";;;;AAEA;AACA;AAEA;AALA;;;;;AAOA,MAAM,uBAAS,CAAA,GAAA,6JAAA,CAAA,aAAgB,AAAD,OAG5B,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,6LAAC,qKAAA,CAAA,OAAqB;QACpB,WAAW,CAAA,GAAA,sHAAA,CAAA,KAAE,AAAD,EACV,sXACA;QAED,GAAG,KAAK;QACT,KAAK;kBAEL,cAAA,6LAAC,qKAAA,CAAA,QAAsB;YACrB,WAAW,CAAA,GAAA,sHAAA,CAAA,KAAE,AAAD,EACV;;;;;;;;;;;;AAKR,OAAO,WAAW,GAAG,qKAAA,CAAA,OAAqB,CAAC,WAAW","debugId":null}},
    {"offset": {"line": 236, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/app/admin/coupons/actions.ts"],"sourcesContent":["// src/app/admin/coupons/actions.ts\n\"use server\";\n\nimport { z } from \"zod\";\nimport { collection, getDocs, doc, updateDoc, serverTimestamp, Timestamp } from \"firebase/firestore\";\nimport { db } from \"@/lib/firebase\";\nimport type { Coupon, SerializableTimestamp } from \"@/types\";\nimport { revalidatePath } from \"next/cache\";\nimport { sanitizeText } from \"@/lib/sanitize\";\n\n// Schema for updating coupon status\nconst updateCouponStatusSchema = z.object({\n  couponId: z.string().min(1, \"Coupon ID is required.\"),\n  isActive: z.boolean(),\n});\n\n// Schema for updating coupon expiry date\nconst updateCouponExpirySchema = z.object({\n  couponId: z.string().min(1, \"Coupon ID is required.\"),\n  validUntil: z.date(), // Expecting a Date object from the client\n});\n\n// Schema for updating coupon booking validity period\nconst updateCouponBookingValiditySchema = z.object({\n    couponId: z.string().min(1, \"Coupon ID is required.\"),\n    bookingValidFrom: z.date().nullable(),\n    bookingValidUntil: z.date().nullable(),\n}).refine(data => {\n    if (data.bookingValidFrom && data.bookingValidUntil) {\n        return data.bookingValidUntil >= data.bookingValidFrom;\n    }\n    return true;\n}, {\n    message: \"Booking validity end date must be on or after the start date.\",\n    path: [\"bookingValidUntil\"],\n});\n\n// Schema for updating coupon exclusion periods\nconst exclusionPeriodSchema = z.object({\n  start: z.date(),\n  end: z.date(),\n}).refine(data => data.end >= data.start, { // Allow same day start/end\n  message: \"Exclusion end date must be on or after the start date.\",\n  path: [\"end\"],\n});\n\nconst updateCouponExclusionsSchema = z.object({\n  couponId: z.string().min(1, \"Coupon ID is required.\"),\n  exclusionPeriods: z.array(exclusionPeriodSchema),\n});\n\n\n// Helper to convert Firestore Timestamp or string date to a serializable format (ISO string)\nconst serializeTimestamp = (timestamp: SerializableTimestamp | undefined | null): string | null => {\n  if (!timestamp) return null;\n  if (timestamp instanceof Timestamp) {\n    return timestamp.toDate().toISOString();\n  }\n  if (timestamp instanceof Date) {\n    return timestamp.toISOString();\n  }\n  if (typeof timestamp === 'string') {\n    try {\n      return new Date(timestamp).toISOString();\n    } catch (e) {\n      console.warn(`Could not parse date string to ISOString: ${timestamp}`, e);\n      return null;\n    }\n  }\n  if (typeof timestamp === 'number') {\n    return new Date(timestamp).toISOString();\n  }\n  console.warn(`Unhandled timestamp type for serialization: ${typeof timestamp}`, timestamp);\n  return null;\n};\n\n\nexport async function fetchCoupons(): Promise<Coupon[]> {\n  try {\n    const couponsCollection = collection(db, 'coupons');\n    const querySnapshot = await getDocs(couponsCollection);\n    const coupons = querySnapshot.docs.map((doc) => {\n      const data = doc.data();\n      // Convert Timestamps to ISO strings for client components\n      return {\n        id: doc.id,\n        ...data,\n        validUntil: serializeTimestamp(data.validUntil),\n        bookingValidFrom: serializeTimestamp(data.bookingValidFrom),\n        bookingValidUntil: serializeTimestamp(data.bookingValidUntil),\n        exclusionPeriods: data.exclusionPeriods?.map((p: {start: SerializableTimestamp, end: SerializableTimestamp}) => ({\n            start: serializeTimestamp(p.start),\n            end: serializeTimestamp(p.end),\n        })) || null,\n        createdAt: serializeTimestamp(data.createdAt),\n        updatedAt: serializeTimestamp(data.updatedAt),\n      } as Coupon; // Cast to Coupon to ensure type compatibility\n    });\n    return coupons;\n  } catch (error) {\n    console.error(\"[Action fetchCoupons] Error fetching coupons:\", error);\n    return []; // Return empty array on error\n  }\n}\n\nexport async function updateCouponStatusAction(\n  values: z.infer<typeof updateCouponStatusSchema>\n): Promise<{ success: boolean; error?: string }> {\n  const validatedFields = updateCouponStatusSchema.safeParse(values);\n\n  if (!validatedFields.success) {\n    return { success: false, error: \"Invalid input.\" };\n  }\n\n  const { couponId, isActive } = validatedFields.data;\n\n  try {\n    const couponRef = doc(db, 'coupons', couponId);\n    await updateDoc(couponRef, {\n      isActive: isActive,\n      updatedAt: serverTimestamp(),\n    });\n    revalidatePath('/admin/coupons');\n    return { success: true };\n  } catch (error) {\n    console.error(\"[Action updateCouponStatusAction] Error updating coupon status:\", error);\n    return { success: false, error: \"Failed to update coupon status.\" };\n  }\n}\n\nexport async function updateCouponExpiryAction(\n  values: z.infer<typeof updateCouponExpirySchema>\n): Promise<{ success: boolean; error?: string }> {\n  const validatedFields = updateCouponExpirySchema.safeParse(values);\n\n  if (!validatedFields.success) {\n     const errorMessages = validatedFields.error.errors.map(e => `${e.path.join('.')}: ${e.message}`).join(', ');\n    return { success: false, error: `Invalid input: ${errorMessages}` };\n  }\n\n  const { couponId, validUntil } = validatedFields.data;\n\n  try {\n    const couponRef = doc(db, 'coupons', couponId);\n    await updateDoc(couponRef, {\n      validUntil: Timestamp.fromDate(validUntil), // Convert Date to Firestore Timestamp\n      updatedAt: serverTimestamp(),\n    });\n    revalidatePath('/admin/coupons');\n    return { success: true };\n  } catch (error) {\n    console.error(\"[Action updateCouponExpiryAction] Error updating coupon expiry:\", error);\n    return { success: false, error: \"Failed to update coupon expiry date.\" };\n  }\n}\n\n\nexport async function updateCouponBookingValidityAction(\n  values: z.infer<typeof updateCouponBookingValiditySchema>\n): Promise<{ success: boolean; error?: string }> {\n    const validatedFields = updateCouponBookingValiditySchema.safeParse(values);\n\n    if (!validatedFields.success) {\n        const errorMessages = validatedFields.error.errors.map(e => `${e.path.join('.')}: ${e.message}`).join(', ');\n        return { success: false, error: `Invalid input: ${errorMessages}` };\n    }\n\n    const { couponId, bookingValidFrom, bookingValidUntil } = validatedFields.data;\n\n    try {\n        const couponRef = doc(db, 'coupons', couponId);\n        await updateDoc(couponRef, {\n            bookingValidFrom: bookingValidFrom ? Timestamp.fromDate(bookingValidFrom) : null,\n            bookingValidUntil: bookingValidUntil ? Timestamp.fromDate(bookingValidUntil) : null,\n            updatedAt: serverTimestamp(),\n        });\n        revalidatePath('/admin/coupons');\n        return { success: true };\n    } catch (error) {\n        console.error(\"[Action updateCouponBookingValidityAction] Error updating coupon booking validity:\", error);\n        return { success: false, error: \"Failed to update coupon booking validity.\" };\n    }\n}\n\nexport async function updateCouponExclusionsAction(\n  values: z.infer<typeof updateCouponExclusionsSchema>\n): Promise<{ success: boolean; error?: string }> {\n    const validatedFields = updateCouponExclusionsSchema.safeParse(values);\n\n    if (!validatedFields.success) {\n        const errorMessages = validatedFields.error.errors.map(e => `${e.path.join('.')}: ${e.message}`).join(', ');\n        return { success: false, error: `Invalid input: ${errorMessages}` };\n    }\n\n    const { couponId, exclusionPeriods } = validatedFields.data;\n\n    try {\n        const couponRef = doc(db, 'coupons', couponId);\n        await updateDoc(couponRef, {\n            exclusionPeriods: exclusionPeriods.map(period => ({\n                start: Timestamp.fromDate(period.start),\n                end: Timestamp.fromDate(period.end),\n            })),\n            updatedAt: serverTimestamp(),\n        });\n        revalidatePath('/admin/coupons');\n        return { success: true };\n    } catch (error) {\n        console.error(\"[Action updateCouponExclusionsAction] Error updating coupon exclusion periods:\", error);\n        return { success: false, error: \"Failed to update coupon exclusion periods.\" };\n    }\n}\n"],"names":[],"mappings":"AAAA,mCAAmC;;;;;;;;;;IA6Eb;IA4BA;IAyBA;IA2BA;IA2BA","debugId":null}},
    {"offset": {"line": 257, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/app/admin/coupons/_components/coupon-status-toggle.tsx"],"sourcesContent":["\n\"use client\";\n\nimport { useState, useTransition } from 'react';\nimport { Switch } from \"@/components/ui/switch\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { updateCouponStatusAction } from \"../actions\"; // Import the server action\nimport { Loader2 } from 'lucide-react';\n\ninterface CouponStatusToggleProps {\n  couponId: string;\n  isActive: boolean;\n  isDisabled?: boolean; // To disable the switch (e.g., if expired)\n}\n\nexport function CouponStatusToggle({ couponId, isActive, isDisabled = false }: CouponStatusToggleProps) {\n  const [currentIsActive, setCurrentIsActive] = useState(isActive);\n  const [isPending, startTransition] = useTransition();\n  const { toast } = useToast();\n\n  const handleToggle = async (checked: boolean) => {\n    startTransition(async () => {\n      const result = await updateCouponStatusAction({ couponId, isActive: checked });\n\n      if (result.success) {\n        setCurrentIsActive(checked); // Update local state on success\n        toast({\n          title: \"Status Updated\",\n          description: `Coupon status changed to ${checked ? 'Active' : 'Inactive'}.`,\n        });\n      } else {\n        toast({\n          title: \"Update Failed\",\n          description: result.error || \"Could not update coupon status.\",\n          variant: \"destructive\",\n        });\n        // Revert local state on failure (optional, depends on desired UX)\n        // setCurrentIsActive(!checked);\n      }\n    });\n  };\n\n  return (\n    <div className=\"flex items-center space-x-2\">\n      {isPending && <Loader2 className=\"h-4 w-4 animate-spin text-muted-foreground\" />}\n      <Switch\n        id={`status-toggle-${couponId}`}\n        checked={currentIsActive}\n        onCheckedChange={handleToggle}\n        disabled={isPending || isDisabled} // Disable while pending or if explicitly disabled\n        aria-label={`Toggle status for coupon ${couponId}`}\n      />\n    </div>\n  );\n}\n"],"names":[],"mappings":";;;;AAGA;AACA;AACA;AACA,oPAAuD,2BAA2B;AAClF;;;AANA;;;;;;AAcO,SAAS,mBAAmB,EAAE,QAAQ,EAAE,QAAQ,EAAE,aAAa,KAAK,EAA2B;;IACpG,MAAM,CAAC,iBAAiB,mBAAmB,GAAG,CAAA,GAAA,6JAAA,CAAA,WAAQ,AAAD,EAAE;IACvD,MAAM,CAAC,WAAW,gBAAgB,GAAG,CAAA,GAAA,6JAAA,CAAA,gBAAa,AAAD;IACjD,MAAM,EAAE,KAAK,EAAE,GAAG,CAAA,GAAA,+HAAA,CAAA,WAAQ,AAAD;IAEzB,MAAM,eAAe,OAAO;QAC1B,gBAAgB;YACd,MAAM,SAAS,MAAM,CAAA,GAAA,4IAAA,CAAA,2BAAwB,AAAD,EAAE;gBAAE;gBAAU,UAAU;YAAQ;YAE5E,IAAI,OAAO,OAAO,EAAE;gBAClB,mBAAmB,UAAU,gCAAgC;gBAC7D,MAAM;oBACJ,OAAO;oBACP,aAAa,CAAC,yBAAyB,EAAE,UAAU,WAAW,WAAW,CAAC,CAAC;gBAC7E;YACF,OAAO;gBACL,MAAM;oBACJ,OAAO;oBACP,aAAa,OAAO,KAAK,IAAI;oBAC7B,SAAS;gBACX;YACA,kEAAkE;YAClE,gCAAgC;YAClC;QACF;IACF;IAEA,qBACE,6LAAC;QAAI,WAAU;;YACZ,2BAAa,6LAAC,oNAAA,CAAA,UAAO;gBAAC,WAAU;;;;;;0BACjC,6LAAC,qIAAA,CAAA,SAAM;gBACL,IAAI,CAAC,cAAc,EAAE,UAAU;gBAC/B,SAAS;gBACT,iBAAiB;gBACjB,UAAU,aAAa;gBACvB,cAAY,CAAC,yBAAyB,EAAE,UAAU;;;;;;;;;;;;AAI1D;GAvCgB;;QAEuB,6JAAA,CAAA,gBAAa;QAChC,+HAAA,CAAA,WAAQ;;;KAHZ","debugId":null}},
    {"offset": {"line": 348, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/components/ui/calendar.tsx"],"sourcesContent":["\"use client\"\n\nimport * as React from \"react\"\nimport { ChevronLeft, ChevronRight } from \"lucide-react\"\nimport { DayPicker } from \"react-day-picker\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nexport type CalendarProps = React.ComponentProps<typeof DayPicker>\n\nfunction Calendar({\n  className,\n  classNames,\n  showOutsideDays = true,\n  ...props\n}: CalendarProps) {\n  return (\n    <DayPicker\n      showOutsideDays={showOutsideDays}\n      className={cn(\"p-3\", className)}\n      classNames={{\n        months: \"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0\",\n        month: \"space-y-4\",\n        caption: \"flex justify-center pt-1 relative items-center\",\n        caption_label: \"text-sm font-medium\",\n        nav: \"space-x-1 flex items-center\",\n        nav_button: cn(\n          buttonVariants({ variant: \"outline\" }),\n          \"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100\"\n        ),\n        nav_button_previous: \"absolute left-1\",\n        nav_button_next: \"absolute right-1\",\n        table: \"w-full border-collapse space-y-1\",\n        head_row: \"flex\",\n        head_cell:\n          \"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]\",\n        row: \"flex w-full mt-2\",\n        cell: \"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20\",\n        day: cn(\n          buttonVariants({ variant: \"ghost\" }),\n          \"h-9 w-9 p-0 font-normal aria-selected:opacity-100\"\n        ),\n        day_range_end: \"day-range-end\",\n        day_selected:\n          \"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground\",\n        day_today: \"bg-accent text-accent-foreground\",\n        day_outside:\n          \"day-outside text-muted-foreground aria-selected:bg-accent/50 aria-selected:text-muted-foreground\",\n        day_disabled: \"text-muted-foreground opacity-50\",\n        day_range_middle:\n          \"aria-selected:bg-accent aria-selected:text-accent-foreground\",\n        day_hidden: \"invisible\",\n        ...classNames,\n      }}\n      components={{\n        IconLeft: ({ className, ...props }) => (\n          <ChevronLeft className={cn(\"h-4 w-4\", className)} {...props} />\n        ),\n        IconRight: ({ className, ...props }) => (\n          <ChevronRight className={cn(\"h-4 w-4\", className)} {...props} />\n        ),\n      }}\n      {...props}\n    />\n  )\n}\nCalendar.displayName = \"Calendar\"\n\nexport { Calendar }\n"],"names":[],"mappings":";;;;AAGA;AAAA;AACA;AAEA;AACA;AAPA;;;;;;AAWA,SAAS,SAAS,EAChB,SAAS,EACT,UAAU,EACV,kBAAkB,IAAI,EACtB,GAAG,OACW;IACd,qBACE,6LAAC,iKAAA,CAAA,YAAS;QACR,iBAAiB;QACjB,WAAW,CAAA,GAAA,sHAAA,CAAA,KAAE,AAAD,EAAE,OAAO;QACrB,YAAY;YACV,QAAQ;YACR,OAAO;YACP,SAAS;YACT,eAAe;YACf,KAAK;YACL,YAAY,CAAA,GAAA,sHAAA,CAAA,KAAE,AAAD,EACX,CAAA,GAAA,qIAAA,CAAA,iBAAc,AAAD,EAAE;gBAAE,SAAS;YAAU,IACpC;YAEF,qBAAqB;YACrB,iBAAiB;YACjB,OAAO;YACP,UAAU;YACV,WACE;YACF,KAAK;YACL,MAAM;YACN,KAAK,CAAA,GAAA,sHAAA,CAAA,KAAE,AAAD,EACJ,CAAA,GAAA,qIAAA,CAAA,iBAAc,AAAD,EAAE;gBAAE,SAAS;YAAQ,IAClC;YAEF,eAAe;YACf,cACE;YACF,WAAW;YACX,aACE;YACF,cAAc;YACd,kBACE;YACF,YAAY;YACZ,GAAG,UAAU;QACf;QACA,YAAY;YACV,UAAU,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,iBAChC,6LAAC,uNAAA,CAAA,cAAW;oBAAC,WAAW,CAAA,GAAA,sHAAA,CAAA,KAAE,AAAD,EAAE,WAAW;oBAAa,GAAG,KAAK;;;;;;YAE7D,WAAW,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,iBACjC,6LAAC,yNAAA,CAAA,eAAY;oBAAC,WAAW,CAAA,GAAA,sHAAA,CAAA,KAAE,AAAD,EAAE,WAAW;oBAAa,GAAG,KAAK;;;;;;QAEhE;QACC,GAAG,KAAK;;;;;;AAGf;KAvDS;AAwDT,SAAS,WAAW,GAAG","debugId":null}},
    {"offset": {"line": 434, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/components/ui/popover.tsx"],"sourcesContent":["\"use client\"\n\nimport * as React from \"react\"\nimport * as PopoverPrimitive from \"@radix-ui/react-popover\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Popover = PopoverPrimitive.Root\n\nconst PopoverTrigger = PopoverPrimitive.Trigger\n\nconst PopoverContent = React.forwardRef<\n  React.ElementRef<typeof PopoverPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof PopoverPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <PopoverPrimitive.Portal>\n    <PopoverPrimitive.Content\n      ref={ref}\n      align={align}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2\",\n        className\n      )}\n      {...props}\n    />\n  </PopoverPrimitive.Portal>\n))\nPopoverContent.displayName = PopoverPrimitive.Content.displayName\n\nexport { Popover, PopoverTrigger, PopoverContent }\n"],"names":[],"mappings":";;;;;;AAEA;AACA;AAEA;AALA;;;;;AAOA,MAAM,UAAU,sKAAA,CAAA,OAAqB;AAErC,MAAM,iBAAiB,sKAAA,CAAA,UAAwB;AAE/C,MAAM,+BAAiB,CAAA,GAAA,6JAAA,CAAA,aAAgB,AAAD,OAGpC,CAAC,EAAE,SAAS,EAAE,QAAQ,QAAQ,EAAE,aAAa,CAAC,EAAE,GAAG,OAAO,EAAE,oBAC5D,6LAAC,sKAAA,CAAA,SAAuB;kBACtB,cAAA,6LAAC,sKAAA,CAAA,UAAwB;YACvB,KAAK;YACL,OAAO;YACP,YAAY;YACZ,WAAW,CAAA,GAAA,sHAAA,CAAA,KAAE,AAAD,EACV,8aACA;YAED,GAAG,KAAK;;;;;;;;;;;;AAIf,eAAe,WAAW,GAAG,sKAAA,CAAA,UAAwB,CAAC,WAAW","debugId":null}},
    {"offset": {"line": 482, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/app/admin/coupons/_components/coupon-expiry-edit.tsx"],"sourcesContent":["\n\"use client\";\n\nimport { useState, useTransition, useEffect } from 'react'; // Added useEffect\nimport { format } from 'date-fns';\nimport { Calendar as CalendarIcon, Loader2, Pencil } from 'lucide-react';\nimport { Button } from '@/components/ui/button';\nimport { Calendar } from '@/components/ui/calendar';\nimport {\n  Popover,\n  PopoverContent,\n  PopoverTrigger,\n} from '@/components/ui/popover';\nimport { useToast } from '@/hooks/use-toast';\nimport { cn } from '@/lib/utils';\nimport { updateCouponExpiryAction } from '../actions'; // Import the server action\n\ninterface CouponExpiryEditProps {\n  couponId: string;\n  currentExpiryDate: Date;\n}\n\nexport function CouponExpiryEdit({ couponId, currentExpiryDate }: CouponExpiryEditProps) {\n  const [newExpiryDate, setNewExpiryDate] = useState<Date | undefined>(currentExpiryDate);\n  const [formattedDate, setFormattedDate] = useState<string | null>(null); // State for client-side formatted date\n  const [isOpen, setIsOpen] = useState(false);\n  const [isPending, startTransition] = useTransition();\n  const { toast } = useToast();\n\n  // Format date on the client side after hydration\n  useEffect(() => {\n    if (newExpiryDate) {\n      setFormattedDate(format(newExpiryDate, 'PPP'));\n    } else {\n      setFormattedDate('No expiry');\n    }\n  }, [newExpiryDate]); // Re-run if newExpiryDate changes\n\n  const handleDateSelect = (date: Date | undefined) => {\n    if (!date) return;\n    setNewExpiryDate(date); // Update the date state\n    startTransition(async () => {\n      const result = await updateCouponExpiryAction({ couponId, validUntil: date });\n      if (result.success) {\n        toast({\n          title: \"Expiry Date Updated\",\n          description: `Coupon expiry date changed to ${format(date, 'PPP')}.`,\n        });\n        setIsOpen(false); // Close popover on success\n      } else {\n        toast({\n          title: \"Update Failed\",\n          description: result.error || \"Could not update expiry date.\",\n          variant: \"destructive\",\n        });\n        // Revert local state if API failed\n        setNewExpiryDate(currentExpiryDate);\n      }\n    });\n  };\n\n  return (\n    <Popover open={isOpen} onOpenChange={setIsOpen}>\n      <PopoverTrigger asChild>\n        <Button\n          variant=\"ghost\"\n          size=\"sm\"\n          className={cn(\n            \"w-[180px] justify-start text-left font-normal\",\n            !newExpiryDate && \"text-muted-foreground\"\n          )}\n          disabled={isPending}\n        >\n          <CalendarIcon className=\"mr-2 h-4 w-4\" />\n          {/* Render placeholder until formattedDate is ready */}\n          {formattedDate !== null ? formattedDate : <span>Loading date...</span>}\n           <Pencil className=\"ml-auto h-3 w-3 opacity-50\" />\n        </Button>\n      </PopoverTrigger>\n      <PopoverContent className=\"w-auto p-0\" align=\"start\">\n        {isPending && (\n          <div className=\"absolute inset-0 flex items-center justify-center bg-background/80 z-10\">\n            <Loader2 className=\"h-6 w-6 animate-spin text-primary\" />\n          </div>\n        )}\n        <Calendar\n          mode=\"single\"\n          selected={newExpiryDate}\n          onSelect={handleDateSelect}\n          disabled={(date) =>\n             isPending || date < new Date(new Date().setHours(0, 0, 0, 0))\n          } // Disable past dates and while pending\n          initialFocus\n        />\n      </PopoverContent>\n    </Popover>\n  );\n}\n"],"names":[],"mappings":";;;;AAGA,mRAA4D,kBAAkB;AAC9E;AACA;AAAA;AAAA;AACA;AACA;AACA;AAKA;AACA;AACA,oPAAuD,2BAA2B;;;AAdlF;;;;;;;;;;AAqBO,SAAS,iBAAiB,EAAE,QAAQ,EAAE,iBAAiB,EAAyB;;IACrF,MAAM,CAAC,eAAe,iBAAiB,GAAG,CAAA,GAAA,6JAAA,CAAA,WAAQ,AAAD,EAAoB;IACrE,MAAM,CAAC,eAAe,iBAAiB,GAAG,CAAA,GAAA,6JAAA,CAAA,WAAQ,AAAD,EAAiB,OAAO,uCAAuC;IAChH,MAAM,CAAC,QAAQ,UAAU,GAAG,CAAA,GAAA,6JAAA,CAAA,WAAQ,AAAD,EAAE;IACrC,MAAM,CAAC,WAAW,gBAAgB,GAAG,CAAA,GAAA,6JAAA,CAAA,gBAAa,AAAD;IACjD,MAAM,EAAE,KAAK,EAAE,GAAG,CAAA,GAAA,+HAAA,CAAA,WAAQ,AAAD;IAEzB,iDAAiD;IACjD,CAAA,GAAA,6JAAA,CAAA,YAAS,AAAD;sCAAE;YACR,IAAI,eAAe;gBACjB,iBAAiB,CAAA,GAAA,yJAAA,CAAA,SAAM,AAAD,EAAE,eAAe;YACzC,OAAO;gBACL,iBAAiB;YACnB;QACF;qCAAG;QAAC;KAAc,GAAG,kCAAkC;IAEvD,MAAM,mBAAmB,CAAC;QACxB,IAAI,CAAC,MAAM;QACX,iBAAiB,OAAO,wBAAwB;QAChD,gBAAgB;YACd,MAAM,SAAS,MAAM,CAAA,GAAA,4IAAA,CAAA,2BAAwB,AAAD,EAAE;gBAAE;gBAAU,YAAY;YAAK;YAC3E,IAAI,OAAO,OAAO,EAAE;gBAClB,MAAM;oBACJ,OAAO;oBACP,aAAa,CAAC,8BAA8B,EAAE,CAAA,GAAA,yJAAA,CAAA,SAAM,AAAD,EAAE,MAAM,OAAO,CAAC,CAAC;gBACtE;gBACA,UAAU,QAAQ,2BAA2B;YAC/C,OAAO;gBACL,MAAM;oBACJ,OAAO;oBACP,aAAa,OAAO,KAAK,IAAI;oBAC7B,SAAS;gBACX;gBACA,mCAAmC;gBACnC,iBAAiB;YACnB;QACF;IACF;IAEA,qBACE,6LAAC,sIAAA,CAAA,UAAO;QAAC,MAAM;QAAQ,cAAc;;0BACnC,6LAAC,sIAAA,CAAA,iBAAc;gBAAC,OAAO;0BACrB,cAAA,6LAAC,qIAAA,CAAA,SAAM;oBACL,SAAQ;oBACR,MAAK;oBACL,WAAW,CAAA,GAAA,sHAAA,CAAA,KAAE,AAAD,EACV,iDACA,CAAC,iBAAiB;oBAEpB,UAAU;;sCAEV,6LAAC,6MAAA,CAAA,WAAY;4BAAC,WAAU;;;;;;wBAEvB,kBAAkB,OAAO,8BAAgB,6LAAC;sCAAK;;;;;;sCAC/C,6LAAC,yMAAA,CAAA,SAAM;4BAAC,WAAU;;;;;;;;;;;;;;;;;0BAGvB,6LAAC,sIAAA,CAAA,iBAAc;gBAAC,WAAU;gBAAa,OAAM;;oBAC1C,2BACC,6LAAC;wBAAI,WAAU;kCACb,cAAA,6LAAC,oNAAA,CAAA,UAAO;4BAAC,WAAU;;;;;;;;;;;kCAGvB,6LAAC,uIAAA,CAAA,WAAQ;wBACP,MAAK;wBACL,UAAU;wBACV,UAAU;wBACV,UAAU,CAAC,OACR,aAAa,OAAO,IAAI,KAAK,IAAI,OAAO,QAAQ,CAAC,GAAG,GAAG,GAAG;wBAE7D,YAAY;;;;;;;;;;;;;;;;;;AAKtB;GA3EgB;;QAIuB,6JAAA,CAAA,gBAAa;QAChC,+HAAA,CAAA,WAAQ;;;KALZ","debugId":null}},
    {"offset": {"line": 657, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/app/admin/coupons/_components/coupon-booking-validity-edit.tsx"],"sourcesContent":["\"use client\";\n\nimport { useState, useTransition } from 'react';\nimport { format } from 'date-fns';\nimport { Calendar as CalendarIcon, Loader2, Save, X } from 'lucide-react';\nimport { Button } from '@/components/ui/button';\nimport { Calendar } from '@/components/ui/calendar';\nimport {\n  Popover,\n  PopoverContent,\n  PopoverTrigger,\n} from '@/components/ui/popover';\nimport { useToast } from '@/hooks/use-toast';\nimport { cn } from '@/lib/utils';\nimport { updateCouponBookingValidityAction } from '../actions'; // Import the server action\nimport type { DateRange } from 'react-day-picker';\n\ninterface CouponBookingValidityEditProps {\n  couponId: string;\n  currentBookingValidFrom: Date | null;\n  currentBookingValidUntil: Date | null;\n}\n\nexport function CouponBookingValidityEdit({\n  couponId,\n  currentBookingValidFrom,\n  currentBookingValidUntil,\n}: CouponBookingValidityEditProps) {\n  const [dateRange, setDateRange] = useState<DateRange | undefined>({\n    from: currentBookingValidFrom ?? undefined,\n    to: currentBookingValidUntil ?? undefined,\n  });\n  const [isOpen, setIsOpen] = useState(false);\n  const [isPending, startTransition] = useTransition();\n  const { toast } = useToast();\n\n  const handleSave = () => {\n     if (dateRange?.from && dateRange?.to && dateRange.to < dateRange.from) {\n        toast({\n            title: \"Invalid Date Range\",\n            description: \"Booking validity end date must be on or after the start date.\",\n            variant: \"destructive\",\n        });\n        return;\n    }\n\n    startTransition(async () => {\n        // Ensure null is sent if date is undefined\n       const fromDate = dateRange?.from ?? null;\n       const toDate = dateRange?.to ?? null;\n\n       const result = await updateCouponBookingValidityAction({\n         couponId,\n         bookingValidFrom: fromDate,\n         bookingValidUntil: toDate,\n       });\n\n      if (result.success) {\n        toast({\n          title: \"Booking Validity Updated\",\n          description: `Validity period updated successfully.`,\n        });\n        setIsOpen(false); // Close popover on success\n      } else {\n        toast({\n          title: \"Update Failed\",\n          description: result.error || \"Could not update booking validity.\",\n          variant: \"destructive\",\n        });\n        // Optionally revert local state:\n        // setDateRange({ from: currentBookingValidFrom ?? undefined, to: currentBookingValidUntil ?? undefined });\n      }\n    });\n  };\n\n   const handleClear = () => {\n       setDateRange(undefined); // Clear local state first\n\n       startTransition(async () => {\n            const result = await updateCouponBookingValidityAction({\n                couponId,\n                bookingValidFrom: null,\n                bookingValidUntil: null,\n            });\n\n            if (result.success) {\n                toast({\n                    title: \"Booking Validity Cleared\",\n                    description: `Coupon is now valid for any booking dates.`,\n                });\n                setIsOpen(false);\n            } else {\n                 toast({\n                    title: \"Clear Failed\",\n                    description: result.error || \"Could not clear booking validity.\",\n                    variant: \"destructive\",\n                    \n                });\n                 // Revert local state if API failed\n                 setDateRange({ from: currentBookingValidFrom ?? undefined, to: currentBookingValidUntil ?? undefined });\n            }\n        });\n   };\n\n  return (\n    <Popover open={isOpen} onOpenChange={setIsOpen}>\n      <PopoverTrigger asChild>\n        <Button\n          variant=\"outline\"\n          size=\"sm\"\n          className={cn(\n            \"w-[250px] justify-start text-left font-normal\", // Adjusted width\n            !dateRange?.from && !dateRange?.to && \"text-muted-foreground\" // Style when no dates are set\n          )}\n          disabled={isPending}\n        >\n          <CalendarIcon className=\"mr-2 h-4 w-4\" />\n          {dateRange?.from ? (\n             dateRange.to ? (\n                <>\n                 {format(dateRange.from, 'LLL dd, y')} - {format(dateRange.to, 'LLL dd, y')}\n                </>\n             ) : (\n                `From ${format(dateRange.from, 'LLL dd, y')}`\n             )\n          ) : dateRange?.to ? (\n             `Until ${format(dateRange.to, 'LLL dd, y')}`\n          ) : (\n            <span>Any Dates</span>\n          )}\n        </Button>\n      </PopoverTrigger>\n      <PopoverContent className=\"w-auto p-0\" align=\"start\">\n        {isPending && (\n          <div className=\"absolute inset-0 flex items-center justify-center bg-background/80 z-10\">\n            <Loader2 className=\"h-6 w-6 animate-spin text-primary\" />\n          </div>\n        )}\n         <Calendar\n          mode=\"range\"\n          selected={dateRange}\n          onSelect={setDateRange}\n          disabled={isPending}\n          numberOfMonths={2} // Show two months for range selection\n          initialFocus\n        />\n        <div className=\"p-3 border-t flex justify-between items-center\">\n           <Button\n              variant=\"ghost\"\n              size=\"sm\"\n              onClick={handleClear}\n              disabled={isPending || (!dateRange?.from && !dateRange?.to)} // Disable clear if already cleared\n            >\n             <X className=\"mr-1 h-4 w-4\" /> Clear Dates\n           </Button>\n           <Button onClick={handleSave} disabled={isPending} size=\"sm\">\n             <Save className=\"mr-1 h-4 w-4\" /> Save Changes\n           </Button>\n        </div>\n      </PopoverContent>\n    </Popover>\n  );\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 910, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/components/ui/scroll-area.tsx"],"sourcesContent":["\"use client\"\n\nimport * as React from \"react\"\nimport * as ScrollAreaPrimitive from \"@radix-ui/react-scroll-area\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ScrollArea = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <ScrollAreaPrimitive.Root\n    ref={ref}\n    className={cn(\"relative overflow-hidden\", className)}\n    {...props}\n  >\n    <ScrollAreaPrimitive.Viewport className=\"h-full w-full rounded-[inherit]\">\n      {children}\n    </ScrollAreaPrimitive.Viewport>\n    <ScrollBar />\n    <ScrollAreaPrimitive.Corner />\n  </ScrollAreaPrimitive.Root>\n))\nScrollArea.displayName = ScrollAreaPrimitive.Root.displayName\n\nconst ScrollBar = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>\n>(({ className, orientation = \"vertical\", ...props }, ref) => (\n  <ScrollAreaPrimitive.ScrollAreaScrollbar\n    ref={ref}\n    orientation={orientation}\n    className={cn(\n      \"flex touch-none select-none transition-colors\",\n      orientation === \"vertical\" &&\n        \"h-full w-2.5 border-l border-l-transparent p-[1px]\",\n      orientation === \"horizontal\" &&\n        \"h-2.5 flex-col border-t border-t-transparent p-[1px]\",\n      className\n    )}\n    {...props}\n  >\n    <ScrollAreaPrimitive.ScrollAreaThumb className=\"relative flex-1 rounded-full bg-border\" />\n  </ScrollAreaPrimitive.ScrollAreaScrollbar>\n))\nScrollBar.displayName = ScrollAreaPrimitive.ScrollAreaScrollbar.displayName\n\nexport { ScrollArea, ScrollBar }\n"],"names":[],"mappings":";;;;;AAEA;AACA;AAEA;AALA;;;;;AAOA,MAAM,2BAAa,CAAA,GAAA,6JAAA,CAAA,aAAgB,AAAD,OAGhC,CAAC,EAAE,SAAS,EAAE,QAAQ,EAAE,GAAG,OAAO,EAAE,oBACpC,6LAAC,6KAAA,CAAA,OAAwB;QACvB,KAAK;QACL,WAAW,CAAA,GAAA,sHAAA,CAAA,KAAE,AAAD,EAAE,4BAA4B;QACzC,GAAG,KAAK;;0BAET,6LAAC,6KAAA,CAAA,WAA4B;gBAAC,WAAU;0BACrC;;;;;;0BAEH,6LAAC;;;;;0BACD,6LAAC,6KAAA,CAAA,SAA0B;;;;;;;;;;;;AAG/B,WAAW,WAAW,GAAG,6KAAA,CAAA,OAAwB,CAAC,WAAW;AAE7D,MAAM,0BAAY,CAAA,GAAA,6JAAA,CAAA,aAAgB,AAAD,EAG/B,CAAC,EAAE,SAAS,EAAE,cAAc,UAAU,EAAE,GAAG,OAAO,EAAE,oBACpD,6LAAC,6KAAA,CAAA,sBAAuC;QACtC,KAAK;QACL,aAAa;QACb,WAAW,CAAA,GAAA,sHAAA,CAAA,KAAE,AAAD,EACV,iDACA,gBAAgB,cACd,sDACF,gBAAgB,gBACd,wDACF;QAED,GAAG,KAAK;kBAET,cAAA,6LAAC,6KAAA,CAAA,kBAAmC;YAAC,WAAU;;;;;;;;;;;MAjB7C;AAoBN,UAAU,WAAW,GAAG,6KAAA,CAAA,sBAAuC,CAAC,WAAW","debugId":null}},
    {"offset": {"line": 987, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/app/admin/coupons/_components/coupon-exclusions-edit.tsx"],"sourcesContent":["\"use client\";\n\nimport { useState, useTransition } from 'react';\nimport { format } from 'date-fns';\nimport { Calendar as CalendarIcon, Plus, Trash2, Loader2, Save, XCircle } from 'lucide-react';\nimport { Button } from '@/components/ui/button';\nimport { Calendar } from '@/components/ui/calendar';\nimport {\n  Popover,\n  PopoverContent,\n  PopoverTrigger,\n} from '@/components/ui/popover';\nimport { useToast } from '@/hooks/use-toast';\nimport { cn } from '@/lib/utils';\nimport { updateCouponExclusionsAction } from '../actions'; // Import the server action\nimport type { DateRange } from 'react-day-picker';\nimport { Badge } from '@/components/ui/badge'; // Import Badge\nimport { ScrollArea } from '@/components/ui/scroll-area'; // Import ScrollArea\n\ninterface CouponExclusionsEditProps {\n  couponId: string;\n  currentExclusionPeriods: Array<{ start: Date; end: Date }>;\n}\n\nexport function CouponExclusionsEdit({\n  couponId,\n  currentExclusionPeriods,\n}: CouponExclusionsEditProps) {\n  // Initialize local state with dates converted to Date objects\n  const [exclusions, setExclusions] = useState<Array<{ start?: Date; end?: Date }>>(\n    currentExclusionPeriods.map(p => ({ start: p.start, end: p.end }))\n  );\n  const [newPeriod, setNewPeriod] = useState<DateRange | undefined>(undefined);\n  const [isAdding, setIsAdding] = useState(false); // State to control add popover\n  const [isPending, startTransition] = useTransition();\n  const { toast } = useToast();\n\n  const handleAddExclusion = () => {\n    if (newPeriod?.from && newPeriod?.to) {\n        // Basic validation: end date must be >= start date\n         if (newPeriod.to < newPeriod.from) {\n            toast({ title: \"Invalid Date Range\", description: \"End date must be on or after start date.\", variant: \"destructive\" });\n            return;\n         }\n       setExclusions([...exclusions, { start: newPeriod.from, end: newPeriod.to }]);\n       setNewPeriod(undefined); // Reset for next addition\n       setIsAdding(false); // Close popover\n    } else {\n         toast({ title: \"Incomplete Date Range\", description: \"Please select both a start and end date.\", variant: \"destructive\" });\n    }\n  };\n\n  const handleRemoveExclusion = (index: number) => {\n    setExclusions(exclusions.filter((_, i) => i !== index));\n  };\n\n  const handleSaveChanges = () => {\n    // Validate all periods before saving\n    const validExclusions = exclusions.filter(p => p.start && p.end && p.end >= p.start) as Array<{ start: Date; end: Date }>;\n\n     if (validExclusions.length !== exclusions.length) {\n        toast({ title: \"Invalid Periods Found\", description: \"Some exclusion periods have invalid dates. Please correct them before saving.\", variant: \"destructive\" });\n        // Optionally highlight invalid periods\n        return;\n     }\n\n    startTransition(async () => {\n      const result = await updateCouponExclusionsAction({\n        couponId,\n        // Ensure dates are correctly formatted if needed by action, here we pass Date objects\n        exclusionPeriods: validExclusions,\n      });\n\n      if (result.success) {\n        toast({\n          title: \"Exclusion Periods Updated\",\n          description: `Exclusions saved successfully.`,\n        });\n      } else {\n        toast({\n          title: \"Update Failed\",\n          description: result.error || \"Could not update exclusion periods.\",\n          variant: \"destructive\",\n        });\n        // Optionally revert local state on failure:\n        // setExclusions(currentExclusionPeriods.map(p => ({ start: p.start, end: p.end })));\n      }\n    });\n  };\n\n  return (\n    <div className=\"space-y-3\">\n       {isPending && (\n            <div className=\"flex items-center justify-center text-muted-foreground text-sm\">\n                <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" /> Updating...\n            </div>\n        )}\n      {/* Display Existing Exclusions */}\n      <ScrollArea className=\"h-24 w-full rounded-md border p-2\"> {/* Scrollable area */}\n        {exclusions.length === 0 ? (\n          <p className=\"text-sm text-muted-foreground text-center py-2\">No exclusion periods defined.</p>\n        ) : (\n          <ul className=\"space-y-1\">\n            {exclusions.map((period, index) => (\n              <li key={index} className=\"flex items-center justify-between text-sm bg-secondary/50 p-1 rounded\">\n                 <span>\n                     {period.start ? format(period.start, 'LLL dd, y') : '...'} -{' '}\n                     {period.end ? format(period.end, 'LLL dd, y') : '...'}\n                     {(!period.start || !period.end || (period.start && period.end && period.end < period.start)) && (\n                         <Badge variant=\"destructive\" className=\"ml-2\">Invalid</Badge>\n                     )}\n                 </span>\n                <Button\n                  variant=\"ghost\"\n                  size=\"icon\"\n                  className=\"h-6 w-6 text-destructive\"\n                  onClick={() => handleRemoveExclusion(index)}\n                  disabled={isPending}\n                  aria-label={`Remove exclusion period ${index + 1}`}\n                >\n                  <Trash2 className=\"h-4 w-4\" />\n                </Button>\n              </li>\n            ))}\n          </ul>\n        )}\n      </ScrollArea>\n\n      {/* Add New Exclusion Period */}\n      <div className=\"flex items-center gap-2\">\n        <Popover open={isAdding} onOpenChange={setIsAdding}>\n          <PopoverTrigger asChild>\n            <Button variant=\"outline\" size=\"sm\" disabled={isPending}>\n              <Plus className=\"mr-1 h-4 w-4\" /> Add Exclusion\n            </Button>\n          </PopoverTrigger>\n          <PopoverContent className=\"w-auto p-0\" align=\"start\">\n            <Calendar\n              mode=\"range\"\n              selected={newPeriod}\n              onSelect={setNewPeriod}\n              numberOfMonths={1} // Keep it compact\n              initialFocus\n            />\n             <div className=\"p-2 border-t text-right\">\n                <Button size=\"sm\" onClick={handleAddExclusion}>Add Period</Button>\n             </div>\n          </PopoverContent>\n        </Popover>\n\n         {/* Save Changes Button */}\n         <Button\n             size=\"sm\"\n             onClick={handleSaveChanges}\n             disabled={isPending || JSON.stringify(exclusions) === JSON.stringify(currentExclusionPeriods.map(p => ({ start: p.start, end: p.end })))} // Disable if no changes\n             className=\"ml-auto\" // Push save button to the right\n         >\n           {isPending ? <Loader2 className=\"mr-1 h-4 w-4 animate-spin\" /> : <Save className=\"mr-1 h-4 w-4\" />}\n            Save Exclusions\n         </Button>\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 1325, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/app/admin/coupons/_components/coupon-table.tsx"],"sourcesContent":["\n\"use client\";\nimport * as React from 'react'; // Import React\n\nimport type { Coupon, SerializableTimestamp } from \"@/types\";\nimport {\n  Table,\n  TableBody,\n  TableCaption,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\"; // Import Button\nimport { format, parseISO, startOfDay } from \"date-fns\"; // Added startOfDay\nimport { CouponStatusToggle } from \"./coupon-status-toggle\";\nimport { CouponExpiryEdit } from \"./coupon-expiry-edit\";\nimport { CouponBookingValidityEdit } from \"./coupon-booking-validity-edit\"; // Import new component\nimport { CouponExclusionsEdit } from \"./coupon-exclusions-edit\"; // Import new component\nimport { useState } from \"react\";\nimport { ChevronDown, ChevronUp } from \"lucide-react\"; // Icons for expansion\n\ninterface CouponTableProps {\n  coupons: Coupon[];\n}\n\nexport function CouponTable({ coupons }: CouponTableProps) {\n  const [expandedRowId, setExpandedRowId] = useState<string | null>(null);\n\n  const toggleRowExpansion = (couponId: string) => {\n    setExpandedRowId(expandedRowId === couponId ? null : couponId);\n  };\n\n  // Function to convert Firestore Timestamp or serialized date to Date object\n  const deserializeTimestamp = (timestamp: SerializableTimestamp | null | undefined): Date | null => {\n    if (!timestamp) return null;\n    if (timestamp instanceof Date) return timestamp;\n     // @ts-ignore Assuming it's a Firestore Timestamp-like object\n     if (typeof timestamp === 'object' && 'seconds' in timestamp && 'nanoseconds' in timestamp) {\n       // @ts-ignore Assuming it's a Firestore Timestamp-like object\n       return new Date(timestamp.seconds * 1000 + timestamp.nanoseconds / 1000000);\n     }\n    if (typeof timestamp === 'string') {\n      try { return parseISO(timestamp); } catch { return null; }\n    }\n    if (typeof timestamp === 'number') return new Date(timestamp);\n    return null;\n  };\n\n  // Function to deserialize exclusion periods\n  const deserializeExclusionPeriods = (periods: Array<{ start: SerializableTimestamp; end: SerializableTimestamp }> | null | undefined): Array<{ start: Date; end: Date }> => {\n      if (!periods) return [];\n      return periods\n          .map(p => ({ start: deserializeTimestamp(p.start), end: deserializeTimestamp(p.end) }))\n          .filter(p => p.start && p.end) as Array<{ start: Date; end: Date }>; // Filter out invalid dates\n  };\n\n  return (\n    <Table>\n      <TableCaption>A list of your coupons.</TableCaption>\n      <TableHeader>\n        <TableRow>\n          <TableHead className=\"w-[50px]\"></TableHead> {/* Column for expand button */}\n          <TableHead className=\"w-[150px]\">Code</TableHead>\n          <TableHead>Discount (%)</TableHead>\n          <TableHead>Description</TableHead>\n          <TableHead>Expires On</TableHead>\n          <TableHead>Status</TableHead>\n          <TableHead className=\"text-right\">Actions</TableHead>\n        </TableRow>\n      </TableHeader>\n      <TableBody>\n        {coupons.map((coupon) => {\n          const validUntilDate = deserializeTimestamp(coupon.validUntil);\n          // Check against start of today for expiration\n          const isExpired = validUntilDate ? validUntilDate < startOfDay(new Date()) : false;\n          const effectiveStatus = isExpired ? \"Expired\" : coupon.isActive ? \"Active\" : \"Inactive\";\n          const isExpanded = expandedRowId === coupon.id; // Use coupon.id which is the document ID (can be slug or auto-gen)\n\n          // Deserialize dates for editing components\n          const bookingValidFromDate = deserializeTimestamp(coupon.bookingValidFrom);\n          const bookingValidUntilDate = deserializeTimestamp(coupon.bookingValidUntil);\n          const exclusionPeriodsDates = deserializeExclusionPeriods(coupon.exclusionPeriods);\n\n          return (\n            <React.Fragment key={coupon.id}>\n                <TableRow>\n                    <TableCell>\n                        <Button\n                        variant=\"ghost\"\n                        size=\"icon\"\n                        onClick={() => toggleRowExpansion(coupon.id)}\n                        aria-expanded={isExpanded}\n                        aria-controls={`details-${coupon.id}`}\n                        >\n                        {isExpanded ? <ChevronUp className=\"h-4 w-4\" /> : <ChevronDown className=\"h-4 w-4\" />}\n                        <span className=\"sr-only\">{isExpanded ? 'Collapse' : 'Expand'} details</span>\n                        </Button>\n                    </TableCell>\n                    <TableCell className=\"font-medium\">{coupon.code}</TableCell>\n                    <TableCell>{coupon.discount}%</TableCell>\n                    <TableCell>{coupon.description || \"-\"}</TableCell>\n                    <TableCell>\n                        {validUntilDate ? (\n                        <CouponExpiryEdit couponId={coupon.id} currentExpiryDate={validUntilDate} />\n                        ) : (\n                        \"No Expiry\"\n                        )}\n                    </TableCell>\n                    <TableCell>\n                        <Badge variant={ effectiveStatus === \"Active\" ? \"default\" : effectiveStatus === \"Inactive\" ? \"secondary\" : \"destructive\" }>\n                        {effectiveStatus}\n                        </Badge>\n                    </TableCell>\n                    <TableCell className=\"text-right\">\n                        <CouponStatusToggle couponId={coupon.id} isActive={coupon.isActive} isDisabled={isExpired} />\n                    </TableCell>\n                </TableRow>\n                {/* Expanded Row for Additional Details */}\n                {isExpanded && (\n                  <TableRow id={`details-${coupon.id}`} className=\"bg-muted/50 hover:bg-muted/50\">\n                    <TableCell colSpan={7} className=\"p-4\"> {/* Use colSpan to span all columns */}\n                      <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                        <div>\n                          <h4 className=\"font-semibold mb-2\">Booking Validity</h4>\n                          <CouponBookingValidityEdit\n                              couponId={coupon.id}\n                              currentBookingValidFrom={bookingValidFromDate}\n                              currentBookingValidUntil={bookingValidUntilDate}\n                          />\n                        </div>\n                        <div>\n                            <h4 className=\"font-semibold mb-2\">Exclusion Periods</h4>\n                            <CouponExclusionsEdit\n                              couponId={coupon.id}\n                              currentExclusionPeriods={exclusionPeriodsDates}\n                            />\n                        </div>\n                      </div>\n                    </TableCell>\n                  </TableRow>\n                )}\n            </React.Fragment>\n          );\n        })}\n      </TableBody>\n    </Table>\n  );\n}\n"],"names":[],"mappings":"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","debugId":null}}]
}